<div ng-controller="mobileQuestionnaireController" ng-init="init()">

  <div ng-if="mobile_app_service.isLangRtl()" class="mobile-header"  dir='rtl'>
    <div class="mobile-header-title"  ng-bind-html='r.question_title'></div>
    <div class="mobile-header-page-num">{{mobile_app_service.getIndexOfCurrentQuestion()}}/{{mobile_app_service.getTotalQuestions()}}</div>
    <div class="mobile_search_click" ng-click='toggleFullQuestionView()'>Q</div>
  </div>

  <div ng-if="!mobile_app_service.isLangRtl()" class="mobile-header">
    <div class="mobile_search_click" ng-click='toggleFullQuestionView()'>Q</div>
    <div class="mobile-header-page-num">{{mobile_app_service.getIndexOfCurrentQuestion()}}/{{mobile_app_service.getTotalQuestions()}}</div>
    <div class="mobile-header-title" ng-bind-html='r.question_title'></div>
  </div>
  
  <div class='mobile-content' id="main_container" ng-class="{'finish-question': isFinished() && isLoaded()}">
    <div class='question-instruction-tooltip' ng-click='hidePopup()'>
      <div class='full-question-blocker-show' ng-class="(!show_full_question && !show_popup) && 'full-question-blocker-hide'"></div>
      <div class='question-container' ng-class="show_full_question && 'question-container-display'">
        <div ng-if="mobile_app_service.isLangRtl()" class='question' dir='rtl'><bdi ng-bind-html='r.question'></bdi></div>
        <div ng-if="!mobile_app_service.isLangRtl()" class='question'><bdi ng-bind-html='r.question'></bdi></div>
        <div class='close-btn'><%= I18n.t('questionnaire.close_button') %></div>
      </div>
      <div class="genericPopUp confirm-box" ng-class="{'confirm-box-display': isChoseBySearch(),'genericPopUp-rtl': mobile_app_service.isLangRtl()}">
        <div class="subject">
          <span><%= I18n.t('questionnaire.are_you_sure')%></span>
          <span>{{getChosenEmployee()}}? </span>
        </div>
        <div class="popup-buttons">
          <div class= "actions-btn ok-btn" ng-click="onSelect()">אישור</div>
          <div class="actions-btn cancel-btn" ng-click="onCancel()">ביטול</div>
        </div>
      </div>

    </div>
    <div ng-show='!isFinished() && isLoaded()'>
      <div class="mobile_search_container" ng-if='display_search()'>
        <div class='mobile_search_tab'>
          <input ng-if="!mobile_app_service.isLangRtl()" class='mobile_search_text' type='text' placeholder="<%= I18n.t('questionnaire.search')%>" ng-model="search_input.text" typeahead="search_node.name for search_node in search_list() | filter:$viewValue |  limitTo:5" typeahead-on-select='showConfirmBox($item,r.question_id); search_input.text=""'/>        
          <div class="mobile_search_img_container" ng-click='clearSearch()'>
            <img class='mobile_search_img' alt="clear" src="<%= asset_path 'x.png' %>"/>
          </div>
          <input ng-if="mobile_app_service.isLangRtl()" dir='rtl' class='mobile_search_text_rtl' type='text' placeholder="<%= I18n.t('questionnaire.search')%>" ng-model="search_input.text" typeahead="search_node.name for search_node in search_list() | filter:$viewValue |  limitTo:5" typeahead-on-select='showConfirmBox($item,r.question_id); search_input.text=""'/>
        </div>
      </div>
      <slot-machine-directive height='{{heightOfContainer}}' value='currentlyFocusedEmployeeId' on-select-class="zoom" swipe='swipe' loaded='isLoaded()' load-more='loadMore'>
        <div ng-repeat="employee_response in tiny_array" value='{{employee_response.employee_id}}' class='slot-machine' ng-if='employeeDoesNotHaveResponseForQuestion(r.question_id, employee_response.employee_id) || searchAdded(employee_response.employee_id)'>
          <div class="employee-item">
            <img class="mobile-avatars" ng-src='{{employeeById(employee_response.employee_details_id).image_url}}'>
            <div class="mobile-dislike-btn" prevent-zoom ng-show="employee_response.employee_id == currentlyFocusedEmployeeId" ng-click='onUserResponse(r.question_id, employee_response.employee_id, false, r.employee_details_id)'>
              <div class='x-icon'></div>
            </div>
            <div class="mobile-like-btn" prevent-zoom ng-show="employee_response.employee_id == currentlyFocusedEmployeeId" ng-click='onUserResponse(r.question_id, employee_response.employee_id, true, r.employee_details_id)'>
              <div class='v-icon'></div>
            </div>
            <div class='mobile-employee-text' ng-show="employee_response.employee_id == currentlyFocusedEmployeeId">
              <div class="name">{{employeeById(employee_response.employee_details_id).name}}</div>
              <div class="rank">{{employeeById(employee_response.employee_details_id).role}}</div>
            </div>
          </div>
        </div>
      </slot-machine-directive>
    </div>

    <div ng-if="mobile_app_service.isLangRtl()" dir='rtl' ng-show='isFinished() && isLoaded()'  >
      <div class='page_content finish-task mobile-interact-page-content' style='margin-top: 150px;' >
        <div class="large-logo-mobile">
          <img src="<%= asset_path 'logo-medium.png' %>"  width="100%">
        </div>
        <h1 class='page_title'><%=I18n.t('questionnaire.question_completion_note_html')%></h1>
        <div class="interact-page-primary-btn" ng-click="clearScreenOnFinish()">
          <%= I18n.t('questionnaire.continue_answer_next_question') %>
        </div>
        <div class="saved-location-text">
          <%= I18n.t('questionnaire.saved_location_message') %>
        </div>
        <div class='foot'>
          <img src="<%= asset_path 'logo-medium.png' %>" height="75" width="308">
          <span>Powered by</span>
        </div>

      </div>
    </div>

    <div ng-if="!mobile_app_service.isLangRtl()" ng-show='isFinished() && isLoaded()' >
      <div class='page_content finish-task mobile-interact-page-content' style='margin-top: 150px;' >
        <div class="large-logo-mobile">
          <img src="<%= asset_path 'logo-medium.png' %>"  width="100%">
        </div>
        <h1 class='page_title'><%=I18n.t('questionnaire.question_completion_note_html')%></h1>
        <div class="interact-page-primary-btn" ng-click="clearScreenOnFinish()">
          <%= I18n.t('questionnaire.continue_answer_next_question') %>
        </div>
        <div class="saved-location-text">
          <%= I18n.t('questionnaire.saved_location_message') %>
        </div>
        <div class='foot'>
          <img src="<%= asset_path 'logo-medium.png' %>" height="75" width="308">
          <span>Powered by</span>
        </div>

      </div>
    </div>
  </div>
<div ng-if = "!(isFinished() && isLoaded())">
  <div ng-if="mobile_app_service.isLangRtl()"  class="mobile-footer">
    <div class="mobile-btns-container">
      <div class="right-button" ng-click='continueLater()' ng-class='{finished: state_saved[0]}'>
        <span ng-show='!state_saved[0]'><%=I18n.t('questionnaire.continue_later_button')%> </span>
        <span ng-show='state_saved[0]'><%=I18n.t('questionnaire.saved') %></span>
      </div>
     <!--  <div class="mobile-undo" prevent-zoom ng-click= "onUndo()" ng-class='{disabled: isUndoDisabled()}'><i class="fa fa-share"></i></div> -->

      <div class="left-button" ng-class='{finished: canFinish(), disabled: !canFinish()}'
                ng-click='minMaxOnFinish()' ng-if='mobile_app_service.isQuestionTypeMinMax()'>
        <i class="fa fa-chevron-left" ng-show='canFinish()'></i>
        <span ng-if='mobile_app_service.isQuestionTypeMinMax() && isLoaded()'>
        {{numberOfEmployeesAnsweredTrueForQuestion(r.question_id)}} / {{displayMaxAmount()}}
        </span>
      </div>

      <div class="left-button" ng-class='{finished: canFinish(), disabled: !canFinish()}'
                ng-click='clearScreenOnFinish()' ng-if='!mobile_app_service.isQuestionTypeMinMax()'>
        <i class="fa fa-chevron-left" ng-show='canFinish()'></i>
        {{numOfAnswers()}} of {{clientMaxReplies()}}
      </div>
    </div>
  </div>
  <div ng-if="!mobile_app_service.isLangRtl()" class="mobile-footer">
    <div class="mobile-btns-container">
      <div class="left-button" ng-click='continueLater()' ng-class='{finished: state_saved[0]}'>
        <span ng-show='!state_saved[0]'><%=I18n.t('questionnaire.continue_later_button')%> </span>
        <span ng-show='state_saved[0]'><%=I18n.t('questionnaire.saved') %></span>
      </div>

      <!-- <div class="mobile-undo" prevent-zoom ng-click= "onUndo()" ng-class='{disabled: isUndoDisabled()}'><i class="fa fa-reply"></i></div> -->

      <div class="right-button" ng-class='{finished: canFinish(), disabled: !canFinish()}' ng-click='clearScreenOnFinish()'>
        {{numOfAnswers()}} of {{clientMaxReplies()}}
        <i class="fa fa-chevron-right" ng-show='canFinish()'></i>
      </div>
    </div>
  </div>
</div>
</div>
