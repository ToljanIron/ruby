//
//     KeyLines v3.0.1-2407 starter sdk
//
//     Copyright Â© 2011-2016 Cambridge Intelligence Limited.
//     All rights reserved.
//

!function(){var e={};"undefined"!=typeof window&&(window.KeyLines=e="undefined"!=typeof window.KeyLines?window.KeyLines:e),"object"==typeof module&&"object"==typeof module.exports?(global.KeyLines=e,module.exports=e):"function"==typeof define&&define.amd&&define(e),e.webGLSupport=function(){},e.webGLSupport()&&(e.WebGL={})}(),!function(){var e=KeyLines.API=KeyLines.API||{};e.createAPI=function(){function e(){return o&&o.api.isShown()}function n(e,n,t){n=n||{all:!0,positions:!0,colours:!0,textures:!0,shadow:!0},e?b.afterChange(t):(b.render(n),h.invoke(t))}function t(e){return e===!0&&(e={animate:!0}),h.defaults(e,{animate:!1,time:1e3})}function r(e,n){function t(e,n){g.privateEach({type:"link"},function(t){if(!e[t.id1]||!e[t.id2]){var r=e[t.id1]||e[t.id2],i=e[t.id1]?t.id2:t.id1;r&&i&&(n[i]||(n[i]={x:0,y:0,counter:0,id:i}),n[i].x+=r.x,n[i].y+=r.y,n[i].counter++)}});var t=0;return h.iterator(n,function(n){e[n.id]||(n.x/=n.counter,n.y/=n.counter,e[n.id]=n,t++)}),t}function r(e,r){for(var i,a={},c=[];0!==i;)i=t(r,a);h.iterator(e,function(e){"node"===e.type&&(a[e.id]||(e.x=o[e.id].x,e.y=o[e.id].y))}),h.iterator(a,function(e){c.push(e)}),g.setProperties(c,!1,function(){h.invoke(n,u)})}function i(){var e=[],n={};return w.each({type:"node"},function(t){e.push(t.id),n[t.id]=t}),{list:e,dict:n}}function a(e){for(var n=[],t={},r=0;r<e.length;r++){var i=e[r];h.isNullOrUndefined(i)||t[i.id]||(t[i.id]=1,o[i.id]={x:i.x,y:i.y},delete i.x,delete i.y,n.push(i))}return n}var o={};e=a(e);var c=i(),u=c.list,s=c.dict;g.merge(e,function(){r(e,s)})}function i(e,n){b.draw(e,n),b.drawoffscreen(),b.afterDraw()}var a,o,c=KeyLines.Controller,u=KeyLines.Draggers,s=KeyLines.Events,l=KeyLines.Model,f=KeyLines.Overlays,d=KeyLines.Rendering,h=KeyLines.Util,v=KeyLines.View,g={},y=s.createEventBus(),m=u.createDraggers(y),x=KeyLines.Generator.create(y),w=l.createModel(y,m,x),p=f.createOverlays(y,v,o),b=c.createController(g,y,p,x,o);b.setModel(w);var M;g.privateInit=function(e,n,t,r,i,a,o,c,u){M=r,b.assetPath(o),b.setCursorFn(i),b.setCreateCanvasFn(r),b.setImageGenFn(a),L(e,n,t,c),b.imageBasePath(u)};var L=g.privateSetSize=function(e,n,t,r,i){var c=M(n,t);b.makeGhostCanvas(n,t),r&&(n/=r,t/=r);var u=a;a=v.createView(y,n,t,r,o),b.setView(a),b.setCanvas(e),b.setShadowCanvas(c.getContext("2d"),n,t),d.clearLastFont(),u&&(a.setMinZoom(u.getMinZoom()),a.setMaxItemZoom(u.getMaxItemZoom()),a.fromOldSettings(u.settings(),!1)),b.afterChange(null,i)};g.privateMapSetSize=function(n,t){e()&&o.internalUse.setSize(n,t)},g.privateNamespaceDefinitions=function(){var e={};return e},g.toDataURL=function(e,n,t,r){function i(t){e=Math.floor(e/t),n=Math.floor(n/t)}e=Math.floor(e),n=Math.floor(n),e=e>0?e:100,n=n>0?n:100,t=h.defaults(t,{fit:"view",watermark:!0,gradient:!0,logo:!0});var u;if("oneToOne"===t.fit){var l=b.modelExtents();l||(l={x1:0,y1:0,x2:100,y2:100});var d=10;l.x1-=d,l.y1-=d,l.x2+=d,l.y2+=d;var y=b.watermarkSize();if(y&&t.watermark){var m=(y.width-(l.x2-l.x1))/2;m>0&&(l.x1-=m,l.x2+=m);var p=(y.height-(l.y2-l.y1))/2;p>0&&(l.y1-=p,l.y2+=p)}e=l.x2-l.x1,n=l.y2-l.y1,t.noScale=!0}var L=16e6,S=e*n,k=S/L;if(k>1){var I=Math.sqrt(k);i(I)}var A=8e3,E=e/A;E>1&&i(E);var D=n/A;D>1&&i(D);var C=M(e,n),O=C.getContext("2d"),T=t.noScale?1:e/a.width(),P=s.createEventBus(),N=v.createView(P,Math.floor(e/T),Math.floor(n/T),T,o),z=f.createOverlays(P,v),K=c.createController(g,P,z,x);K.setCreateCanvasFn(M),K.setModel(w),K.setView(N),K.setCanvas(O),K.setShadowCanvas(null,e,n),K.assetPath(b.assetPath()),K.imageBasePath(b.imageBasePath()),K.imageList(b.imageList());var R=b.options();R.overview={shown:!1},t.watermark||(R.watermark=!1),t.gradient||(R.gradient=!1),t.logo||(R.logo=!1),K.options(R,null,!0),K.backgroundOpacity(b.backgroundOpacity()),K.makeGhostCanvas(N.width(),N.height());var U=[];switch(t.selection||(U=w.doSelection(),w.doSelection([])),t.fit){case"chart":K.fitToModel(!1);break;case"view":N.fromOldSettings(a.settings(),!0);break;case"exact":N.fromOldSettings(a.settings(),!1);break;case"oneToOne":N.fitWorldExtents(u,!1,!1,!1,0,0)}N.scaleFactor(T),K.draw(!0,{all:!0});var W;try{W=C.toDataURL()}catch(B){throw new Error("[toDataURL] There is a problem to export the chart with tainted canvas.")}return t.selection||w.doSelection(U),w.setAllDirty(),r?h.invoke(r,W):W},g.load=function(e,n){switch(e.type){case"LinkChart":if(o&&o.internalUse.isTransitioning())throw new Error("Cannot load chart during map show or hide operation");w=l.createModel(y,m,x),b.setModel(w),b.load(e,function(){b.afterChange(n,null,!0)});break;default:throw new Error("Unknown chart type passed to load")}},g.chartType=function(){return w.type()},g.clear=function(){y.trigger("prechange","delete"),w.load({items:[]}),b.combo.internalUse.loadUp(),b.afterChange(null,null,!0)},g.merge=function(e,t){e=h.getItemsArray(e);var r=b.merge(e);n(r,null,function(){b.postMerge(t)})},g.privateMerge=function(e,t){var r=w.merge(e);n(r,null,t)},g.privateEach=function(e,n){w.each(e,n)},g.privateBothEndsShown=function(e){return w.bothEndsShown(e)},g.privateRemoveItem=function(e){w.removeItem(e),b.render()},g.privateGraph=function(){return w.graph()},g.setProperties=function(e,t,r){var i=b.setProperties(e,t);n(i,{all:!0,colours:!0},r)},g.animateProperties=function(e,n,t){n=h.defaults(n,{time:1e3,easing:"linear",queue:!0}),e=h.ensureArray(e),b.animateProperties(e,n,t)},g.ping=function(e,n,t){n=h.defaults(n,{c:"#909090",w:20,r:80,time:800,repeat:1}),b.ping(e,n,t)},g.getItem=function(e){if(h.isArray(e)){for(var n=[],t=0;t<e.length;t++){var r=w.getItem(e[t]);r=r||null,n.push(r)}return n}return w?w.getItem(e):null},g.setItem=function(e,t){if(e){y.trigger("prechange","properties");var r=b.setItem(e);n(r,{all:!0},function(){b.postMerge(t)})}},g.removeItem=function(e){y.trigger("prechange","delete"),b.removeItem(e),b.render()},g.hide=function(e,n,r){y.trigger("prechange","hide"),e=h.ensureArray(e),n=t(n),b.hide(e,n,r)},g.hidden=function(){return w.hidden()},g.show=function(e,n,r,i){y.trigger("prechange","show"),e=h.ensureArray(e),r=t(r),b.show(e,n,r,i)},g.labelPosition=function(e){return w?b.labelPosition(e,a):null},g.serialize=function(){var e=w.serialize();return b.appendCombos(e),e.viewSettings=a.settings(),e},g.worldCoordinates=function(e,n){var t=a.scale(e),r=a.scale(n);return{x:a.viewToWorldX(t),y:a.viewToWorldY(r)}},g.viewCoordinates=function(e,n){var t=a.worldToViewX(e),r=a.worldToViewY(n);return{x:a.unscale(t),y:a.unscale(r)}},g.viewOptions=function(e,n,r){if(!e)return a.settings();var i=t(n);e=h.defaults(e,{offsetX:0,offsetY:0,zoom:1}),b.setViewSettings(e,i.animate,i.time,function(){b.render({drawOnly:!0}),h.invoke(r)})},g.options=function(e,n){return b.options(e,n)},g.displayOptions=function(e,n){return g.options(e,n)},g.interactionOptions=function(e){return g.options(e)},g.lock=function(e,n){return"undefined"!=typeof e&&(S=e,o&&o.internalUse.lock(S),e?(n=n||{},b.wait(n.wait),b.removeDragger()):b.wait(!1),b.render()),S};var S=!1;g.zoom=function(e,n,r){var i=t(n);switch(e){case"in":b.zoomIn(i.animate,i.time,r);break;case"out":b.zoomOut(i.animate,i.time,r);break;case"one":b.setZoom(1,i.animate,i.time,r);break;case"fit":b.fitToModel(i.animate,i.time,r);break;case"selection":b.fitToSelection(i.animate,i.time,r);break;case"height":b.fitModelHeight(i.animate,i.time,r)}},g.pan=function(n,r,i){var a=t(r);"selection"!==n||e()?b.pan(n,a.animate,a.time,i):b.fitToSelection(a.animate,a.time,i,!0)},g.getLastError=function(){return y.getErrors()},g.imagePrefix=function(e){return b.imagePrefix(e)},g.cancelAnimation=function(){b.cancelAnimation()},g.layout=function(n,t,r){if(e())return h.invoke(r);n||(n="standard");var i=g.viewOptions(),a=i.height>0?i.width/i.height:1;t=h.defaults(t,{fit:!0,animate:!0,tidy:!0,ratio:a,tightness:5,straighten:!0}),b.layout(n,t,r)},g.selection=function(e){e=h.isNullOrUndefined(e)?e:h.ensureArray(e);var n=w?w.doSelection(e):[];return e&&b.render(),n},g.expand=function(n,t,i){function a(e){var n={fixed:e,animate:!!t.animate,time:t.time,tightness:t.tightness,tidy:t.tidy,fit:t.fit,strategy:"spiral"};g.layout("standard",n,i)}t=h.defaults(t,{fit:!1,tidy:!1,animate:!0,tightness:5,time:1e3}),y.trigger("prechange","expand"),n=h.ensureArray(h.getItemsArray(n)),e()?g.merge(n,i):r(n,a)},g.createLink=function(e,n,t,r){function i(e,n){"dummy"===e&&(g.removeItem(o),g.unbind("dragcomplete",i),h.invoke(r,n))}var a=g.getItem(e);if(g.getItem(n))throw new Error("LinkId ("+n+") already exists and must be unique");if(e&&a&&"node"===a.type&&n){n=h.rawId(n),t=h.defaults(t,{style:{}}),g.bind("dragcomplete",i);var o="dummyEnd"+Math.floor(1e7*Math.random()),c={type:"node",du:!0,id:o,x:a.x,y:a.y},u=h.merge(t.style,{id:n,id1:e,id2:o,type:"link"});g.merge([c,u],function(){h.nextTick(function(){b.startDragger(n,o+h.idSep()+"id2",a.x,a.y)},50)})}},KeyLines.Common.appendActions(g,b,g.lock),g.mousemove=function(e,n,t,r){b.mousemove(e,n,t,r,S)},g.dragover=function(e,n){b.dragover(e,n)},h.merge(g,y);var k=KeyLines.Common.frameManager(i,b.animate);return h.merge(g,k),g.bind("redraw",k.redraw),g}}(),!function(){var e=KeyLines.Graph={};e.create=function(){function e(e,n,t,r,i){e[t]||(e[t]={}),e[r]||(e[r]={}),e[t][r]||(e[t][r]=e[r][t]=[],n.push(i)),e[t][r].push(i)}function n(e,n,t){var r={id:n.id,id1:n.id1,id2:n.id2,ids:t};e.edges.push(r),e.connections.push(t)}function t(t){var r=t&&t.all?"all":"visible";if(null===d&&(d={}),!d[r]){d[r]={connections:[],adjacency:{},vertices:{},edges:[]},g({all:t&&t.all},function(e,n){d[r].vertices[n]={x:e.x,y:e.y},d[r].adjacency[n]={}});var i=[];v({all:t&&t.all},function(n,t,a,o){a!==o&&e(d[r].adjacency,i,a,o,t)});for(var a=i.length,o=0;a>o;o++){var c=f[i[o]];n(d[r],c,d[r].adjacency[c.id1][c.id2])}}return d[r]}function r(e){if(e.direction=e.direction||"any",!/^(any|from|to)$/.test(e.direction))throw new TypeError("opts direction property should be either 'from', 'to' or 'any'")}function i(e){return v(e,function(n,t,r,i){if(w(r,i,t,e)<=0)throw new Error("Link Weight must be Positive")}),{direction:e.direction,value:e.value,weights:c(e)}}function a(e){return r(e)||i(e)}function o(e){e.all=!!e.all}function c(e){return!!e.weights}var u=KeyLines.Util,s={},l={},f={},d=null,h=s.clearCache=function(){d=null};s.privateSetProperties=function(e,n){l=e,f=n,h()};var v=function(e,n){var t=e&&e.all;for(var r in f){r=u.rawId(r);var i=f[r];(t||!i.hi)&&n(i,r,i.id1,i.id2)}},g=function(e,n){var t=e&&e.all;for(var r in l){r=u.rawId(r);var i=l[r];(t||!i.hi)&&n(i,r)}};s.findAdjacency=function(e,n,r){var i=t(e).adjacency;return i[n]?i[n][r]:void 0},s.connections=function(e){return t(e).connections},s.neighbours=function(e,n){function r(e,t,r){var i=u.rawId(y[r][e][t]);!v[i]&&x(r,e,i,n)&&(a[i]=c[e]=v[i]=1,e in g&&(c[r]=1),e in s||(d++,h[e]=1))}function i(){for(var e in s)if(e=u.rawId(e),l[e]&&y[e])for(var t in y[e]){t=u.rawId(t);for(var i=0;i<y[e][t].length;i++)r(t,i,e)}else if(f[e]){var a=f[e];!v[a.id2]&&x(a.id2,a.id1,e,n)&&(c[a.id2]=v[a.id2]=v[e]=1,a.id2 in s||(d++,h[a.id2]=1)),!v[a.id1]&&x(a.id1,a.id2,e,n)&&(c[a.id1]=v[a.id1]=v[e]=1,a.id1 in s||(d++,h[a.id1]=1))}}e=u.ensureArray(e);var a={},c={},s=u.makeIdMap(e);if(n=u.defaults(n,{all:!1,direction:"any",hops:1}),n.hops<1)throw new Error("neighbours error: hops must be a positive number");o(n);var d=0,h={},v={},g=s,y=t(n).adjacency;for(var m in s){if(m=u.rawId(m),!l[m]&&!f[m])throw new Error("neighbours error: ids must be present in the graph");d++}for(;n.hops--&&d;)d=0,i(),s=h,h={};return{nodes:u.flattenMap(c),links:u.flattenMap(a)}},s.components=function(e){var n,r,i=[],a=0,c=[];e=u.defaults(e,{all:!1}),o(e);var s=t(e).vertices,l=t(e).edges;for(n in s)if(s[n].hasOwnProperty("c"))c[s[n].c]||(c[s[n].c]={nodes:[],links:[]});else{for(i.push(n+"");i.length>0;){var f=i.shift();if(!s[f].hasOwnProperty("c"))for(s[f].c=a,r=0;r<l.length;r++)l[r].hasOwnProperty("c")||(l[r].id1===f?(l[r].c=a,i.push(l[r].id2)):l[r].id2===f&&(l[r].c=a,i.push(l[r].id1)))}c.push({nodes:[],links:[]}),a++}for(n in s)c[s[n].c].nodes.push(n+"");for(r=0;r<l.length;r++)c[l[r].c].links=c[l[r].c].links.concat(l[r].ids);return c},s.internalMarkLinks=function(e){var n=t().adjacency,r=2,i={};for(var a in e){var o=n[a];if(o)for(var c in o)for(var u=o[c],s=0;s<u.length;s++){var l=u[s];i[l]=!0}}for(var f in i)e[f]=r},s.distances=function(e,n){if(!l[e])throw new Error("distances error: id(s) must be present in the graph");n=n||{},a(n),o(n);var t=M(e,n),r={};for(var i in t.distance){var c=t.distance[i];isFinite(c)&&(r[i]=c)}return r};var y=function(e,n,r){var i,a=t(r).adjacency,o=a[e][n],c=1/0,u=p(r);if(o)for(var s=0;s<o.length;s++){var l=u(e,n,o[s],r);isNaN(l)||(c>l&&(i=[],c=l),l===c&&1/0!==c&&i.push(o[s]))}return{value:c,links:i}},m=function(e,n){return f[e].a2&&f[e].id2===n||f[e].a1&&f[e].id1===n},x=function(e,n,t,r){return"any"!==r.direction?"from"===r.direction&&m(t,n)||"to"===r.direction&&m(t,e):!0},w=function(e,n,t,r){var i=0/0;return x(e,n,t,r)&&(r.value?f[t].d&&(i=Number(f[t].d[r.value])):i=1),i},p=function(e){return c(e)?b:w},b=function(e,n,t,r){var i=w(e,n,t,r);return isNaN(i)?i:1/i},M=function(e,n){function r(){for(var e,n=1/0,t=0;t<c.length;t++){var r=a[c[t]];n>=r&&(e=t,n=r)}return e}function i(e,n,t){o[e]||(o[e]=[]),o[e].push({id:n,links:t})}var a={},o={},c=[],s=t(n).adjacency;for(g(n,function(e,n){a[n]=1/0,o[n]=void 0,c.push(n)}),a[e]=0;c.length>0;){var l=r(),f=c[l];if(1/0===a[f])break;c.splice(l,1);for(var d in s[f]){d=u.rawId(d);var h=y(f,d,n),v=a[f]+h.value;v<a[d]?(a[d]=v,o[d]=[{id:f,links:h.links}]):v===a[d]&&i(d,f,h.links)}}return{distance:a,previous:o}};return s}}(),!function(){function e(e){var n={};if(e)for(var t=0;t<e.length;t++)n[e[t]]=1;return n}function n(n){for(var t=e(n),r=[],i=0;i<R.length;i++)t[i]||r.push(i);return r}function t(e,n){return 1===n?e:on(e,n)}function r(e){var n={};for(var t in e)n[P.primitives[t]]=e[t];return n}function i(e,n,t,r){var i,a,o,c;n.sm?(i=t.sdim(n.r),a=t.sdim(n.bw)):(i=t.dim(n.r),a=r?t.sw(n.bw):t.w(n.bw));var u=n.a;u?(o=n.x+u.x,c=n.y+u.y):(o=n.x,c=n.y),r?m(e,t.x(o),t.y(c),i,n.bc&&n.sc,a,n.fc&&n.sc,n.fi):m(e,t.x(o),t.y(c),i,n.bc,a,n.fc,n.fi,n.bs)}function a(e,n,t,r){var i,a,o=n.a;o?(i=n.x+o.x,a=n.y+o.y):(i=n.x,a=n.y);var c,u,s,l=t.x(i),f=t.y(a),d=t.dim(n.r);r?(c=n.bc&&n.sc,u=t.sw(n.bw)):(c=n.bc,u=t.w(n.bw),s=n.ls),1e6>=d?x(e,l,f,d,n.sa,n.ea,c,u,s):T(t,e,l,f,d,n.sa,n.ea,c,u,s)}function o(e,n,t,r){var i,a,o,c,u=n.a;u?(i=n.x1+u.x,a=n.y1+u.y,o=n.x2+u.x,c=n.y2+u.y):(i=n.x1,a=n.y1,o=n.x2,c=n.y2),r?w(e,t.x(i),t.y(a),t.x(o),t.y(c),n.c&&n.sc,t.sw(n.w)):w(e,t.x(i),t.y(a),t.x(o),t.y(c),n.c,t.w(n.w),n.ls)}function c(e,n,t,r){var i,a,o,c,u,s,l,f,d=n.a;d?(i=n.x1+d.x,a=n.y1+d.y,o=n.x2+d.x,c=n.y2+d.y,u=n.x3+d.x,s=n.y3+d.y,l=n.x4+d.x,f=n.y4+d.y):(i=n.x1,a=n.y1,o=n.x2,c=n.y2,u=n.x3,s=n.y3,l=n.x4,f=n.y4),r?p(e,t.x(i),t.y(a),t.x(o),t.y(c),t.x(u),t.y(s),t.x(l),t.y(f),n.c&&n.sc,t.sw(n.w)):p(e,t.x(i),t.y(a),t.x(o),t.y(c),t.x(u),t.y(s),t.x(l),t.y(f),n.c,t.w(n.w),n.ls)}function u(e,n,t,r){var i,a,o,c,u=n.a;if(u?(i=n.x1+u.x,a=n.y1+u.y,o=n.x2+u.x,c=n.y2+u.y):(i=n.x1,a=n.y1,o=n.x2,c=n.y2),r)n.back&&M(e,t.x(i),t.y(a),t.x(o),t.y(c),n.sc,-1,n.sc,!0);else{var s,l;u?(s=n.x+u.x,l=n.y+u.y):(s=n.x,l=n.y);var f=t.x(s),d=t.y(l),h=t.dim(n.fs);if(n.w&&(3>=h||h<P.browserMinimumFontSize)){var v=t.dim(n.w);if(n.isSel)var g=n.bc;else var g=on(n.c,.4);n.xc&&(f-=Math.floor(v/2)),M(e,f,d-h,f+v,d,g,-1,g,!0)}else n.back&&M(e,t.x(i),t.y(a),t.x(o),t.y(c),n.bc,-1,n.bc,!0),b(e,f,d,n.t,n.c,h,n.bo,n.ff,n.xc)}}function s(e,n,t,r,i){var a,o,c,u,s=n.a;s?(a=n.x1+s.x,o=n.y1+s.y,c=n.x2+s.x,u=n.y2+s.y):(a=n.x1,o=n.y1,c=n.x2,u=n.y2);var l=t.x(a),f=t.y(o),d=t.x(c),h=t.y(u);n.vx&&(l-=n.vx,f-=n.vx,d+=n.vx,h+=n.vx),r?M(e,l,f,d,h,n.sc,-1,n.sc,!0):L(e,i[n.u],l,f,d,h,n.s)}function l(e,n,t,r){var i,a,o,c,u=n.a;u?(i=n.x1+u.x,a=n.y1+u.y,o=n.x2+u.x,c=n.y2+u.y):(i=n.x1,a=n.y1,o=n.x2,c=n.y2),r?M(e,t.x(i),t.y(a),t.x(o),t.y(c),n.bc&&n.sc,t.sw(n.bw),n.fc&&n.sc,n.fi):M(e,t.x(i),t.y(a),t.x(o),t.y(c),n.bc,t.w(n.bw),n.fc,n.fi,n.bs)}function f(e,n,t,r){var i,a,o,c,u=n.a;u?(i=n.x1+u.x,a=n.y1+u.y,o=n.x2+u.x,c=n.y2+u.y):(i=n.x1,a=n.y1,o=n.x2,c=n.y2),r?S(e,t.x(i),t.y(a),t.x(o),t.y(c),t.dim(n.r),n.bc,t.sw(n.bw),n.fc&&n.sc,n.fi):S(e,t.x(i),t.y(a),t.x(o),t.y(c),t.dim(n.r),n.bc,t.w(n.bw),n.fc,n.fi)}function d(e,n,t,r){var i,a,o,c,u,s,l=n.a;l?(i=n.x1+l.x,a=n.y1+l.y,o=n.x2+l.x,c=n.y2+l.y,u=n.x3+l.x,s=n.y3+l.y):(i=n.x1,a=n.y1,o=n.x2,c=n.y2,u=n.x3,s=n.y3),r?k(e,t.x(i),t.y(a),t.x(o),t.y(c),t.x(u),t.y(s),n.bc&&n.sc,t.sw(n.bw),n.fc&&n.sc,n.fi):k(e,t.x(i),t.y(a),t.x(o),t.y(c),t.x(u),t.y(s),n.bc,t.w(n.bw),n.fc,n.fi)}function h(e,n,t,r){var i,a,o,c,u,s,l,f,d,h,v=n.a;v?(i=n.x1+v.x,a=n.y1+v.y,o=n.x2+v.x,c=n.y2+v.y,u=n.x3+v.x,s=n.y3+v.y,l=n.x4+v.x,f=n.y4+v.y,d=n.x5+v.x,h=n.y5+v.y):(i=n.x1,a=n.y1,o=n.x2,c=n.y2,u=n.x3,s=n.y3,l=n.x4,f=n.y4,d=n.x5,h=n.y5),r?I(e,t.x(i),t.y(a),t.x(o),t.y(c),t.x(u),t.y(s),t.x(l),t.y(f),t.x(d),t.y(h),n.bc&&n.sc,t.sw(n.bw),n.fc&&n.sc,n.fi):I(e,t.x(i),t.y(a),t.x(o),t.y(c),t.x(u),t.y(s),t.x(l),t.y(f),t.x(d),t.y(h),n.bc,t.w(n.bw),n.fc,n.fi,n.bs)}function v(e,n,t,r,i){var a,o;"dotted"===r?(a=.5,o=2*t):(a=Math.max(2,2*t),o=a/2);var c=Math.round(i?n/(a+o):(n+o)/(a+o));c>1&&(o=i?(n-c*a)/c:(n-c*a)/(c-1),o>0&&(e.lineCap=a>1?"butt":"round",Q[0]=a,Q[1]=o,e.setLineDash(Q)))}function g(e,n){return e&&"solid"!==e&&"setLineDash"in n}function y(e){Q[0]&&(Q[0]=0,e.setLineDash(en),e.lineCap="butt")}function m(e,n,t,r,i,a,o,c,u){e.fillStyle=c?o:V.transparent,a>=0?(g(u,e)&&v(e,z*r,a,u,!0),e.lineWidth=Math.max(1,a),e.strokeStyle=i):e.strokeStyle=V.transparent,e.beginPath(),e.arc(n,t,r,0,z,!1),e.closePath(),c&&e.fill(),a>=0&&(e.stroke(),u&&y(e))}function x(e,n,t,r,i,a,o,c,u){if(e.lineWidth=Math.max(1,c),e.strokeStyle=o,g(u,e)){var s=(a-i)*r;v(e,s,c,u)}e.beginPath(),e.arc(n,t,r,i,a,!1),e.stroke(),e.closePath(),u&&y(e)}function w(e,n,t,r,i,a,o,c){if(e.lineWidth=Math.max(1,o),e.strokeStyle=a,g(c,e)){var u=r-n,s=i-t,l=Math.sqrt(u*u+s*s);v(e,l,o,c)}e.beginPath(),e.moveTo(n,t),e.lineTo(r,i),e.stroke(),e.closePath(),c&&y(e)}function p(e,n,t,r,i,a,o,c,u,s,l,f){var d=e.lineJoin;if(e.lineWidth=Math.max(1,l),e.lineJoin="round",e.strokeStyle=s,g(f,e)){var h=r-n,m=i-t,x=Math.sqrt(h*h+m*m),w=a-r,p=o-i,b=Math.sqrt(w*w+p*p),M=c-a,L=u-o,S=Math.sqrt(M*M+L*L);v(e,x+b+S,l,f)}e.beginPath(),e.moveTo(n,t),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(c,u),e.stroke(),e.closePath(),e.lineJoin=d,f&&y(e)}function b(e,n,t,r,i,a,o,c,u){rn(e,a,o,c),e.fillStyle=i,e.textAlign=u?"center":"left",e.fillText(r,n,t)}function M(e,n,t,r,i,a,o,c,u,s){if(u&&(e.fillStyle=c,e.fillRect(n,t,r-n,i-t)),o>=0)if(g(s,e)){var l=Math.floor(o/2);w(e,n-l,t,r+l,t,a,o,s),w(e,r,t-l,r,i+l,a,o,s),w(e,r+l,i,n-l,i,a,o,s),w(e,n,i+l,n,t-l,a,o,s)}else e.lineWidth=Math.max(1,o),e.strokeStyle=a,e.strokeRect(n,t,r-n,i-t)}function L(e,n,t,r,i,a,o){var c=n[o?o:"im"];e.drawImage(c,0,0,c.width,c.height,t,r,i-t,a-r)}function S(e,n,t,r,i,a,o,c,u,s){return e.drawRoundedRect?(e.drawRoundedRect(n,t,r,i,a,o,c,u,s),void 0):(e.beginPath(),e.moveTo(n+a,t),e.lineTo(r-a,t),e.arcTo(r,t,r,t+a,a),e.lineTo(r,i-a),e.arcTo(r,i,r-a,i,a),e.lineTo(n+a,i),e.arcTo(n,i,n,i-a,a),e.lineTo(n,t+a),e.arcTo(n,t,n+a,t,a),e.closePath(),s&&(e.fillStyle=u,e.fill()),c>=0&&(e.lineWidth=Math.max(1,c),e.strokeStyle=o,e.stroke()),void 0)}function k(e,n,t,r,i,a,o,c,u,s,l){if(Math.abs(r-n)>K||Math.abs(i-t)>K){if(e.drawTriangle)return e.drawTriangle(n,t,r,i,a,o,c,u,s,l),void 0;e.beginPath(),e.moveTo(n,t),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(n,t),e.closePath(),l&&(e.fillStyle=s,e.fill()),u>=0&&(e.lineWidth=Math.max(1,u),e.strokeStyle=c,e.stroke())}}function I(e,n,t,r,i,a,o,c,u,s,l,f,d,h,v,y){if(e.drawPentagon)return e.drawPentagon(n,t,r,i,a,o,c,u,s,l,f,d,h,v),void 0;if(e.beginPath(),e.moveTo(n,t),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(c,u),e.lineTo(s,l),e.lineTo(n,t),e.closePath(),v&&(e.fillStyle=h,e.fill()),d>=0)if(g(y,e)){var m=(r>n?1:-1)*Math.floor(d/2);w(e,n,t,r,i,f,d,y),w(e,r,i,a,o,f,d,y),w(e,a,o,c-m,u,f,d,y),w(e,c,u+m,s,l-m,f,d,y),w(e,s-m,l,n,t,f,d,y)}else e.lineWidth=Math.max(1,d),e.strokeStyle=f,e.stroke()}function A(e,n,t){e/=255,n/=255,t/=255;var r,i,a=Math.max(e,n,t),o=Math.min(e,n,t),c=(a+o)/2;if(a===o)r=i=0;else{var u=a-o;switch(i=c>.5?u/(2-a-o):u/(a+o),a){case e:r=(n-t)/u+(t>n?6:0);break;case n:r=(t-e)/u+2;break;case t:r=(e-n)/u+4}r/=6}return[r,i,c]}function E(e,n,t){return 0>t&&(t+=1),t>1&&(t-=1),1/6>t?e+6*(n-e)*t:.5>t?n:2/3>t?e+6*(n-e)*(2/3-t):e}function D(e,n,t){var r,i,a;if(0===n)r=i=a=t;else{var o=.5>t?t*(1+n):t+n-t*n,c=2*t-o;r=E(c,o,e+1/3),i=E(c,o,e),a=E(c,o,e-1/3)}return[Math.ceil(255*r),Math.ceil(255*i),Math.ceil(255*a)]}function C(e){return e}function O(e){return e>Math.PI||e<-Math.PI?e-2*Math.PI*Math.floor((e+Math.PI)/2*Math.PI):e}function T(e,n,t,r,i,a,o,c,u,s){function l(e,n){D++,1===D?(k=e,I=n):2===D&&(A=e,E=n)}function f(e){var n=t+i*Math.cos(e),a=r+i*Math.sin(e);n>b&&M>n&&a>L&&S>a&&l(n,a)}function d(e,n){var t=e*e;if(t===C)n(i);else if(C>t){var r=Math.sqrt(C-t);n(r),n(-r)}}function h(e){d(e-t,function(n){var t=r+n;t>=L&&S>=t&&g(e,r+n)})}function v(e){d(e-r,function(n){var r=t+n;r>=b&&M>=r&&g(t+n,e)})}function g(e,n){var i,c=e-t,u=n-r,s=Math.atan2(u,c);i=o>a?s>a&&o>s:s>a||o>s,(i||s===a||s===o)&&l(e,n)}var y=e.width(),m=e.height(),x=Math.floor(y/2),p=Math.floor(m/2),b=-x,M=y+x,L=-p,S=m+p;a=O(a),o=O(o);var k,I,A,E,D=0;f(a),f(o);var C=i*i;h(b),h(M),v(L),v(S),2===D&&w(n,Math.floor(k),Math.floor(I),Math.floor(A),Math.floor(E),c,u,s)}for(var P=KeyLines.Rendering={},N=Math.PI/2,z=2*Math.PI,K=3,R=["TIMEBAR","BANDS","UNDERLAYS","HALOS","SHAPESEL","SHAPES","HANDLES","NODESEL","LINKS","NODES","DRAGGERS","BUBBLES","BANDLABELS","OVERLAYS","OVERLAYSSHADOW","OVERVIEW","OVERVIEWSHADOW","WAIT"],U=R.length,W=P.layers={},B=0;U>B;B++)W[R[B]]=B;var F=P.channels={MAIN:0,BACKGROUND:1,GHOST:2,BACKGROUNDGHOST:3};P.itemLayers=[W.HALOS,W.SHAPESEL,W.SHAPES,W.NODESEL,W.LINKS,W.NODES,W.BUBBLES],P.extraLayers=n(P.itemLayers),P.topLayers=[W.HALOS,W.SHAPESEL,W.SHAPES,W.NODESEL,W.LINKS,W.NODES,W.HANDLES,W.DRAGGERS,W.BUBBLES,W.BANDLABELS,W.OVERLAYS],P.shadowLayers=n([W.BANDS,W.UNDERLAYS,W.BANDLABELS,W.OVERLAYS,W.OVERVIEW]),P.viewLayers=[W.BANDS,W.BANDLABELS,W.HANDLES,W.OVERLAYS,W.OVERVIEW,W.OVERLAYSSHADOW,W.OVERVIEWSHADOW,W.TIMEBAR,W.UNDERLAYS,W.WAIT],P.viewLayersIndex=e(P.viewLayers),P.selMap={},P.selMap[W.NODES]=W.NODESEL,P.selMap[W.SHAPES]=W.SHAPESEL,P.widgets=function(){function n(e){return(e.gh?2:0)+(e.bg?1:0)}function t(e){return h[n(e)]}function r(){for(var e,n,t=P.itemLayers,r=0;4>r;r++){e=h[r];for(var i=0,a=t.length;a>i;i++){var o=t[i];n=e[o],n?n.count=0:e[o]={pool:[],count:0}}}}function i(){var e;if("undefined"==typeof Object.keys)for(var n in d)e=d[n],a(e);else for(var t=Object.keys(d),r=0,i=t.length;i>r;r++)e=d[t[r]],a(e)}function a(e){for(var n=t(e),r=0;r<e.count;r++){var i=e.pool[r],a=n[i.la];a.pool[a.count++]=i}}function o(n,t,r,i,a,o){for(var c=h[a],u=e(o),s=0;U>s;s++)if((!o||u[s])&&c[s])for(var l=c[s],f=P.viewLayersIndex[s]?mn:t,d=0;d<l.count;d++){var v=l.pool[d];if(!r||v.sc){var g=yn[v.p];g&&g(n,v,f,r,i)}}}function c(e){var n=s.pool,t=s.count;n[t]||(n[t]={}),s.count=t+1;var r=n[t];return r.id=e,r.sc=l.getColour(e+""),r.wsc=un(r.sc),null!==g&&(r.la=u),r.a=null!==g&&"x"in s?s:null,r}var u,s,l,f={},d={},h=[[],[],[],[]],v=h[0],g=null;f.getLayer=function(){return u},f.setLayer=function(e){u=e,null===g&&(v[e]||(v[e]={pool:[],count:0}),s=v[e])},f.removeAllItems=function(){d={}},f.removeItem=function(e){delete d[e]},f.resetItem=function(e,n,t){g=e.id,d[g]?d[g].count=0:d[g]={pool:[],count:0},s=d[g],s.bg=!!e.bg,s.gh=!!e.gh,arguments.length>1&&(s.x=n,s.y=t),s.count=0},f.moveItem=function(e,n,t){var r=d[e.id];r&&(r.x=n,r.y=t)},f.resetExtras=function(){for(var e=P.extraLayers,n=0;n<e.length;n++){var t=e[n];v[t]&&(v[t].count=0)}g=null},f.extras=function(){g=null};var y=f.getLast=function(){return s&&s.count>0?s.pool[s.count-1]:null};return f.cloneLast=function(){return KeyLines.Util.shallowClone(y())},f.assembleItems=function(){r(),i()},f.each=function(n,t,r){for(var i=h[t],a=e(r),o=0;U>o;o++)if((!r||a[o])&&i[o])for(var c=i[o],u=0;u<c.count;u++)n(c.pool[u])},f.itemExtents=function(e,n){var t;for(var r in d)if(!e||e[r])for(var i=d[r],a=0;a<i.count;a++){var o=i.pool[a],c=sn(n,o);t=t?ln(t,c):c}return t},f.draw=function(e,n,t,r,i){o(e,n,!1,t,r,i)},f.excludeHit=function(e){if(e){var n=d[e];if(n)for(var t=0;t<n.count;t++){var r=n.pool[t];r.sc=r.wsc=null}}},f.drawShadowCanvas=function(e,n){o(e,n,!0,null,F.BACKGROUND,P.itemLayers),o(e,n,!0,null,F.MAIN,P.shadowLayers)},f.setShadowColourMap=function(e){l=e},f.line=function(e,n,t,r,i,a,o,u){var s=c(o),l=s.a;s.p=P.primitives.line,l?(s.x1=e-l.x,s.y1=n-l.y,s.x2=t-l.x,s.y2=r-l.y):(s.x1=e,s.y1=n,s.x2=t,s.y2=r),s.c=i,s.w=a,s.ls=u,s.wc=un(i)},f.line3=function(e,n,t,r,i,a,o,u,s,l,f,d){var h=c(f),v=h.a;h.p=P.primitives.line3,v?(h.x1=e-v.x,h.y1=n-v.y,h.x2=t-v.x,h.y2=r-v.y,h.x3=i-v.x,h.y3=a-v.y,h.x4=o-v.x,h.y4=u-v.y):(h.x1=e,h.y1=n,h.x2=t,h.y2=r,h.x3=i,h.y3=a,h.x4=o,h.y4=u),h.c=s,h.w=l,h.ls=d,h.wc=un(s)},f.circle=function(e,n,t,r,i,a,o,u,s,l){var f=c(u),d=f.a;f.p=P.primitives.circle,d?(f.x=e-d.x,f.y=n-d.y):(f.x=e,f.y=n),f.r=t,f.bc=r,f.bw=i,f.fc=a,f.fi=o,f.bs=s,f.sm=l,f.wbc=un(r),f.wfc=un(a)},f.arc=function(e,n,t,r,i,a,o,u,s){var l=c(u),f=l.a;l.p=P.primitives.arc,f?(l.x=e-f.x,l.y=n-f.y):(l.x=e,l.y=n),l.r=t,l.sa=r,l.ea=i,l.bc=a,l.bw=o,l.ls=s,l.wbc=un(a)},f.text=function(e,n,t,r,i,a,o,u,s,l,f,d,h,v,g,y,m,x){var w=c(o),p=w.a;w.p=P.primitives.text,p?(w.x=e-p.x,w.y=n-p.y):(w.x=e,w.y=n),w.t=t,w.c=r,w.fs=i,w.bo=a,w.ff=u,w.xc=s,w.w=l,w.isfi=f,w.isSel=x,w.wc=un(r),w.id=o,p?(w.x1=h-p.x,w.y1=v-p.y,w.x2=g-p.x,w.y2=y-p.y):(w.x1=h,w.y1=v,w.x2=g,w.y2=y),w.back=d,d&&(w.wbc=un(m),w.bc=m)},f.image=function(e,n,t,r,i,a,o,u){var s=c(a),l=s.a;s.p=P.primitives.image,l?(s.x1=e-l.x,s.y1=n-l.y,s.x2=t-l.x,s.y2=r-l.y):(s.x1=e,s.y1=n,s.x2=t,s.y2=r),s.u=i,s.s=o,s.vx=u},f.rect=function(e,n,t,r,i,a,o,u,s,l){var f=c(s),d=f.a;f.p=P.primitives.rect,d?(f.x1=e-d.x,f.y1=n-d.y,f.x2=t-d.x,f.y2=r-d.y):(f.x1=e,f.y1=n,f.x2=t,f.y2=r),f.bc=i,f.bw=a,f.fc=o,f.fi=u,f.bs=l,f.wbc=un(i),f.wfc=un(o)},f.round=function(e,n,t,r,i,a,o,u,s,l){var f=c(l),d=f.a;f.p=P.primitives.round,d?(f.x1=e-d.x,f.y1=n-d.y,f.x2=t-d.x,f.y2=r-d.y):(f.x1=e,f.y1=n,f.x2=t,f.y2=r),f.r=i,f.bc=a,f.bw=o,f.fc=u,f.fi=s,f.wbc=un(a),f.wfc=un(u)},f.triangle=function(e,n,t,r,i,a,o,u,s,l,f){var d=c(f),h=d.a;d.p=P.primitives.triangle,h?(d.x1=e-h.x,d.y1=n-h.y,d.x2=t-h.x,d.y2=r-h.y,d.x3=i-h.x,d.y3=a-h.y):(d.x1=e,d.y1=n,d.x2=t,d.y2=r,d.x3=i,d.y3=a),d.bc=o,d.bw=u,d.fc=s,d.fi=l,d.wbc=un(o),d.wfc=un(s)},f.pentagon=function(e,n,t,r,i,a,o,u,s,l,f,d,h,v,g,y){var m=c(g),x=m.a;m.p=P.primitives.pentagon,x?(m.x1=e-x.x,m.y1=n-x.y,m.x2=t-x.x,m.y2=r-x.y,m.x3=i-x.x,m.y3=a-x.y,m.x4=o-x.x,m.y4=u-x.y,m.x5=s-x.x,m.y5=l-x.y):(m.x1=e,m.y1=n,m.x2=t,m.y2=r,m.x3=i,m.y3=a,m.x4=o,m.y4=u,m.x5=s,m.y5=l),m.bc=f,m.bw=d,m.fc=h,m.fi=v,m.bs=y,m.wbc=un(f),m.wfc=un(h)},f.copyPrimitive=function(e){var n=c(e.id);for(var t in e)n[t]=e[t]},f},P.primitives={circle:"C",arc:"A",line:"L",line3:"L3",text:"T",image:"I",rect:"R",round:"RR",triangle:"TR",pentagon:"PE"};var _="rgb(128, 128, 128)",V=P.colours={aqua:"rgb(0, 255, 255)",black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",fuchsia:"rgb(255, 0, 255)",green:"rgb(0, 128, 0)",grey:_,gray:_,lime:"rgb(0, 255, 0)",maroon:"rgb(128, 0, 0)",navy:"rgb(0, 0, 128)",olive:"rgb(128, 128, 0)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",silver:"rgb(192, 192, 192)",teal:"rgb(0, 128, 128)",yellow:"rgb(255, 255, 0)",white:"rgb(255, 255, 255)",ci:"rgb(0, 174, 239)",cia:"rgba(0, 174, 239, 0.5)",keyline:"rgb(88, 89, 91)",midgrey:"rgb(145, 146, 149)",lightgrey:"rgb(208, 209, 211)",edit:"rgb(114, 179, 0)",attention:"rgb(220, 0, 0)",information:"rgb(0, 150, 255)",description:"rgb(255, 175, 0)",textback:"rgba(255,255,255,0.6)",transparent:"rgba(255,255,255,0.0)",touch:"rgba(255,0,0,0.6)"},H=P.rgbtostring=function(e,n,t){return"rgb("+e+","+n+","+t+")"},Y=P.rgbatostring=function(e,n,t,r){return"rgba("+e+","+n+","+t+","+r+")"},G=/^(?:rgb)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?\)$/i,q=/^(?:rgba)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),\s?(0|1|0\.\d{0,20}|1\.0)\)$/i,X=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,j=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i;P.validatergb=function(e){return!!Z(e).length};var Z=P.convertrgb=function(e){var n,t=[],r=V[e.toLowerCase()];e=r?r:e;var i=e.match(G);if(i||(i=e.match(q)),i)for(n=1;4>n;n++)t.push(parseInt(i[n],10));else{if(i=e.match(j),!i&&(i=e.match(X)))for(n=1;4>n;n++)i[n]=""+i[n]+i[n];if(i)for(n=1;4>n;n++)t.push(parseInt(i[n],16))}return t},$=P.opacity=function(e){if("transparent"===e)return 0;var n=e.match(q);return n?parseFloat(n[4]):1};P.hsla=function(e){var n=Z(e),t=A(n[0],n[1],n[2]);return t.push($(e)),t},P.fromhsla=function(e){var n=D(e[0],e[1],e[2]);return Y(n[0],n[1],n[2],e[3])},P.rgbtohex=function(e){for(var n=Z(e),t="",r=0;r<n.length;r++){var i=n[r];t+=(16>i?"0":"")+i.toString(16)}return t};var J=P.randomColour=function(e){function n(){return Math.floor(255*Math.random())}var t=H(n(),n(),n());return e&&t in e?J(e):t},Q=[0,0],en=[],nn={};P.clearLastFont=function(){nn={}};var tn=P.defaultFamily="Ubuntu";P.browserMinimumFontSize=1;var rn=P.setFont=function(e,n,t,r){if(t=!!t,r=r||tn,e!==nn.context||n!==nn.fontSize||t!==nn.bold||r!==nn.family){nn.context=e,nn.fontSize=n,nn.bold=t,nn.family=r;var i=t?"bold":"normal",a="normal",o="px",c=a+" "+i+" "+n+o+" "+r;e.font=c,e.textBaseline="bottom"}};P.setAlpha=function(e,n){for(var t=["c","fc","bc"],r=0;r<t.length;r++){var i=t[r];if(i in e){var a=Z(e[i]);e[i]=Y(a[0],a[1],a[2],n)}}};var an={},on=P.alphaize=function(e,n){var t=e+n;if(!an[t]){var r=Z(e),i=$(e);an[t]=Y(r[0],r[1],r[2],i*n)}return an[t]},cn={},un=P.webglColour=function(e){if(e){if(!cn[e]){var n=Z(e),t=$(e);cn[e]=[n[0],n[1],n[2],Math.floor(255*t)]}return cn[e]}return e};P.setExtents=function(e,n,t,r,i){var a,o,c=e.a;switch(c&&(n-=c.x,t-=c.y,r-=c.x,i-=c.y),e.p){case P.primitives.circle:a=Math.abs((r-n)/2),o=Math.abs((i-t)/2),e.x=Math.floor(Math.min(n,r)+a),e.y=Math.floor(Math.min(t,i)+o),e.r=Math.floor(Math.min(a,o));
break;case P.primitives.line:case P.primitives.rect:case P.primitives.round:e.x1=Math.min(n,r),e.x2=Math.max(n,r),e.y1=Math.min(t,i),e.y2=Math.max(t,i);break;case P.primitives.line3:break;case P.primitives.text:e.x=Math.min(n,r),e.y=Math.max(t,i);break;case P.primitives.image:e.x1=Math.min(n,r),e.y1=Math.min(t,i),e.x2=Math.max(n,r),e.y2=Math.max(t,i);break;case P.primitives.triangle:case P.primitives.pentagon:}};var sn=P.extents=function(e,n){var t,r,i,a;switch(n.p){case P.primitives.circle:t=n.x-n.r,r=n.x+n.r,i=n.y-n.r,a=n.y+n.r;break;case P.primitives.line:case P.primitives.rect:case P.primitives.round:case P.primitives.image:t=Math.min(n.x1,n.x2),r=Math.max(n.x1,n.x2),i=Math.min(n.y1,n.y2),a=Math.max(n.y1,n.y2);break;case P.primitives.line3:t=Math.min(n.x1,n.x2,n.x3,n.x4),r=Math.max(n.x1,n.x2,n.x3,n.x4),i=Math.min(n.y1,n.y2,n.y3,n.y4),a=Math.max(n.y1,n.y2,n.y3,n.y4);break;case P.primitives.text:var o=gn(e,n.t,n.fs,n.bo,n.ff);t=n.x,i=n.y-o.height,r=n.x+o.width,a=n.y;break;case P.primitives.triangle:t=Math.min(n.x1,n.x2,n.x3),r=Math.max(n.x1,n.x2,n.x3),i=Math.min(n.y1,n.y2,n.y3),a=Math.max(n.y1,n.y2,n.y3);break;case P.primitives.pentagon:t=Math.min(n.x1,n.x2,n.x3,n.x4,n.x5),r=Math.max(n.x1,n.x2,n.x3,n.x4,n.x5),i=Math.min(n.y1,n.y2,n.y3,n.y4,n.y5),a=Math.max(n.y1,n.y2,n.y3,n.y4,n.y5);break;case P.primitives.arc:var c=n.x+n.r*Math.cos(n.sa),u=n.y+n.r*Math.sin(n.sa),s=n.x+n.r*Math.cos(n.ea),l=n.y+n.r*Math.sin(n.ea);t=Math.min(c,s),r=Math.max(c,s),i=Math.min(u,l),a=Math.max(u,l);for(var f=(Math.floor(n.sa/N)+1)*N;f<n.ea;){var d=n.x+n.r*Math.cos(f),h=n.y+n.r*Math.sin(f);t=Math.min(t,d),r=Math.max(r,d),i=Math.min(i,h),a=Math.max(a,h),f+=N}}var v=n.a;return v&&(t+=v.x,i+=v.y,r+=v.x,a+=v.y),{x1:t,y1:i,x2:r,y2:a}},ln=P.join=function(e,n){return{x1:Math.min(e.x1,n.x1),y1:Math.min(e.y1,n.y1),x2:Math.max(e.x2,n.x2),y2:Math.max(e.y2,n.y2)}};P.inside=function(e,n,t){return e.x1<=n&&n<=e.x2&&e.y1<=t&&t<=e.y2},P.insideCircle=function(e,n,t,r,i,a){a||(a=0);var o=Math.sqrt((e-r)*(e-r)+(n-i)*(n-i));return t>o+a},P.rectContains=function(e,n,t,r,i){return e.x1<n&&r<e.x2&&e.y1<t&&i<e.y2},P.circleContains=function(e,n,t,r,i,a,o){var c=(e-r)*(e-r)+(n-i)*(n-i),u=(e-r)*(e-r)+(n-o)*(n-o),s=(e-a)*(e-a)+(n-i)*(n-i),l=(e-a)*(e-a)+(n-o)*(n-o),f=t*t;return f>c&&f>u&&f>s&&f>l},P.intersects=function(e,n){return!(n.x1>e.x2||n.x2<e.x1||n.y1>e.y2||n.y2<e.y1)};var fn=function(e,n,t,r,i,a,o){var c=Math.floor((t.x2-t.x1)/2),u=Math.floor((t.y2-t.y1)/2),s=1,l="-resize",f=Math.floor(4*r);hn(e,n,{x:t.x1,y:t.y1},f,s,i+o+"nw"+l,a),dn(e,n,{x:t.x1+c,y:t.y1},f,s,i+o+"n"+l,a),hn(e,n,{x:t.x2,y:t.y1},f,s,i+o+"ne"+l,a),dn(e,n,{x:t.x2,y:t.y1+u},f,s,i+o+"e"+l,a),hn(e,n,{x:t.x2,y:t.y2},f,s,i+o+"se"+l,a),dn(e,n,{x:t.x2-c,y:t.y2},f,s,i+o+"s"+l,a),hn(e,n,{x:t.x1,y:t.y2},f,s,i+o+"sw"+l,a),dn(e,n,{x:t.x1,y:t.y2-u},f,s,i+o+"w"+l,a)},dn=function(e,n,t,r,i,a,o){var c=n.x(t.x),u=n.y(t.y);e.rect(c-r,u-r,c+r,u+r,o,i,V.white,!0,a)},hn=function(e,n,t,r,i,a,o){e.circle(n.x(t.x),n.y(t.y),r+1,o,i,V.white,!0,a)};P.getHandles=function(e,n,t,r,i,a,o,c){var u=sn(n,r);fn(e,t,u,i,a,o,c)},P.imageLoader=function(e,n,t,r){function i(){if(c+u===s)try{r(u>0,l)}catch(e){r("callback to image loader threw exception "+e)}}function a(){u++,i()}function o(){c++,i()}var c=0,u=0,s=0,l={};for(var f in t){s++;var d=e();d.onload=o,d.onerror=a,l[f]=d}0===s&&r(null,l);for(var h in l)l[h].src=n+h},P.clear=function(e,n,t){e.clearRect(0,0,n,t)},P.backFill=function(e,n,r,i,a){var o=t(n,r);e.webgl?e.webglCanvas.style.background=o:(e.fillStyle=o,e.fillRect(0,0,i,a))},P.backgroundGradient=function(e,n,r,i,a){if(n)if(e.webgl){for(var o="linear-gradient(",c=0,u=n.length;u>c;c++){var s=n[c];o+=t(s.c,r),o+=" "+100*parseFloat(s.r)+"%",u>c+1&&(o+=",")}o+=")",e.webglCanvas.style.background=o}else if(e.hasOwnProperty("doGradient"))e.doGradient(N,n);else{for(var l=e.createLinearGradient(0,0,0,a),f=0;f<n.length;f++)l.addColorStop(n[f].r,t(n[f].c,r));e.fillStyle=l,e.fillRect(0,0,i,a)}};var vn={},gn=P.measureText=function(e,n,t,r,i){var a=n+!!r+(i||tn),o=vn[a];return void 0===o&&(rn(e,14,r,i),o=vn[a]=e.measureText(n).width),{width:o*(t/14),height:t}},yn=r({circle:i,arc:a,line:o,line3:c,text:u,image:s,rect:l,round:f,triangle:d,pentagon:h}),mn={x:C,y:C,w:C,sw:C,dim:C};P.circularize=function(e,n,t){var r,i={},a={};for(r in e)if("updated"!==r&&"_coList"!==r&&n&&n[r]){var o=e[r].im,c=Math.min(o.width,o.height),u=c<o.height?Math.floor((o.height-c)/2):0,s=c<o.width?Math.floor((o.width-c)/2):0,l=Math.floor(c/2),f=t(c,c),d=f.getContext("2d");d.drawImage(o,s,u,c,c,0,0,c,c);var h=t(c,c),v=h.getContext("2d");v.clearRect(0,0,c,c),m(v,l,l,l,V.white,-1,V.black,!0);var g=v.getImageData(0,0,c,c).data;try{for(var y=d.getImageData(0,0,c,c),x=y.data,w=0;w<x.length;w+=4){var p=g[w+3];0===p?x[w+3]=0:255>p&&(x[w+3]=Math.floor(x[w+3]*p/255))}d.isFlash&&d.clearRect(0,0,c,c),d.putImageData(y,0,0),f.src=o.src+"#ci",a[r]=f}catch(b){i[r]=!0,a[r]=!1}}for(r in a)e[r].ci=i[r]?e[r].im:a[r]},P.colorize=function(e,n,t,r,i){var a=.02,o=Z(r),c=A(o[0],o[1],o[2]),u={},s=Z(i),l=A(s[0],s[1],s[2]),f=D(l[0],l[1],c[2]);for(var d in e)if("updated"!==d&&"_coList"!==d&&d in n&&n[d])try{var h=e[d].im,v=t(h.width,h.height),g=v.getContext("2d");g.clearRect(0,0,h.width,h.height),g.drawImage(h,0,0,h.width,h.height,0,0,h.width,h.height);for(var y=g.getImageData(0,0,h.width,h.height),m=y.data,x=0;x<m.length;x+=4){var w=A(m[x],m[x+1],m[x+2]);if(Math.abs(w[0]-c[0])<a){var p=D(l[0],l[1],w[2]);y.data[x]=p[0],y.data[x+1]=p[1],y.data[x+2]=p[2]}}g.isFlash&&g.clearRect(0,0,h.width,h.height),g.putImageData(y,0,0),v.src=h.src+i,u[d]=v}catch(b){u[d]=e[d].im}return{images:u,colour:f}}}(),!function(e){function n(e,n,t,r){r||(r=!1),e.addEventListener?e.addEventListener(n,t,r):e.attachEvent("on"+n,t)}function t(e,t){for(var r=0;r<e.length;r++)n(document,e[r],t)}function r(e){return e.pageX?e.pageX:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}function i(e){return e.pageY?e.pageY:e.clientY+document.body.scrollTop+document.documentElement.scrollTop}function a(e,n){for(var t=[],r=0;r<e[n].length;r++){var i=U(e[n][r]);t.push({id:e[n][r].identifier,x:i.x,y:i.y})}return t}function o(e){return e.target?e.target:e.srcElement}function c(e){var n=o(e),t=n.id;t in N&&(N[t].canvas||0!==e.button&&(u("down",t,n,e.button,e),s(e)))}function u(e,n,t,r,i){var a=t.getStageWidth()/t.width,o=S(n);a/=o;var c=U(i);"down"===e?(t.privateFlashClick(r),N[n].mousedown(r,c.x*a,c.y*a,i.ctrlKey,i.shiftKey)):N[n].mouseup(c.x*a,c.y*a,i.ctrlKey,i.shiftKey)}function s(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,e.preventCapture&&e.preventCapture(),e.preventBubble&&e.preventBubble()}function l(){function e(e,t){n(document,e,function(n){n.target.id in N&&(N[n.target.id][e](a(n,"targetTouches"),a(n,"changedTouches")),t&&n.preventDefault())})}function r(e){n(document,e,function(n){n.target.id in N&&(N[n.target.id][e](n.scale,n.rotation),n.preventDefault())})}function i(e,n){var t=e.pointerId||0,r=U(e),i=[];switch(n){case"ADD":z[t]||(z[t]={id:t,x:r.x,y:r.y});break;case"DEL":z[t]&&(delete z[t],K--);break;case"MOVE":z[t]&&(z[t]={id:t,x:r.x,y:r.y})}for(var a in z)i.push(z[a]);return i}function u(e,n){var t=e.pointerId||0,r=U(e),i=[];switch(n){case"ADD":case"MOVE":i=[{id:t,x:r.x,y:r.y}];break;case"DEL":i=[z[t]]}return i}function l(e){return e.pointerType===(e.MSPOINTER_TYPE_TOUCH||"touch")}function f(e){R[e]=new MSGesture,R[e].target=document.getElementById(e)}function d(){m=1,x=0}function h(e,n){return function(t){if(t.target.id in N&&l(t)){var r=u(t,n);N[t.target.id][e](i(t,n),r),t.preventDefault()}}}function v(e){function n(n){if(l(n)){var t="DEL";for(var r in N){var a=u(n,t);N[r][e](i(n,t),a);var o=n.target.id;o&&N[o]&&n.preventDefault()}}}return n}function g(e,n,t,r){if(e!==n){if(null!==n&&N[n]&&N[n].canvas&&document.getElementById(n)){var i=W(r,n);N[n][t](i.x,i.y,r.ctrlKey,r.shiftKey)}"mouseleave"===t&&(L=e)}}function y(e){var n=e.wheelDelta||-e.detail;if(0!==n){var t=o(e),r=N[t.id];if(r){var i=U(e);r.mousewheel(n,i.x,i.y),s(e)}}}n(window,"mousedown",c,!0),n(document,"contextmenu",function(e){return o(e).id in N?(s(e),!1):void 0}),n(document,"dragover",function(e){if(e.target.id in N){var n=U(e);N[e.target.id].dragover(n.x,n.y)}}),"ontouchstart"in document.documentElement&&(e("touchstart",!0),e("touchmove"),e("touchend"),e("touchcancel"),r("gesturestart"),r("gesturechange"),r("gestureend"));var m=1,x=0;if(navigator.msMaxTouchPoints||navigator.maxTouchPoints){var w=["MSPointerDown","pointerdown"],p=["MSPointerMove","pointermove"],b=["MSPointerUp","pointerup"],M=["MSPointerCancel","pointercancel"];t(w,function(e){if(e.target.id in N&&l(e)){R[e.target.id]||f(e.target.id),K++,R[e.target.id].addPointer(e.pointerId);var n=u(e,"ADD");N[e.target.id].touchstart(i(e,"ADD"),n),e.preventDefault()}}),t(p,h("touchmove","MOVE")),t(b,v("touchend")),t(M,v("touchcancel")),n(document,"MSHoldVisual",function(e){e.preventDefault()}),n(document,"MSGestureStart",function(e){var n=e.gestureObject.target.id,t=K>1;n in N&&t&&(N[n].gesturestart(),e.preventDefault())}),n(document,"MSGestureChange",function(e){var n=e.gestureObject.target.id,t=K>1&&e.detail!==e.MSGESTURE_FLAG_INERTIA;n in N&&t&&(m*=e.scale,x+=180*e.rotation/Math.PI,N[n].gesturechange(m,x),e.preventDefault())}),n(document,"MSGestureEnd",function(e){var n=e.gestureObject.target.id;n in N&&(N[n].gestureend(m,x),d(),e.preventDefault())})}n(window,"mousedown",function(e){if(e.target.id in N&&N[e.target.id].canvas){var n=U(e);N[e.target.id].mousedown(e.button,n.x,n.y,e.ctrlKey,e.shiftKey)}}),n(window,"mouseup",function(e){if(e.target.id in N&&N[e.target.id].canvas){var n=U(e);N[e.target.id].mouseup(n.x,n.y,e.ctrlKey,e.shiftKey)}S&&(g(e.target.id,S.target.id,"mouseup",S),S=null)}),n(window,"mouseout",function(e){e.target.id in N&&N[e.target.id].canvas&&(S=e)});var L=null,S=null;n(window,"mousemove",function(e){if(e.target.id in N){if(g(e.target.id,L,"mouseleave",e),N[e.target.id].canvas){var n=U(e);N[e.target.id].mousemove(n.x,n.y,e.ctrlKey,e.shiftKey)}}else g(null,L,"mouseleave",e)}),n(window,"dblclick",function(e){if(e.target.id in N&&N[e.target.id].canvas){var n=U(e);N[e.target.id].dblclick(n.x,n.y,e.ctrlKey,e.shiftKey),e.preventDefault()}}),t(["wheel","mousewheel","DOMMouseScroll"],y),n(document,"MozMousePixelScroll",function(e){N[e.target.id]&&s(e)}),n(document,"keyup",function(e){e.target&&e.target.id in N&&N[e.target.id].canvas&&N[e.target.id].keyup(e.keyCode)}),n(document,"keydown",function(e){var n=!1;e.target&&e.target.id in N&&N[e.target.id].canvas&&(n=n||N[e.target.id].keydown(e.keyCode,e.ctrlKey,e.shiftKey)),n&&e.preventDefault&&e.preventDefault()})}function f(e){e in N&&delete N[e]}function d(e){e in N||(N[e]={})}function h(e,n){var t=n?"_klidc":"_klid";if(!e[t]){var r="sink"+ ++F;KeyLines[r]=function(){var t=[].slice.call(arguments);if(n){for(var r=[],i=0;i<t.length;i++)r.push(KeyLines.Util.arrayToDict(t[i]));t=r}return e.apply(this,t)},e[t]=r}return e[t]}function v(e,n,t,r,i){var a;if(t.length>0){var o=t[t.length-1];KeyLines.Util.isFunction(o)&&(a=h(o,i),t.pop())}var c=e.callAPI(n,t,a,r,i);return i&&(c=KeyLines.Util.arrayToDict(c)),c}function g(e){function n(e,n,t,r){e[n]=function(){var e=[].slice.call(arguments);return v(i,n,e,t,r)}}function t(e){for(var t={},a=i.privateNamespaceNames(e),o=0;o<a.length;o++)n(t,a[o],e,s[e][a[o]]);r[e]=function(){return t}}for(var r=N[e],i=document.getElementById(e),a=i.privateFunctionNames(),o=i.privateFunctionDefinitions(),c=0;c<a.length;c++){var u=a[c];n(r,u,null,o[u])}var s=i.privateNamespaceDefinitions();for(var l in s)t(l)}function y(e,n){KeyLines.Util.invoke(n,new Error('Cannot create KeyLines component. No element with id "'+e+'" exists in the DOM'))}function m(e){return+e.replace(/px$/,"")}function x(e,n,t,r){function i(e,n){e?KeyLines.Util.invoke(r,e):n.options(t,function(){r&&r(null,n)})}var a=document.getElementById(n);if(!a)return y(n,r);var o=a.clientWidth||m(a.style.width),c=a.clientHeight||m(a.style.height);b(e,n,o,c,t?i:r)}function w(){V=document.createElement("span"),V.style.position="absolute",V.style.left="-10000px",V.style.top="-10000px",V.style.visibility="hidden",V.style.lineHeight="normal",V.style.fontSize="200px",V.style.fontVariant="normal",V.style.fontStyle="normal",V.style.letterSpacing="0",V.style.width="auto",V.style.height="auto",V.style.display="block",V.style.margin=0,V.style.padding=0,V.style.whiteSpace="nowrap"}function p(e,n,t){function r(){var e=V.offsetWidth,n=(new Date).getTime()-f,a=e!==s,o=0;for(l in c)e!==c[l]&&o++;a=a&&o>1,d||a||n>i?t():KeyLines.Util.nextTick(r,16)}var i=1e4,a=["sans-serif","Verdana","serif"];V.style.fontWeight=n,V.innerHTML="giItT1WQy@!-/#|";var o=!V.parentNode;o&&document.body.appendChild(V);for(var c={},u=0;u<a.length;u++)V.style.fontFamily=a[u],c[a[u]]=V.offsetWidth;var s="bold"===n?1606:1522;V.style.fontFamily=e;var l,f=(new Date).getTime(),d=e in c;r()}function b(e,n,t,r,i){f(n),t||(t=100),r||(r=100);var a="flash"!==_;if("webgl"===_&&"chart"===e&&KeyLines.webGLSupport())j(e,n,t,r,!0,i);else if(a&&X()&&M())j(e,n,t,r,!1,i);else{if("canvas"===_){var o="Could not create HTML5 canvas. Try using auto or flash mode.";return i(o),void 0}rn(e,n,t,r,i)}}function M(){return"undefined"!=typeof KeyLines.Canvas}function L(e,n){var t=N[n];t.id=function(){return n},"chart"===e?KeyLines.API.appendExtras(t):"timebar"===e&&KeyLines.TimeBar.API.appendExtras(t)}function S(e){var n=document.getElementById(e);return n?n.clientWidth/Number(n.width):void 0}function k(e){var t=document.getElementById(e),r=t.parentNode;r.addEventListener||(n(r,"mousedown",function(n){if(n.button>1&&n.srcElement.id===e){r.setCapture();var i=n.button<4?2:1;u("down",e,t,i,n)}},!0),n(r,"mouseup",function(n){n.srcElement.id===e&&u("up",e,t,null,n),r.releaseCapture()},!0))}function I(e,n){Q[e]&&en[e]&&(Q[e]=!1,en[e]=!1,k(e),L(n,e),nn[e]&&nn[e](null,N[e]))}function A(e){if("undefined"!=typeof swfobject)return e();var n=document.getElementsByTagName("head")[0],t=document.createElement("script");t.type="text/javascript",t.src=Z,t.onreadystatechange=e,t.onload=e,n.appendChild(t)}function E(){return D(["webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullScreenElement"])}function D(e){for(var n=KeyLines.Util.defined,t=0;t<e.length;t++)if(n(document[e[t]]))return!!document[e[t]];return!1}function C(e){var n=KeyLines.Util.defined;return n(document.webkitCurrentFullScreenElement)?document.webkitCurrentFullScreenElement===e:n(document.mozFullScreenElement)?document.mozFullScreenElement===e:n(document.msFullscreenElement)?document.msFullscreenElement===e:void 0}function O(e,n){for(var t,r=0;!t&&r<n.length;r++)e[n[r]]&&(t=!0,e[n[r]]())}function T(e){O(e,["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen"])}function P(){an&&an(E())}if(e){var N=KeyLines.components={};KeyLines.charts=N;var z={},K=0,R={};l();var U=KeyLines.coords=function(e){return W(e,o(e).id)},W=function(e,n){var t=B(n),a=Math.floor(r(e)-t.left),o=Math.floor(i(e)-t.top);return{x:a,y:o}},B=KeyLines.getOffset=function(e){var n=document.getElementById(e),t={top:0,left:0};n&&(t=n.getBoundingClientRect());var r=window.pageXOffset||0===window.pageXOffset?window.pageXOffset:document.body.scrollLeft,i=window.pageYOffset||0===window.pageYOffset?window.pageYOffset:document.body.scrollTop;return{top:t.top+i-document.documentElement.clientTop,left:t.left+r-document.documentElement.clientLeft}},F=0,_="auto";KeyLines.mode=function(e){return e&&(_=e),_},KeyLines.createChart=function(){var e,n,t,r;switch(arguments.length){case 0:throw new Error("createChart called with zero arguments");case 1:case 2:e=arguments[0],r=arguments[1];var i=document.getElementById(e);if(!i)return y(e,r);n=i.clientWidth,t=i.clientHeight;break;default:e=arguments[0],n=Number(arguments[1]),t=Number(arguments[2]),r=arguments[3]}b("chart",e,n,t,r)},KeyLines.create=function(e,n){var t=KeyLines.Util,r=t.ensureArray(e);if(r.length<1)return t.invoke(n,new Error("No definition passed to KeyLines.create")),void 0;var i=0,a=[],o=function(){var e=r[i],c=e.id||e;x(e.type||"chart",c,e.options,function(e,c){if(e)t.invoke(n,e);else if(a[i]=c,i++,i>=r.length){var u=1===i?c:a;n&&n(null,u)}else o()})};KeyLines.fontsLoader([KeyLines.Rendering.defaultFamily],o)};var V,H={};KeyLines.fontsLoader=function(e,n){function t(){var n=e[a];H[n]?KeyLines.Util.nextTick(r,0):(H[n]=!0,p(n,i[0],function(){p(n,i[1],r)}))}function r(){a===e.length-1?(V.parentNode&&V.parentNode.removeChild(V),n()):(a++,t())}if(!e.length||!X())return KeyLines.Util.invoke(n);var i=["normal","bold"];V||w();var a=0;t()},KeyLines.getFontIcon=function(e){V||w(),document.body.appendChild(V);var n=e.replace(/\./g,"");V.className!==n&&(V.className=n);var t=window.getComputedStyle(V,":before").getPropertyValue("content");return V.parentNode&&V.parentNode.removeChild(V),V.className="",t.charCodeAt(1)||t.charCodeAt(0)};var Y,G,q=KeyLines.setCanvasPaths=function(e){Y=e};KeyLines.imageBasePath=function(e){return e&&(G=e),G},q("assets/");var X=KeyLines.html5CanvasSupport=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},j=function(e,n,t,r,i,a){d(n);try{N[n]=KeyLines.Canvas.create(e,n,t,r,Y,G,i)}catch(o){if(a)return a(o)}N[n].webgl=i,N[n].canvas=!0,L(e,n),a&&a(null,N[n])};KeyLines.flashInitialized=function(e,n){d(e),g(e),N[e].canvas=!1,en[e]=!0,I(e,n)},KeyLines.setSize=function(e,n,t){if(!(0>=n||0>=t)){var r=document.getElementById(e);r&&(r.style.height=t+"px",r.style.width=n+"px",N[e]&&N[e].canvas&&N[e].internalSetSize(n,t,1))}},KeyLines.getElementWidth=function(e){var n=document.getElementById(e);return n?n.clientWidth:void 0};var Z,$,J,Q={},en={},nn={},tn=KeyLines.setFlashPaths=function(e,n,t){$=e,Z=n,J=t},rn=function(e,n,t,r,i){nn[n]=i,Q[n]=!1,en[n]=!1,A(function(){var a={identifier:n,widget:e,assets:Y},o={menu:"false",quality:"best",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"},c={};"undefined"!=typeof swfobject&&(Q[n]||swfobject.embedSWF($,n,t,r,"10.0.0",J,a,o,c,function(t){t.success?(Q[n]=!0,I(n,e)):i("swfobject embedSWF returned error "+t)}))})};KeyLines.paths=function(e){return e&&(e.assets&&q(e.assets),e.flash&&tn(e.flash.swf,e.flash.swfObject,e.flash.expressInstall),e.images&&KeyLines.imageBasePath(e.images)),{assets:Y,flash:{swf:$,swfObject:Z,expressInstall:J},images:G}},document.addEventListener&&t(["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],P),KeyLines.fullScreenCapable=function(){if(!document.addEventListener)return!1;var e=KeyLines.Util.defined;return e(document.webkitCurrentFullScreenElement)?!0:e(document.mozFullScreenElement)?!0:e(document.msFullscreenEnabled)?document.msFullscreenEnabled:!1};var an;KeyLines.toggleFullScreen=function(e,n){document.addEventListener&&(an=n,E()?C(e)?O(document,["cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen"]):T(e):T(e))},KeyLines.dashedLineSupport=function(){if(X()){var e=document.createElement("canvas"),n=e.getContext("2d");return!!n.setLineDash||!!n.mozDash||!!n.webkitLineDash}return!1},KeyLines.hasConsole=function(){return"undefined"!=typeof console}}}("undefined"!=typeof window),!function(){"use strict";var e=KeyLines.Generator={};e.create=function(e){function n(){return q||en.colours.white}function t(e){return Math.abs(e)<1e-5}function r(e,n,t,r,i,a,o){return{x:((a-r)*t-(o-i)*n)/e,y:((a-r)*n+(o-i)*t)/e}}function i(e){return e.hasOwnProperty("t")&&e.t}function a(e,n,i,a,o,c,u,s,l,f){var d=r(n,i,a,o,c,u,s),h=r(n,i,a,o,c,l,f);e/=n;var v=e/2;if(d.y>v&&h.y>v||d.y<-v&&h.y<-v)return 0/0;if(t(h.y-d.y))return Math.max(d.x,h.x);var g,y=d.y>h.y?d:h,m=d.y>h.y?h:d;g=v<y.y?y.x-(y.y-v)*(y.x-m.x)/(y.y-m.y):y.x;var x;return x=m.y<-v?m.x-(m.y- -v)*(m.x-y.x)/(m.y-y.y):m.x,Math.max(g,x)}function o(e,n,t,r,i,o,c,u){for(var s=-1/0,l=c.length,f=0;l>f;f+=2){var d=(f+2)%l,h=a(e,n,t,r,i,o,c[f]+u.x,c[f+1]+u.y,c[d]+u.x,c[d+1]+u.y);isNaN(h)||(s=Math.max(s,h))}return s}function c(e,n,t,r,i,a,c,u){return o(e,n,t,r,i,a,[c.x1,c.y1,c.x2,c.y1,c.x2,c.y2,c.x1,c.y2],u)}function u(e,n,t,r,i,a){for(var u,s=-1/0,l=Math.sin(-t),f=Math.cos(-t),d=a._cl,h=0;h<d.length;h++)u=d[h].length?o(e,n,l,f,r,i,d[h],a):c(e,n,l,f,r,i,d[h],a),s=Math.max(s,u);return s}function s(e,n,t,r,i,a){var o=0;return r._c&&(o=r._c/n),r._cl&&(o=Math.max(o,u(e,n,t,i,a,r))),o}function l(e,n,r,i,a,o,c,u,l,f,d){var h={},v=r-e,g=i-n,y=Math.sqrt(v*v+g*g);if(t(y))h.skip=!0;else{var m=Math.atan2(g,v),x=s(Y&&u?0:a,y,m,o,e,n),w=s(Y&&l?0:a,y,m+Math.PI,c,r,i);f=f||0,d=d||0,x=Math.max(f,x),w=Math.max(d,w);var b=1-(x+w),M=0;if(u||l){var L=p(a)*Math.cos(gn);M=L/y,u&&l&&(M=1.5*M)}h.skip=b<Math.max(.1,M),h.skip||(h.cx1=e+x*v,h.cy1=n+x*g,h.cx2=r+w*-v,h.cy2=i+w*-g)}return h}function f(e,n,t,r,i,a,o){var c=[],u=a-r,s=o-i,l=r-e,f=i-n,d=u*u+s*s,h=2*(u*l+s*f),v=l*l+f*f-t*t,g=h*h-4*d*v;if(g>=0){var y=Math.sqrt(g),m=(-h-y)/(2*d),x=(-h+y)/(2*d);if(m>=0&&1>=m){var w=r+m*u,p=i+m*s;c.push(Math.atan2(p-n,w-e))}if(x!==m&&x>=0&&1>=x){var b=r+x*u,M=i+x*s;c.push(Math.atan2(M-n,b-e))}}return c}function d(e,n,t,r,i,a){var o=r-n;if(Math.abs(o)>t)return[];var c=Math.max(i,a),u=Math.min(i,a);if(e-t>c||u>e+t)return[];var s=Math.asin(o/t),l=t*Math.cos(s),f=[];return e-l>=u&&c>=e-l&&f.push(o>0?Math.PI-s:-Math.PI-s),e+l>=u&&c>=e+l&&f.push(s),f}function h(e,n,t,r,i,a){var o=r-e;if(Math.abs(o)>t)return[];var c=Math.max(i,a),u=Math.min(i,a);if(n-t>c||u>n+t)return[];var s=Math.acos(o/t),l=t*Math.sin(s),f=[];return n-l>=u&&c>=n-l&&f.push(-s),n+l>=u&&c>=n+l&&f.push(s),f}function v(e,n,t,r,i,a,o){var c=Math.PI,u=o?r:i;if(a._c&&(u+=(o?1:-1)*a._c/t),a._cl&&a._cl.length>0)for(var s=0;s<a._cl.length;s++){var l,v,g=a._cl[s],y=a.x,m=a.y;if(g.length)for(v=[],l=0;l<g.length;l+=2){var x=(l+2)%g.length,w=f(e,n,t,g[l]+y,g[l+1]+m,g[x]+y,g[x+1]+m);v=v.concat(w)}else{var p=d(e,n,t,g.y2+m,g.x1+y,g.x2+y),b=d(e,n,t,g.y1+m,g.x1+y,g.x2+y),M=h(e,n,t,g.x1+y,g.y1+m,g.y2+m),L=h(e,n,t,g.x2+y,g.y1+m,g.y2+m);v=p.concat(b,L,M)}for(l=0;l<v.length;l++)v[l]+2*Math.PI<i&&(v[l]+=2*Math.PI),r<v[l]&&v[l]<i&&(o?v[l]-u<c&&(u=Math.max(u,v[l])):u-v[l]<c&&(u=Math.min(u,v[l])))}return u}function g(e,n,t,r,i,a,o,c){var u=v(n,t,r,i,a,e>0?o:c,!0),s=v(n,t,r,u,a,e>0?c:o,!1);return{startangle:u,endangle:s}}function y(e,n){var t=n(e.id),r=dn(e),i=C("b",e,t),a=C("c",e,t);return!(!i&&!a||r)}function m(e,n,t,r,i,a,o,c,u,s,l,f,d,h,v,m,x){var w=(s+f)/2,p=(l+d)/2,M=f-s,L=d-l;a=Number(a);var S=a>0,k=Math.max(.001,L*L+M*M),I=Math.sqrt(k),A=(k/4+a*a)/(2*Math.abs(a)),E=A-Math.abs(a),D=S?1:-1,C=w-L*D*E/I,O=p+M*D*E/I,T=Math.atan2(l-O,s-C),P=Math.atan2(d-O,f-C),N=S?T:P,z=S?P:T;N>z&&(z+=2*Math.PI),r=r||0,i=i||0;var K=N+(S?r:i)*(z-N),R=N+(S?1-i:1-r)*(z-N),U=g(a,C,O,A,N,z,c,u);if(U.startangle=Math.max(K,U.startangle),U.endangle=Math.min(R,U.endangle),!(U.startangle>=U.endangle)){var W=(U.startangle+U.endangle)/2,B={};B.lx=C+A*Math.cos(W),B.ly=O+A*Math.sin(W);var F,_,V,H,G,q,X=1.5*v/A,j=-.25;return n?(F=S?U.startangle:U.endangle,_=C+A*Math.cos(F),V=O+A*Math.sin(F),S?U.startangle+=X:U.endangle-=X):Y&&y(c,x)&&(S?U.startangle+=j*X:U.endangle-=j*X),t?(H=S?U.endangle:U.startangle,G=C+A*Math.cos(H),q=O+A*Math.sin(H),S?U.endangle-=X:U.startangle+=X):Y&&y(u,x)&&(S?U.endangle-=j*X:U.startangle+=j*X),U.startangle<U.endangle&&(A>1e5?e.line(s,l,f,d,h,v,o,m):e.arc(C,O,A,U.startangle,U.endangle,h,v,o,m),n&&b(e,_,V,v,.66*+D*X+F-D*Math.PI/2,h,o+an+"a1"),t&&b(e,G,q,v,.66*-D*X+H+Math.PI-D*Math.PI/2,h,o+an+"a2")),B}}function x(e,n,t,r,i,a,o,c,u,s,f,d,h,v,g,m){var x=l(u,s,f,d,v,o,c,n,t,r,i);if(!x.skip){var w,p,M,L,S,k,I=x.cx1,A=x.cy1,E=x.cx2,D=x.cy2,C=E-I,O=D-A,T=Math.max(.001,O*O+C*C),P=Math.sqrt(T),N=.25;n?(w=Math.atan2(O,C),M=I,L=A,I+=1.5*v*C/P,A+=1.5*v*O/P):Y&&y(o,m)&&(I-=N*v*C/P,A-=N*v*O/P),t?(p=Math.atan2(O,C),S=E,k=D,E-=1.5*v*C/P,D-=1.5*v*O/P):Y&&y(c,m)&&(E+=N*v*C/P,D+=N*v*O/P),e.line(I,A,E,D,h,v,a,g),n&&b(e,M,L,v,w+Math.PI,h,a+an+"a1"),t&&b(e,S,k,v,p,h,a+an+"a2");var z={};return z.lx=(I+E)/2,z.ly=(A+D)/2,z}}function w(e,t,r,a,o,c,u){function s(e){return h&&J&&$.hasOwnProperty(e)?$[e]:r[e]}if(!r.hi){r._edit=null;var l,f,d=r.id,h=u(d),v=h&&!J,g=s("b1"),y=s("b2"),w=s("c"),p=s("fb"),b=s("fbc"),k=s("fc"),I=s("ff"),E=s("fs"),D=s("ls"),C=s("w"),O=a.x,T=a.y,P=o.x,N=o.y,z=(C||1)*En,K=w||en.colours.midgrey,R=0;f=r.off?m(t,r.a1,r.a2,g,y,r.off,d,a,o,O,T,P,N,K,z,D,u):x(t,r.a1,r.a2,g,y,d,a,o,O,T,P,N,K,z,D,u);var W=f?f.lx:(O+P)/2,B=f?f.ly:(T+N)/2;if(r._x=W,r._y=B,f){var F=f.lx,V=f.ly,H=F,Y=V,G=fn(r);E=Number(E||tn)*En;var q=!1,X=k||en.colours.black,j=b||en.colours.textback;v&&(X=n(),j=ln());var Z=L(r),Q=S(Z,e,E,p,I),nn=E+3*En;R=nn*Z.length,Z.length>0&&(H-=Q[0]/2);for(var rn=(Z.length-1)*nn,on=f.above?V-(rn+nn/2+z/2):V-rn/2,cn=0;cn<Z.length;cn++){0===cn&&(Y=on);var un=A(e,t,Z[cn],F,on,d,!0,X,j,p,r,!1,!0,99,Q[cn],v,E,I||_);q=q||un,on+=nn}var sn=!i(r)||!q;if(sn&&v&&!G&&t.circle(F,V,E/2,en.colours.white,-1,ln(),!0,d),G){var dn=vn;sn?H+=(r.g.length-1)*dn/2:H-=hn;var gn=H;if(sn&&v){for(l=r.g.length-1;l>=0;l--)t.circle(H,Y,.6*dn,en.colours.white,-1,ln(),!0,d),H-=dn;H=gn}for(l=r.g.length-1;l>=0;l--)U(t,e,d+an+l,H,Y,1,r.g[l],c),H-=dn}}M(a,"id1",d,O,T,t,z,K),M(o,"id2",d,P,N,t,z,K)}}function p(e){return 1.7*e+En*("small"===F?6:10)}function b(e,n,t,r,i,a,o){var c=p(r),u=i+Math.PI;e.triangle(n+c*Math.cos(u+gn),t+c*Math.sin(u+gn),n+c*Math.cos(u-gn),t+c*Math.sin(u-gn),n,t,a,-1,a,!0,o)}function M(e,n,t,r,i,a,o,c){e.du&&a.circle(r,i,1.5*o,c,o,en.colours.white,!0,t+an+n)}function L(e){return e.t?(e.t+"").split(/\r\n|\r|\n/):[""]}function S(e,n,t,r,i){for(var a=[],o=0;o<e.length;o++)a[o]=en.measureText(n,e[o],t,r,i||_).width;return a}function k(e){for(var n=0,t=0;t<e.length;t++)n=Math.max(n,e[t]);return n}function I(e,n,t,r,i,a,o,c,u,s,l,f,d,h,v,g,y){var m=en.measureText(e,t,g,s,y).width;return A(e,n,t,r,i,a,o,c,u,s,l,f,d,h,m,v,g,y)}function A(e,n,t,r,i,a,o,c,u,s,l,f,d,h,v,g,y,m){var x=!0;0===t.length&&(x=!1);var w=a+an+"t";if(f&&v>h)return I(e,n,t,r,i,a,o,c,u,s,l,f,d,h,g,.85*y,m);var p,b=4*En,M=r-v/2;p=d?i+1+y/2:i+(1+y)/2;var L={x1:M-b,y1:p-y,x2:M+v+b,y2:p};if(x){var S=d?un:0;n.text(r,p+S,t,c,y,s,w,m,!0,v,!1,o,L.x1,L.y1,L.x2,L.y2,u,g)}return l&&"node"===l.type&&(L.x1=L.x1-l.x,L.y1=L.y1-l.y,L.x2=L.x2-l.x,L.y2=L.y2-l.y),l&&E(l,L,y,x),x}function E(e,n,t,r){e._edit?(e._edit.x1=Math.min(e._edit.x1,n.x1),e._edit.x2=Math.max(e._edit.x2,n.x2),e._edit.y1=Math.min(e._edit.y1,n.y1),e._edit.y2=Math.max(e._edit.y2,n.y2)):(e._edit=n,e._edit.fs=t),G&&r&&e._cl&&e._cl.push(n)}function D(e,n){var t=e.getLayer(),r=en.selMap[t];r&&e.setLayer(r),n(),r&&e.setLayer(t)}function C(e,n,t){return t&&Z&&j.hasOwnProperty(e)?j[e]:n[e]}function O(e,n){return n?Mn[e.sh]?e.sh:"box":e.sh in Mn?e.sh:e.sq?"box":"circle"}function T(e,n,t,r,i,a,o,c,u){var s=r+a,l=i+a;if("circle"===e){var f=Math.min(s,l);o(f)}else{var d=n-s,h=t-l,v=n+s,g=t+l;if("box"===e)c(d,h,v,g);else{var y=a*bn,m=r*xn/mn+a*pn;"e"===e?(v-=y,u(v,h,n+m,t,v,g,d,g,d,h)):(d+=y,u(d,g,n-m,t,d,h,v,h,v,g))}}}function P(e,n,t,r,i,a,o,c,u,s,l,f,d){T(d,n,t,r,i,a,function(r){e.circle(n,t,r,o,c,s,l,f,u)},function(n,t,r,i){e.rect(n,t,r,i,o,c,s,l,f,u)},function(n,t,r,i,a,d,h,v,g,y){e.pentagon(n,t,r,i,a,d,h,v,g,y,o,c,s,l,f,u)})}function N(e,n,t,r,i,a,o){T(o,n,t,r,i,a,function(n){e._c=n},function(r,i,a,o){e._cl.push({x1:r-n,y1:i-t,x2:a-n,y2:o-t})},function(r,i,a,o,c,u,s,l,f,d){e._cl.push([r-n,i-t,a-n,o-t,c-n,u-t,s-n,l-t,f-n,d-t])})}function z(e,n,t,r,i){function a(e){return C(e,t,s)}if(!t.hi&&!t.du){var o=t.id,c=dn(t),u=O(t,c),s=i(o),l=s&&!Z,f=a("b"),d=a("bs"),h=a("c"),v=(c?1:a("e")||1)*En,g=c?a("re"):!1,y=a("u"),m=a("fi");t._c=0,t._cl=[],t._edit=null;var x,w,p=!!f,b=!!h,M=!!y||!(!m||!m.t),L=p?f:en.colours.white,S=p?v*(a("bw")||yn):0,k=b?h:en.colours.white,I=t.x,A=t.y;c?(x=t.w/2,w=t.h/2):x=w=v*mn;var E,T=x+S/2,z=w+S/2,R=p?S:v*yn,U=3*R/4;if(E=Y?p||b?S/2:U-R/2:U+R/2,(p||b)&&P(n,I,A,T,z,0,L,S||-1,d,k,b,o,u),(M||p||b)&&(N(t,I,A,T,z,E,u),s&&(g&&!M&&(In=n.cloneLast()),l))){var B=ln();D(n,function(){P(n,I,A,T,z,U,B,R,null,B,!1,o,u),g&&(kn=n.getLast())})}M&&(y?n.image(I-x,A-w,I+x,A+w,r+y,o,t.ci?"ci":void 0,1):W(n,o,I,A,x,m.t,m.c||en.colours.black,V),s&&g&&(In=n.cloneLast())),K(n,e,I,A,S,x,w,t,c,u,p,b,M,l,v,o,r,a)}}function K(e,t,r,a,o,c,u,s,l,f,d,h,v,g,y,m,x,w){var p,b=r,M=a,k=fn(s),I=!1,E=w("fb"),D=w("fbc"),C=w("fc"),O=w("ff"),T=(w("fs")||tn)*y,P=3*y+T/2,N=C?C:en.colours.black,z=D?D:en.colours.textback;g&&(N=n(),z=ln());var K=a+u+P,R=L(s),W=S(R,t,T,E,O),F=T+3,V=F;F*R.length,R.length>0&&(b-=W[0]/2);var H=!1;if(l?s.tc&&(H=!0):v||(H=!0),H)if(!k||d||h||v)K=a-(R.length-1)*V/2;else{var Y=hn*y;b=r+Y,r+=W[0]/2+Y,K=a,a+=(R.length-1)*V/2,s._c=Y}var G=r;if(("e"===f||"w"===f)&&(d||h)){var q=8*y;G+="e"===f?q:-q}R.length>0&&(M=K),d&&(v||l&&!s.tc)&&(K+=o-3*y);for(var X=0;X<R.length;X++){var j=A(t,e,R[X],G,K,m,!0,N,z,E,s,!1,!0,99,W[X],g,T,O||_);I=I||j,K+=V}var Z=!i(s)||!I;if(k)if(v||d||h){var $=3,J=v?11:3;if(!l&&!v&&"circle"===f){var Q=2;$+=Q,J+=Q}l&&($++,J++);var nn=$*y,rn=J*y;if(s.g.length)for(p=0;p<s.g.length;p++){var on,cn=s.g[p],un=null,sn=!1;switch(cn.p){case"ne":un=c-nn,on=-u+rn;break;case"nw":un=-c+nn,on=-u+rn,sn=!0;break;case"sw":un=-c+nn,on=u-rn,sn=!0;break;case"se":un=c-nn,on=u-rn}null!==un&&U(e,t,m+an+cn.p,s.x+un,s.y+on,y,cn,x,sn,!0)}}else{var dn=vn*y;Z?b+=(s.g.length-1)*dn/2:b-=hn*y;var gn=b;if(Z&&g){for(p=s.g.length-1;p>=0;p--)e.circle(b,M,.6*dn,en.colours.white,-1,ln(),!0,m),b-=dn;b=gn}for(p=s.g.length-1;p>=0;p--)U(e,t,m+an+p,b,M,y,s.g[p],x),b-=dn}l||B(e,m,r,a,y,w)}function R(e,n){var t=0,r=0;if(i(e)){var a=(e.fs?e.fs:tn)*(e.e?e.e:1),o=L(e),c=S(o,n,a,e.fb,e.ff);t=k(c),r=a*(o.length+1),e.u||(t/=10)}return{width:t,height:r}}function U(e,n,t,r,i,a,o,c,u,s){if(o){var l=o.a?Sn:1,f=9*a*l,d="b"in o?o.b:en.colours.keyline,h=d?2*a:-1,v=!!(o.u||o.fi&&o.fi.t);if(o.c){if(o.t){var g,y=o.hasOwnProperty("fb")?o.fb:!0,m=o.fc||en.colours.white,x=o.ff||_,w=a*rn[1]*l,p=(o.t+"").substring(0,25),b=en.measureText(n,p,w,y,x).width;if(o.w&&s){g=Math.max(b,f);var M,L,S=f;u?(M=r-(g-S)-f,L=r+f,r-=(g-S)/2):(M=r-f,L=r+(g-S)+f,r+=(g-S)/2),e.round(M,i-f,L,i+f,f,d,h,o.c,!0,t)}else e.circle(r,i,f,d,h,o.c,!0,t),p=(o.t+"").substring(0,4),w=a*rn[p.length-1]*l,g=1.7*f;
A(n,e,p,r,i,t,!1,m,en.colours.white,y,null,!0,!1,g,b,!1,w,x)}else if(e.circle(r,i,f,d,h,o.c,!0,t),v){var k=f/1.41421;o.u?e.image(r-k,i-k,r+k,i+k,c+o.u,t):W(e,t,r,i,k,o.fi.t,o.fi.c||en.colours.black,V)}}else v&&(o.u?e.image(r-f,i-f,r+f,i+f,c+o.u,t):W(e,t,r,i,f,o.fi.t,o.fi.c||en.colours.black,V));o.a&&(An=An||{},An[nn.rawId(t)]=!0)}}function W(e,n,t,r,i,a,o,c){e.rect(t-i,r-i,t+i,r+i,en.colours.transparent,-1,en.colours.transparent,!0,n),e.text(t,r+i,a,o,2*i,!1,n,c,!0,null,!0,n)}function B(e,n,t,r,i,a){var o=e.getLayer();e.setLayer(en.layers.HALOS);for(var c=0;c<Ln.length;c++){var u=Ln[c],s=a(u);if(s){var l=n+an+u,f=s.r*i,d=s.w*i;d/2>=f?e.circle(t,r,f+d/2,en.colours.white,-1,s.c,!0,l,null,!0):e.circle(t,r,f,s.c,d,en.colours.white,!1,l,null,!0)}}e.setLayer(o)}var F,_,V,H,Y,G,q,X,j,Z,$,J,Q={},en=KeyLines.Rendering,nn=KeyLines.Util,tn=Q.fontSize=14,rn=[12,9,7,7],an=nn.idSep(),on=1,cn=2,un=0,sn=!1;Q.setDashSupport=function(e){sn=!!e};var ln=Q.editColour=function(){return H||en.colours.edit};Q.setOptions=function(e){F=e.arrows,nn.isNumber(e.labelOffset)&&(un=e.labelOffset),H=e.selectionColour,X=e.fanLength,_=e.fontFamily,V=e.iconFontFamily,G=e.linkEnds.avoidLabels,Y="loose"!==e.linkEnds.spacing,q=e.selectionFontColour,j=e.selectedNode,Z=nn.isNormalObject(e.selectedNode),$=e.selectedLink,J=nn.isNormalObject(e.selectedLink)};var fn=Q.itemHasGlyph=function(e){return e.hasOwnProperty("g")&&nn.isArray(e.g)&&e.g.length>0},dn=Q.shapeTest=function(e){return isFinite(e.w)&&isFinite(e.h)},hn=13,vn=21,gn=Math.PI/7;Q.labelPosition=function(e,n){if(!e||e.hi)return null;var t=e._edit,r=t.x1,i=t.y1,a=t.x2,o=t.y2;return"node"===e.type&&(r+=e.x,i+=e.y,a+=e.x,o+=e.y),{x1:n.x(r),y1:n.y(i),x2:n.x(a),y2:n.y(o),fs:n.dim(t.fs)}};var yn=4,mn=27,xn=50,wn=xn-mn,pn=Math.sqrt(mn*mn+wn*wn)/mn,bn=1-Math.sin(Math.atan2(mn,wn)/2),Mn={box:!0,circle:!0,e:!1,w:!1};Q.nodeSize=function(e,n,t){if(e.w&&e.h)return nn.len(e.w,e.h)/2;if(e.du)return 10;var r=mn*(e.e?e.e:1),i=R(e,n);if(t){var a=r+i.height/2,o=i.width/2;return nn.len(o,a)}return r+i.height/2};var Ln=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];Q.contains=function(e,n){function t(e,n){e&&a.push(n)}var r,i,a=[];if(e=nn.defaults(e,{sh:"box",x:0,y:0}),dn(e))if("circle"===e.sh){var o=Math.min(e.w,e.h)/2;for(i in n)r=n[i],dn(r)?"circle"===r.sh?t(en.insideCircle(e.x,e.y,o,r.x,r.y,Math.min(r.w,r.h)/2),r.id):t(en.circleContains(e.x,e.y,o,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id):t(en.insideCircle(e.x,e.y,o,r.x,r.y),r.id)}else{var c={x1:e.x-e.w/2,y1:e.y-e.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2};for(i in n)if(r=n[i],dn(r))if("circle"===r.sh){var u=Math.min(r.w,r.h)/2;t(en.rectContains(c,r.x-u,r.y-u,r.x+u,r.y+u),r.id)}else t(en.rectContains(c,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id);else t(en.inside(c,r.x,r.y),r.id)}return a};var Sn,kn,In,An,En=1;return Q.getResizePrimitive=function(){return In},Q.animated=function(){return!!An},Q.generate=function(n,t,r,i,a,o,c,u,s,l){function f(e){a.resetItem(e,e.x,e.y),a.setLayer(dn(e)?en.layers.SHAPES:en.layers.NODES),z(o,a,e,s,l)}function d(e){a.resetItem(e),a.setLayer(en.layers.LINKS),w(o,a,e,n[e.id1],n[e.id2],s,l)}if(In&&(r||i[In.id]===cn)&&(kn=null,In=null),An=null,Sn=e.atanEasing((new Date).getTime()%1e3/1e3),En=c.getUnzoom(),r){a.removeAllItems();for(var h in n)f(n[h]);for(var v in t)d(t[v])}else{var g;for(g in i){var y=n[g];y?i[g]===on?a.moveItem(y,y.x,y.y):f(y):t[g]||a.removeItem(g)}for(g in i)t[g]&&d(t[g])}return a.assembleItems(),An},Q.generateHandles=function(e,n,t,r){e.extras(),e.setLayer(en.layers.HANDLES),kn&&1===r.length&&en.getHandles(e,n,t,kn,1,kn.id,ln(),an)},Q}}(),!function(){var e=KeyLines.Overlays={};e.createOverlays=function(e,n,t){function r(e,n){return y[e]=n?!0:!1,e}function i(){return t&&t.api.isShown()}function a(){return t&&t.internalUse.isMapLoaded()}function o(){m=s.colours.ci,x=s.colours.cia}function c(e){g[e]&&g[e].apply(null,arguments)}function u(e,n,t,r,i,a,o){e.rect(n.scale(t),n.scale(r),n.scale(i),n.scale(a),s.colours.transparent,-1,s.colours.transparent,!0,o)}var s=KeyLines.Rendering,l=KeyLines.Util,f={},d={},h={},v=[],g={},y={};f.appendImageList=function(e){for(var n in y)e[n]=1};var m,x;o(),f.colorize=function(e,n,t){var r,i={},a="rgb(0,174, 234)";if(t){var c=s.colorize(e,y,n,a,t);r=c.colour,i=c.images,m=s.rgbtostring(r[0],r[1],r[2]),x=s.rgbatostring(r[0],r[1],r[2],.5)}else o();for(var u in e)if("updated"!==u&&"_coList"!==u){var l=i[u]?i[u]:e[u].im;e[u].co=l,e.updated=!0}},f.setup=function(){w(),e.bind("click",c)},f.createDragger=function(e,n,t){return e in d?d[e](n,t):null};var w=f.reset=function(){d={},h={},v=[],g={},y={},e.unbind("click",c)};f.getCursor=function(e){return e in h?h[e]:"auto"},f.generate=function(e,n,t,r,i,a,o){for(var c=0;c<v.length;c++)v[c].generate(e,n,t,r,i,a,o)},f.getWatermarkSize=function(e,n){for(var t=0;t<v.length;t++){var r=v[t];if(r.watermarkSize)return r.watermarkSize(e,n)}return null},f.addLogo=function(e,n){var t=15,i="_logo",a=e+n.u,o={generate:function(e,r,o,c){e.setLayer(s.layers.OVERLAYS);var u=c[a].im,l=n.p||"ne",f=("w"===l.charAt(1)?t:o.width()-(u.width+t))+(n.x||0),d=("n"===l.charAt(0)?t:o.height()-(u.height+t))+(n.y||0);e.image(o.scale(f),o.scale(d),o.scale(f+u.width),o.scale(d+u.height),a,i)}};v.push(o),r(a)},f.addTextWatermark=function(e,n,t,i,a,o,c,u){var l="_textWatermark",f={watermarkSize:function(r,i){var a,o;if(e&&i){var c=i[e].im;a=c.width,o=c.height}else n&&(a=s.measureText(r,n,t,u).width,o=t);return a?{width:a+10,height:o+10}:null},generate:function(r,f,d,h){var v,g;if(r.setLayer(s.layers.UNDERLAYS),e){var y=h[e].im;return v=d.scale((d.width()-y.width)/2),g=d.scale((d.height()-y.height)/2),r.image(v,g,v+d.scale(y.width),g+d.scale(y.height),e,l),void 0}if(n){var m=d.scale(t),x=s.measureText(f,n,t,u).width;v=d.scale((d.width()-x)/2),g=d.scale((d.height()+t)/2);var w=Math.floor(m/4),p=Math.floor(m/8);"top"===c&&(g=m+p),"bottom"===c&&(g=d.scale(d.height())+1),o&&r.rect(v-w,g-m-p,v+x+w+p,g,o,-1,o,!0,l),r.text(v,g,n,i,m,a,l,u,!1,x,!1,!1,v+w,g-m,v+x+w,g)}}};v.push(f),e&&r(e)},f.addNavigation=function(n,o,c,l){function f(){return n.options().handMode}function y(e,t){var r=e-p[L].im.height/2,i=x(r);n.setZoom(i,t)}function m(e){var n;return n=a()?t.internalUse.zoom():(Math.log(e)-Math.log(o.getMinZoom()))/(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom())),Math.floor(N+(1-n)*(z-N))}function x(e){var n,r=1-(e-N)/(z-N);return n=i()?t.internalUse.getMaxZoom()*r:Math.exp(r*(Math.log(o.getMaxZoom())-Math.log(o.getMinZoom()))+Math.log(o.getMinZoom()))}function w(){return o.height()<300}var p,b=r(c+"Background.png",!0),M=r(c+"BackgroundShort.png",!0),L=r(c+"Slider.png"),S=r(c+"Hand.png"),k=r(c+"Arrow.png"),I=7,A=17,E=62,D=w()?145:247,C=l.p||"nw",O=("w"===C.charAt(1)?I:o.width()-(I+E))+(l.x||0),T=("n"===C.charAt(0)?A:o.height()-(A+D))+(l.y||0),P=O+21,N=T+118,z=T+215;g._zoomIn=function(){n.zoomIn(!0)},g._zoomOut=function(){n.zoomOut(!0)},g._panLeft=function(){n.pan("left",!0)},g._panRight=function(){n.pan("right",!0)},g._panUp=function(){n.pan("up",!0)},g._panDown=function(){n.pan("down",!0)},g._fitToWindow=function(){n.fitToModel(!0)},g._toggleMode=function(){var e=n.options();e.handMode=!e.handMode,n.options(e)},g._scale=function(e,n,t){y(t,!0)},h._zoomIn=h._zoomOut=h._panLeft=h._panRight=h._panUp=h._panDown=h._fitToWindow=h._toggleMode=h._scale="pointer",h._slider='url("'+c+'openhand.cur"), pointer',d._slider=function(){var r=o.zoom();return w()?null:e.trigger("dragstart","slider")?void 0:(i()&&t.internalUse.enableDragging(!1),{getCursor:function(){return"move"},dragMove:function(e,n){n=o.unscale(n),y(n,!1)},endDrag:function(a){var o=e.trigger("dragend","slider");a=a&&!o,a||n.setZoom(r,!1),i()&&t.internalUse.enableDragging(n.options().handMode),e.trigger("dragcomplete","slider")}})};var K={generate:function(e,n,t,r,i,a){var o=w()?M:b,c=r[o].im;if(n.webgl&&!r._coList[o]&&(r._coList[o]=!0,r.updated=!0),!a){p=r,e.setLayer(s.layers.OVERLAYS),e.image(t.scale(O),t.scale(T),t.scale(O+c.width),t.scale(T+c.height),o,"_background","co");var l=O+19,d=T+64,h=t.scale(l),v=t.scale(d),g=t.scale(l+28),y=t.scale(d+32),x=f()?S:k;e.image(h,v,g,y,x),e.setLayer(s.layers.OVERLAYSSHADOW),e.image(h,v,g,y,x,"_toggleMode");var I=5,A=23,E=39,D=57,C=105,N=w()?124:222,z=18,K=3,R=68,U=22;if(u(e,t,O+A,T+C,O+E,T+C+z,"_zoomIn"),u(e,t,O+A,T+N,O+E,T+N+z,"_zoomOut"),u(e,t,O+I,T+A,O+A,T+E,"_panLeft"),u(e,t,O+E,T+A,O+D,T+E,"_panRight"),u(e,t,O+A,T+I,O+E,T+A,"_panUp"),u(e,t,O+A,T+E,O+E,T+D,"_panDown"),u(e,t,O+A,T+A,O+E,T+E,"_fitToWindow"),w()||u(e,t,O+A,T+C+z,O+E,T+N,"_scale"),u(e,t,O+A-K,T+R,O+E+K,T+R+U,"_toggleMode"),!w()){var W=m(t.zoom()),B=t.scale(P),F=t.scale(W),_=t.scale(P+r[L].im.width),V=t.scale(W+r[L].im.height);e.image(B,F,_,V,L,"_slider"),e.setLayer(s.layers.OVERLAYS),e.image(B,F,_,V,L)}}},createDragger:function(){}};h[b]="wait",v.push(K)};var p,b,M,L,S,k={ne:"sw",nw:"se",se:"nw",sw:"ne"};return f.addOverview=function(t,i,a,o,c,u){function f(e){var n={x1:a.viewToWorldX(a.scale(-e)),x2:a.viewToWorldX(a.scale(a.width()+e)),y1:a.viewToWorldY(a.scale(-e)),y2:a.viewToWorldY(a.scale(a.height()+e))};return{x1:z.worldToViewX(n.x1),x2:z.worldToViewX(n.x2),y1:z.worldToViewY(n.y1),y2:z.worldToViewY(n.y2)}}function y(){F+=K.x,_+=K.y,e.trigger("redraw")}function w(){H=l.setRegularTick(y,50)}function I(){H&&(clearInterval(H),H=null)}function A(e){var n=Math.max(e.width(),e.height())/2;z.reset(!1);var t=f(n);z.fitExtents(t,!1,!1,void 0,void 0,void 0,!0);var r=e.getMaxItemZoom();1/0!==r&&z.setMaxItemZoom(r/8),U&&z.panBy(F,_,!1,!0)}var E=u.p&&k[u.p]?u.p:"se",D=r(c+"Arrow-"+k[E]+".png",!0),C=r(c+"Arrow-"+E+".png",!0);u.size=u.size||100,p=u.size,M=u.shown,S="n"===E.charAt(0),L="w"===E.charAt(1),b=o(p,p);var O=b.getContext("2d"),T=!1,P=!1,N=(new Date).getTime(),z=n.createView(e,p,p);g._overviewIcon=function(){M=u.shown=!u.shown,e.trigger("overview",M?"open":"close")},h._overviewIcon="pointer";var K,R=null,U=!1,W=0,B=0,F=0,_=0,V=2;h._overviewBox='url("'+c+'openhand.cur"), pointer';var H;d._overviewBox=function(n,r){if(!e.trigger("dragstart","overview")){U=!0;var i=2;W=0,B=0,F=0,_=0;var o=-R.x1+i,c=p-R.x2-i,u=-R.y1+i,s=p-R.y2-i;return{getCursor:function(){return"move"},dragMove:function(e,t){I(),W=e-n,B=t-r,K={x:0,y:0};var i=!1;o>W&&(W=o,K.x=V,i=!0),W>c&&(W=c,K.x=-V,i=!0),u>B&&(B=u,K.y=V,i=!0),B>s&&(B=s,K.y=-V,i=!0),i&&w()},endDrag:function(n){U=!1,I();var r=e.trigger("dragend","overview");if(n&&!r){var i=-(W-F)*a.zoom()/z.zoom(),o=-(B-_)*a.zoom()/z.zoom();t.panBy(i,o,!0)}e.trigger("dragcomplete","overview")}}}};var Y={generate:function(n,r,a,o,c,l){if(!l){if(M){var d,h,v,g,y=L?a.scale(-1):a.scale(a.width()-p-2),w=S?a.scale(-1):a.scale(a.height()-p-2),b=L?a.scale(p+2):a.scale(a.width()+1),k=S?a.scale(p+2):a.scale(a.height()+1),I=Math.max(1,a.scale(3)),E=L?a.scale(-1):a.scale(a.width()-p)-.5,K=S?a.scale(-1):a.scale(a.height()-p)-.5,F=L?a.scale(p)+.5:a.scale(a.width()+1),_=S?a.scale(p)+.5:a.scale(a.height()+1),V=Math.max(1,a.scale(1));if(n.setLayer(s.layers.OVERVIEWSHADOW),n.rect(y,w,b,k,s.colours.white,I,s.colours.white,!0,"_overviewBorder1"),n.rect(E,K,F,_,s.colours.lightgrey,V,s.colours.white,!1,"_overviewBorder2"),n.setLayer(s.layers.OVERVIEW),n.rect(y,w,b,k,s.colours.white,I,s.colours.white,!1),n.rect(E,K,F,_,s.colours.lightgrey,V,s.colours.white,!1),i){var H=(new Date).getTime();T&&!U&&N+1e3>H&&P?e.trigger("redraw"):(N=(new Date).getTime(),T=!0,O.clearRect(0,0,p,p),O.fillStyle=s.colours.white,O.fillRect(0,0,p,p),t.drawBackground(O),A(a),n.draw(O,z,o,s.channels.MAIN,s.itemLayers),P=(new Date).getTime()-N>30),R||(R=f(0));var Y=U?W:0,G=U?B:0,q=U?"_overviewBoxDragging":"_overviewBox";d=a.scale(L?R.x1+Y:a.width()-p+R.x1+Y),h=a.scale(S?R.y1+G:a.height()-p+R.y1+G),v=a.scale(L?R.x2+Y:a.width()-p+R.x2+Y),g=a.scale(S?R.y2+G:a.height()-p+R.y2+G);var X=Math.max(1,a.scale(2));n.setLayer(s.layers.OVERVIEWSHADOW),n.rect(d,h,v,g,m,X,x,!U,q),n.setLayer(s.layers.OVERVIEW),n.rect(d,h,v,g,m,X,x,!U,q)}}var j=M?C:D,Z=o[j].im;u.icon&&(n.rect(L?a.scale(-1):a.scale(a.width()-Z.width)-.5,S?a.scale(-1):a.scale(a.height()-Z.height)-.5,L?a.scale(Z.width)+.5:a.scale(a.width()+1),S?a.scale(Z.height)+.5:a.scale(a.height()+1),s.colours.lightgrey,Math.max(1,a.scale(1)),s.colours.white,!0,"_overviewIconRect"),n.image(a.scale(L?0:a.width()-Z.width),a.scale(S?0:a.height()-Z.height),a.scale(L?Z.width:a.width()),a.scale(S?Z.height:a.height()),j,"_overviewIcon","co"),r.webgl&&!o._coList._overviewIcon&&(o._coList._overviewIcon=!0,o.updated=!0),n.setLayer(s.layers.OVERVIEWSHADOW),n.rect(a.scale(L?-1:a.width()-2*Z.width),a.scale(S?-1:a.height()-2*Z.height),a.scale(L?2*Z.width:a.width()+1),a.scale(S?2*Z.height:a.height()+1),s.colours.lightgrey,-1,s.colours.white,!0,"_overviewIcon"))}}};v.push(Y)},f.remove=function(e,n,t){var r=42,i={generate:function(i,a,o){i.setLayer(s.layers.OVERLAYS);var c=s.measureText(a,e,r).width,u=o.scale((o.width()-c)/2),l=o.scale((o.height()+r)/2);i.text(u+2,l+2,e,t,o.scale(r),!0,null,null,!1,c,!1,!1,u+2,l+2-o.scale(r),u+2+c,l+2),i.text(u,l,e,n,o.scale(r),!0,null,null,!1,c,!1,!1,u,l-o.scale(r),u+c,l)}};v.push(i)},f.drawOverviewContent=function(e,n){if(M&&b){var t=n.scale(p);e.isFlash?e.drawImageDirect(b,0,0,p,p,n.scale(L?0:n.width()-p),n.scale(S?0:n.height()-p),t,t):e.drawImage(b,0,0,t,t,n.scale(L?0:n.width()-p),n.scale(S?0:n.height()-p),t,t)}},f}}(),!function(){var e=KeyLines.View={},n=e.createView=function(e,t,r,i,a){function o(){return a&&a.api.isShown()}function c(){return R(d*E)}function u(){return R(d/E)}function s(e,n,t,r,i,a,o,c,u,s,l){n.generate(t,r,w,i,u);var f=t.itemExtents(e,r);if(f){var d=W(f);return l&&(d.x1=d.x2=w.width()/2),B(d,a,!0,!0,!0,o,!1,c,s)}return m.invoke(c),null}var l,f,d,h,v,g,y,m=KeyLines.Util,x=KeyLines.Common,w={},p=t,b=r,M=i?i:1;w.scaleFactor=function(e){return e&&(M=e),M};var L=w.scale=function(e){return Math.floor(M*e)};w.unscale=function(e){return Math.floor(e/M)},w.settings=function(){return{width:p,height:b,zoom:d,offsetX:h,offsetY:v}},w.fromSettingsDirect=function(e,n,t,r){return q(d,R(e.zoom),e.offsetX-h,e.offsetY-v,n,t,r)},w.fromOldSettings=function(t,r,i,a){if(r){var o=n(e,t.width,t.height);o.setZoom(t.zoom,!1),o.offsetX=t.offsetX,o.offsetY=t.offsetY;var c={x1:o.viewToWorldX(0),y1:o.viewToWorldY(0),x2:o.viewToWorldX(o.width()),y2:o.viewToWorldY(o.height())};return B(c,i,!1,!1,!1,a)}U(t.zoom,!1),h=t.offsetX,v=t.offsetY},w.width=function(e){return e&&(p=e),p},w.height=function(e){return e&&(b=e),b};var S=w.x=w.worldToViewX=function(e){return Math.floor(((e-l)*d+h)*M)},k=w.y=w.worldToViewY=function(e){return Math.floor(((e-f)*d+v)*M)},I=w.viewToWorldX=function(e){return Math.floor((e/M-h)/d+l)},A=w.viewToWorldY=function(e){return Math.floor((e/M-v)/d+f)};w.w=function(e){return-1===e?-1:Math.max(1,Math.floor(e*d*M))},w.sw=function(e){return-1===e?-1:w.w(e)+7},w.dim=function(e){return Math.floor(e*d*M)},w.sdim=function(e){return e&&e*d*M},w.undim=function(e){return Math.floor(e/(d*M))},w.sundim=function(e){return e/(d*M)};var E=1.4,D=4,C=.05,O=C,T=.01,P=1,N=200,z=1/0,K=100;w.getMaxZoom=function(){return D},w.getMinZoom=function(){return O},w.setMinZoom=function(e){O=Math.min(P,Math.max(T,e||C))},w.setMaxItemZoom=function(e){z=e?e:1/0},w.getMaxItemZoom=function(){return z},w.zoomIn=function(e,n,t){var r=c();return F(r,M*p/2,M*b/2,e,n,t)},w.zoomOut=function(e,n,t){var r=u();return F(r,M*p/2,M*b/2,e,n,t)};var R=function(e){return Math.min(D,Math.max(e,O))},U=w.setZoom=function(e,n,t,r){var i=R(e);return F(i,M*p/2,M*b/2,n,t,r)};w.getUnzoom=function(){return d>z?z/d:1},w.wheelToPosition=function(e,n,t){var r=e>0?c():u();return F(r,n,t,!0,200)};var W=w.worldExtentsToView=function(e){return e?{x1:S(e.x1),y1:k(e.y1),x2:S(e.x2),y2:k(e.y2)}:null};w.fitWorldExtents=function(e,n,t,r,i,a,o){if(!e)return m.invoke(o),null;var c=W(e);return B(c,n,t,r,i,a,!1,o)};var B=w.fitExtents=function(e,n,t,r,i,a,o,c,u){var s,g=(e.y2-e.y1)/(e.x2-e.x1),y=b/p;if(g>y){var m=i?b/8:0;s=d*(b-m)/(e.y2-e.y1)}else{var x=i?p/8:0;s=d*(p-x)/(e.x2-e.x1)}s*=M,t&&(s=R(s)),r&&s>1&&(s=1),u&&(s=d);var w=(e.x1+e.x2)/2,L=(e.y1+e.y2)/2,S=I(w),k=A(L),E=p/2-(S-l)*s,D=b/2-(k-f)*s;return q(d,s,E-h,D-v,n,a,c,o)};w.fitToSelection=function(e,n,t,r,i,a,o,c,u){return s(e.privateSelection(),e,n,t,r,i,a,o,c,u)},w.fitToModel=function(e,n,t,r,i,a,o,c){return s(null,e,n,t,r,i,a,o,c)},w.fitModelHeight=function(e,n,t,r,i,a,o,c){return s(null,e,n,t,r,i,a,o,c,!1,!0)};var F=w.zoomToPosition=function(e,n,t,r,i,a){e=R(e);var o=I(n),c=A(t),u=n/M-(o-l)*e,s=t/M-(c-f)*e;return q(d,e,u-h,s-v,r,i,a)},_=w.reset=function(e){l=421,f=298,e?q(d,1,421-h,298-v,!0):(h=421,v=298,d=1)};w.zoom=function(){return o()?a.internalUse.getZoom():d},w.offsetXtoWebglPanX=function(){var e=p/2;return-(1-w.offsetX()/e)+(e-l)/e*d},w.offsetYtoWebglPanY=function(){var e=b/2;return 1-w.offsetY()/e-(e-f)/e*d},w.offsetX=function(e){return m.defined(e)&&(h=e),h},w.offsetY=function(e){return m.defined(e)&&(v=e),v},w.diffX=function(){return g},w.diffY=function(){return y},w.pan=function(e,n,t,r){var i=0,a=0;switch(e){case"up":a=1;break;case"down":a=-1;break;case"left":i=1;break;case"right":i=-1}return i*=K,a*=K,G(i,a,n,!1,t,r)};var V,H,Y,G=w.panBy=function(e,n,t,r,i,a){return q(d,d,e,n,t,i,a,r)},q=function(n,t,r,i,a,o,c,u){return g=r,y=i,a?X(n,t,r,i,o,c):(h+=Math.floor(r),v+=Math.floor(i),d=t,e&&!u&&e.trigger("viewchange"),m.invoke(c),void 0)},X=function(n,t,r,i,a,o){a||(a=N);var c=a,u=h,s=v;return x.buildAnimatorInstance(function(l){c-=l;var f=e.atanEasing(Math.max(0,Math.min(1,(a-c)/a)));h=u+f*r,v=s+f*i,d=R(n+f*(t-n));var g=c>0;return g||(e.trigger("viewchange"),m.invoke(o)),g},{drawOnly:!0},!0)},j=function(n,t,r,i,c){var u=o(),s=u?-3:.1;return x.buildAnimatorInstance(function(o){var l=0===H&&0===Y;return u?a.internalUse.panBy([H*s,Y*s],{animate:!1}):(h+=o*s*H,v+=o*s*Y),V=!l,r&&r.dragMove(n,t,i,c),l||e.trigger("viewchange"),!l})};return w.cancelScroll=function(){H=Y=0},w.maybeScroll=function(e,n,t,r,i){var a=L(50);return H=0,Y=0,a>e&&(H=1),e>L(p)-a&&(H=-1),a>n&&(Y=1),n>L(b)-a&&(Y=-1),t.direction&&(t.direction.x||(H=0),t.direction.y||(Y=0)),0===H&&0===Y||V?void 0:(V=!0,j(e,n,t,r,i))},_(),w}}(),!function(){var e=KeyLines.Draggers={};e.createDraggers=function(e){var n,t=KeyLines.Util,r={};return r.setOptions=function(e){n=e.fanLength},r.primitiveMover=function(n,r,i,a,o,c,u,s,l,f){function d(e,n){return{dx:i.undim(e-s),dy:i.undim(n-l)}}function h(e,n,r,i){var a,o={};if(u.length>0){o.x1=o.x2=o.y1=o.y2=0;for(var c=0;c<u.length;c++){a=u[c];var s="x"===a.charAt(0)?e:n;o[a]=s}r&&(0!==o.x1&&(o.x2=-o.x1),0!==o.x2&&(o.x1=-o.x2),0!==o.y1&&(o.y2=-o.y1),0!==o.y2&&(o.y1=-o.y2))}else i&&(e=Math.abs(e)>Math.abs(n)?e:0,n=0!==e?0:n),o.x1=o.x2=e,o.y1=o.y2=n;for(var l={},f=["x1","y1","x2","y2"],d=0;d<f.length;d++)a=f[d],l[a]=g[a]+o[a];if(i){var h=g.x2-g.x1,v=g.y2-g.y1;if(Math.abs(h)>0&&Math.abs(v)>0){var y,m=v/h,x=l.x2-l.x1,w=l.y2-l.y1,p=Math.abs(e)>Math.abs(n);if(p){var b=Math.floor(m*(h+x)-v)-w;r||!t.contains(u,"y1")&&!t.contains(u,"y2")?(y=Math.floor(b/2),l.y1-=y,l.y2+=y):(t.contains(u,"y1")&&(l.y1-=b),t.contains(u,"y2")&&(l.y2+=b))}else{var M=Math.floor((v+w)/m-h)-x;r||!t.contains(u,"x1")&&!t.contains(u,"x2")?(y=Math.floor(M/2),l.x1-=y,l.x2+=y):(t.contains(u,"x1")&&(l.x1-=M),t.contains(u,"x2")&&(l.x2+=M))}}}return l}function v(e,n,t,r){var i=d(e,n);return h(i.dx,i.dy,t,r)}if(!e.trigger("dragstart","resize",a,i.unscale(s),i.unscale(l),null)){var g=n.extents(r,o),y={};for(var m in o)y[m]=o[m];n.setAlpha(y,.5);var x={scrollable:!0,getCursor:function(){return c?"crosshair":"move"},generate:function(e){e.copyPrimitive(y)},dragMove:function(e,t,i,a){var o=v(e,t,i,a);n.setExtents(y,o.x1,o.y1,o.x2,o.y2,r)},endDrag:function(t,c,u,s,l){i.cancelScroll();var d=e.trigger("dragend","resize",a,i.unscale(c),i.unscale(u));if(!d&&t){var h=v(c,u,s,l);n.setExtents(o,h.x1,h.y1,h.x2,h.y2,r),f(o)}e.trigger("dragcomplete","resize",a,i.unscale(c),i.unscale(u))}};return x}},r.createHandDragger=function(n,r,i,a){function o(e,n){h=h||Math.abs(r-e)>10||Math.abs(i-n)>10,f=e-r,d=n-i,u&&(u.x||(f=0),u.y||(d=0))}function c(){h&&(n.offsetX(s+f),n.offsetY(l+d))}var u={x:!0,y:!0},s=n.offsetX(),l=n.offsetY(),f=0,d=0,h=!1,v="hand",g=e.trigger("dragstart",v,null,n.unscale(r),n.unscale(i));if(g){if(!t.isNormalObject(g))return a(),void 0;for(var y in g)u[y]=g[y]}return{rebuild:{drawOnly:!0},animate:c,direction:u,dragMove:o,getCursor:function(){return"move"},endDrag:function(t,r,i){var u=e.trigger("dragend",v,null,n.unscale(r),n.unscale(i));h?(!u&&t?o(r,i):f=d=0,c()):a(),e.trigger("dragcomplete",v,null,n.unscale(r),n.unscale(i))}}},r.createDefaultDragger=function(n,r,i,a,o,c,u,s){function l(e){return v.add&&v.add[e]}function f(){for(var e in r)(a(e)||l(e))&&b[e]&&n.moveNode(e,b[e].x+k.dx,b[e].y+k.dy)}function d(){for(var e in r)b[e]&&n.moveNode(e,b[e].x,b[e].y)}function h(e,n){return I=I||Math.abs(u-e)>10||Math.abs(s-n)>10,e=o?o.viewToWorldX(e):e,n=o?o.viewToWorldY(n):n,v&&(v.x||(e=w),v.y||(n=p)),{dx:I?e-w:0,dy:I?n-p:0}}var v={x:!0,y:!0,add:null},g=t.rawId(c),y="move",m=e.trigger("dragstart",y,g,o.unscale(u),o.unscale(s),t.subId(c));if(m)if(t.isArray(m))v.add=t.makeIdMap(m);else{if(!t.isNormalObject(m))return;for(var x in m)v[x]=m[x];t.isArray(v.add)&&(v.add=t.makeIdMap(v.add))}var w=o?o.viewToWorldX(u):u,p=o?o.viewToWorldY(s):s,b={};for(var M in r)b[M]={x:r[M].x,y:r[M].y};var L,S,k=h(u,s),I=!1,A={rebuild:{all:!0},scrollable:!0,direction:v,animate:f,generate:function(e){e.excludeHit(g)},getCursor:function(){return"move"},dragMove:function(e,n){k=h(e,n)},mouseMoved:function(e){return e&&(L=!0),L},afterDraw:function(n,r,i){L=!1;var a=t.rawId(n);g!==a&&(void 0===S?S=a:a!==S&&(e.trigger("dragover",a,o.unscale(r),o.unscale(i),t.subId(n)),S=a))},endDrag:function(r,i,a){o.cancelScroll();var u=e.trigger("dragend",y,t.rawId(c),o.unscale(i),o.unscale(a));u?d():r&&I?(d(),k=h(i,a),e.trigger("prechange","move"),f()):d(),n.setDirty(g),e.trigger("dragcomplete",y,t.rawId(c),o.unscale(i),o.unscale(a))}};return A},r.createLinkEndDragger=function(n,r,i,a,o,c,u,s,l){function f(e,n){r.moveNode(o[c],e,n)}function d(e,n){return e=i?i.viewToWorldX(e):e,n=i?i.viewToWorldY(n):n,{dx:e-y,dy:n-m}}function h(){return o["id1"===c?"id2":"id1"]}if(e.trigger("dragstart","dummy",l,i.unscale(u),i.unscale(s),null))return!1;var v,g,y=i?i.viewToWorldX(u):u,m=i?i.viewToWorldY(s):s,x=a[o[c]].x,w=a[o[c]].y,p=d(u,s),b=u,M=s,L=null,S={rebuild:{all:!0},scrollable:!0,animate:function(){f(x+p.dx,w+p.dy)},getCursor:function(){return"move"},dragMove:function(e,t){p=d(e,t),b=e,M=t,L=n.hittest(e,t,i)},mouseMoved:function(e){return e&&(g=!0),g},afterDraw:function(n,r,a){g=!1;var o=t.rawId(n),c=t.subId(n);l===o&&(o=null,c=null),void 0===v?v=o:o!==v&&(e.trigger("dragover",o,i.unscale(r),i.unscale(a),c),v=o)},endDrag:function(n,u,s){i.cancelScroll();var l=e.trigger("dragend","dummy",L,i.unscale(u),i.unscale(s));if(!l)if(n)if(f(x,w),e.trigger("prechange","move"),L=t.rawId(L),a[L]&&L!==h()){delete a[o[c]],o[c]=L;var v={};v[o.id]=o,r.resetConnectionOffsets(v)}else p=d(u,s),f(x+p.dx,w+p.dy),L=null;else f(x,w);e.trigger("dragcomplete","dummy",L,i.unscale(u),i.unscale(s))}};return S},r.createLinkDragger=function(n,r,i,a,o,c,u,s){function l(e,n,t,r,i,a){return((t-e)*(n-a)-(e-i)*(r-n))/Math.sqrt((t-e)*(t-e)+(r-n)*(r-n))}function f(e,t){var r=i.viewToWorldX(e),a=i.viewToWorldY(t),c=n("x1",o),u=n("y1",o),s=n("x2",o),f=n("y2",o),d=l(c,u,s,f,r,a);g&&Math.abs(d-h)>8&&(g=!1),g||(Math.abs(d)<12&&(d=0),v=d)}function d(){a.setLinkOffset(o.id,v)}if(e.trigger("dragstart","offset",s,i.unscale(c),i.unscale(u),t.subId(s)))return!1;var h=o.off?o.off:0,v=h,g=!0,y=!1,m={rebuild:{all:!0},scrollable:!0,animate:function(){d()},getCursor:function(){return"move"},dragMove:function(e,n){f(e,n),y=!0},endDrag:function(n,t,r){i.cancelScroll();var a=e.trigger("dragend","offset",s,i.unscale(t),i.unscale(r));a||(n&&y?(o.off=h,e.trigger("prechange","offset"),f(t,r),d()):o.off=h),e.trigger("dragcomplete","offset",s,i.unscale(t),i.unscale(r))}};return m},r}}(),!function(){var e=KeyLines.Events={};e.createEventBus=function(){function e(e,n){var t=(new Date).toString()+" Function bound to '"+e+"' threw error: "+n.toString();"undefined"!=typeof console&&console.log(t),a.push(t),a.length>i&&a.shift()}function n(e,n,t,r,i,a){function o(e){return((f*e+l)*e+s)*e}function c(e,n){var t=u(e,n);return((v*t+h)*t+d)*t}function u(e,n){var t,r,i,a,c,u;for(i=e,u=0;8>u;u++){if(a=o(i)-e,Math.abs(a)<n)return i;if(c=(3*f*i+2*l)*i+s,Math.abs(c)<1e-6)break;i-=a/c}if(t=0,r=1,i=e,t>i)return t;if(i>r)return r;for(;r>t;){if(a=o(i),Math.abs(a-e)<n)return i;e>a?t=i:r=i,i=(r-t)/2+t}return i}var s=3*n,l=3*(r-n)-s,f=1-s-l,d=3*t,h=3*(i-t)-d,v=1-d-h;return c(e,1/(200*a))}var t,r={};r.bind=function(e,n,r){t=t||{},t[e]=t[e]||[],t[e].push([n,r])},r.unbind=function(e,n){if(t)if(e)if(n){if(t[e]){for(var r=[],i=0;i<t[e].length;i++)n!==t[e][i][0]&&r.push(t[e][i]);t[e]=r}}else t[e]=[];else t={}},r.trigger=function(n){var r=!1;if(t)for(var i,a=2;a--;){var o=a?n:"all",c=[],u=a?1:0;for(i=u;i<arguments.length;i++)c.push(arguments[i]);if(t[o])for(i=0;i<t[o].length;i++){var s=t[o][i];try{r=s[0].apply(s[1]||this,c)||r}catch(l){e(n,l)}}}return r},r.getErrors=function(){return a};var i=10,a=[];r.linearEasing=function(e){return 0>e?0:e>1?1:e},r.cubicEasing=function(e){return 0>e?0:e>1?1:n(e,.25,.01,.25,1,1)};var o=1;return r.atanEasing=function(e){return Math.atan(o*(e-.5))/(2*Math.atan(.5*o))+.5},r}}(),!function(){var e=KeyLines.Combo={};e.create=function(e){function n(n,t){function r(e){n[e.id]&&i.push(e.id)}var i=[];return e.privateEach({type:t},r),i}function t(e){for(var n={},t=0;t<e.length;t++)n[e[t].id]=e[t];return n}function r(e){var n=[];for(var t in e)t=p.rawId(t),n.push(e[t]);return n}function i(e){return e+Math.floor(1e7*Math.random())}function a(e,n){return e.substring(0,n.length)===n}function o(e){return a(e,b)&&!!M[e]}function c(e){var n=[];if(o(e))for(var t=M[e].nodes,r=0;r<t.length;r++)o(t[r].id)?n=n.concat(c(t[r].id)):n.push(t[r]);return n}function u(e){var n=M[e];return delete M[e],n}function s(){var e={};for(var n in M){n=p.rawId(n);for(var t=0;t<M[n].nodes.length;t++)e[M[n].nodes[t].id]=n}return e}function l(){L=s()}function f(e){for(var n;e;)n=e,e=L[e];return n}function d(e){return e!==f(e)}function h(e){return a(e,S)}function v(){var n=i(S);return e.getItem(n)?v():n}function g(e,n,t){var r=f(e.id1),i=f(e.id2);return r===n&&i===t||r===t&&i===n}function y(n){if(h(n)){var t=e.getItem(n);if(t){var r=[];for(var i in k)i=p.rawId(i),g(k[i],t.id1,t.id2)&&r.push(k[i]);return r}}return null}function m(){function n(e,n,t){var r=n>e?e:n,i=e>n?e:n;l[r]||(l[r]={}),l[r][i]||(l[r][i]=[]),l[r][i].push(t)}function t(e){for(var n=0;n<e.length;n++)if(!e[n].hi)return!0;return!1}function r(e){return!(a(e,b)&&!M[e])}function i(e){for(var n={},t=c(e),r=0;r<t.length;r++)n[t[r].id+""]=1;return n}function u(e,n,t,r){var a,c,u,s;o(n)?u=i(n):(u={},u[n+""]=1),o(t)?s=i(t):(s={},s[t+""]=1);for(var l=0;(!a||!c)&&l<r.length;l++){var f=r[l];a=a||f.a1&&f.id1 in u,a=a||f.a2&&f.id2 in u,c=c||f.a2&&f.id2 in s,c=c||f.a1&&f.id1 in s}e.a1=a,e.a2=c}var s={};e.privateEach({type:"node"},function(e){s[e.id]={}}),e.privateEach({type:"link"},function(e){s[e.id1][e.id2]=s[e.id2][e.id1]=!0});var l={};for(var d in k){d=p.rawId(d);var h=k[d],g=f(h.id1),y=f(h.id2),m=r(g)&&r(y);m&&g!==y&&(s[g][y]||n(g,y,h))}var x=[];for(var w in l){w=p.rawId(w);for(var L in l[w])if(L=p.rawId(L),o(w)||o(L)){var S=l[w][L],I=p.clone(S[0]);I.id1=w,I.id2=L,I.id=v(),I.hi&&t(S)&&delete I.hi,I.off=void 0,u(I,w,L,S),x.push(I)}else for(var A=l[w][L],E=0;E<A.length;E++)x.push(A[E]),delete k[A[E].id]}return x}function x(e){for(var n=["id","id1","id2"],t=0;t<n.length;t++)n[t]in e&&(e[n[t]]+="")}function w(e){e&&(M=t(e.nodes),k=t(e.links));var n=p.clone(r(M)),i=p.clone(r(k));return{nodes:n,links:i}}var p=KeyLines.Util,b="_combo_",M={},L={},S="_combolink_",k={},I={internalUse:{preMerge:function(e){for(var n=[],t=0;t<e.length;t++){var r=e[t];if(x(r),"node"===r.type)d(r.id)||n.push(r);else{if("link"!==r.type)throw new Error("The type of the item should be specified.");d(r.id1)||d(r.id2)?k[r.id]=r:n.push(r)}}return n},postMerge:function(n){var t=m();e.privateMerge(t,n)},preDelete:function(t){var r;t=p.ensureArray(t);var i=p.makeIdMap(t),a=n(i,"node"),c=n(i,"link"),s=e.privateGraph().neighbours(a,{all:!0}).links;c=p.makeIdMap(s.concat(c));for(var d in k)if(d=""+d,d in c){if(h(d)){var v=y(d);for(r=0;r<v.length;r++)k[v[r].id]&&delete k[v[r].id]}}else{var g=k[d],m=f(g.id1),x=f(g.id2);(m in i||x in i)&&delete k[d]}for(r=0;r<a.length;r++){var w=a[r];o(w)&&u(w)}l()},serialize:w,loadUp:function(e){e?w(e):(M={},k={}),l()}}};return I}}(),!function(){function e(e){return e.lastIndexOf(s())}var n=KeyLines.Util={};n.shallowClone=function(e){if(null===e)return null;switch(typeof e){case"object":if(a(e))return e.slice();if(e instanceof Date)return new Date(e.getTime());var n={};for(var t in e)n[t]=e[t];return n;case"boolean":case"string":case"number":return e}};var t=n.clone=function(e,r){function i(e,n){r&&"_"===n.charAt(0)||(o[n]=t(e,r))}if(null===e)return null;var o;switch(typeof e){case"object":if(a(e)){for(var c=[],u=0;u<e.length;u++)c.push(t(e[u],r));return c}return e instanceof Date?new Date(e.getTime()):(o={},n.iterator(e,i),o);case"boolean":case"string":case"number":return e}};n.nextTick=function(e,n){return r(e)?setTimeout(e,n):void 0},n.setRegularTick=function(e,n){return r(e)?setInterval(e,n):void 0},n.isNumber=function(e){return isFinite(e)&&"number"==typeof e&&!isNaN(e)};var r=n.isFunction=function(e){if(e){var n={}.toString.call(e);return"[object Funct"===n.slice(0,13)}return!1},i=n.isNormalObject=function(e){return!("object"!=typeof e||e instanceof Date||a(e)||u(e))},a=n.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.invoke=function(e,n){e&&r(e)&&e(n)},n.tryCatch=function(e,n){try{n(null,e())}catch(t){n(t)}},n.getItemsArray=function(e){return e&&!n.isArray(e)&&e.items?e.items:e};var o=n.ensureArray=function(e){return a(e)?e:[e]},c=!0;n.timerFn=function(e,n,t){return function(){if(c){var r=(new Date).getTime(),i=e.apply(t||this,arguments),a=(new Date).getTime();
return console.log("fn "+n+" = "+(a-r)+"ms"),i}return e.apply(t||this,arguments)}},n.defaults=function(e,n){var r=t(e)||{};for(var i in n)(!r.hasOwnProperty(i)||u(r[i]))&&(r[i]=n[i]);return r},n.defined=function(e){return"undefined"!=typeof e};var u=n.isNullOrUndefined=function(e){return null===e?!0:n.defined(e)?!1:!0};n.flattenMap=function(e){var n=[];for(var t in e)n.push(t+"");return n};var s=n.idSep=function(){return"\u2704"},l=n.rawId=function(n){if(u(n))return null;var t=n+"",r=e(t);return-1!==r&&(t=t.substring(0,r)),t};n.subId=function(n){if(u(n))return null;var t=n+"",r=e(t);return-1!==r?t.substring(r+1):null};var f=n.dictToArray=function(e){var n=[];for(var t in e)n.push({id:t,val:i(e[t])?f(e[t]):e[t]});return n},d=n.arrayToDict=function(e){for(var n={},t=0;t<e.length;t++)n[e[t].id+""]=a(e[t].val)?d(e[t].val):e[t].val;return n};n.dictValues=function(e){var n=[];for(var t in e)n.push(e[t]);return n},n.dictKeys=function(e){var n=[];for(var t in e)n.push(t);return n},n.makeIdMap=function(e){var n={};e=o(e);for(var t=0;t<e.length;t++)n[l(e[t])]=1;return n},n.contains=function(e,n){return-1!==h(e,n)};var h=n.indexOf=function(e,n){for(var t=0;t<e.length;t++)if(e[t]===n)return t;return-1};n.merge=function(e,n){if(e){for(var t in n)e[t]=n[t];return e}return n},n.len=function(e,n){return Math.max(1e-4,Math.sqrt(e*e+n*n))},n.numberSort=function(e,n){var t,r,i,a=[];if(n)for(a=e,e=[],t=0;t<a.length;t++)e.push(a[t][n]);for(var o,c,u,s,l=0,f=e.length-1,d=-1,h=[],v=7;;)if(v>=f-l){for(r=l+1;f>=r;r++){for(o=e[r],u=a[r],t=r-1;t>=l&&e[t]>o;)e[t+1]=e[t],a[t+1]=a[t],t--;e[t+1]=o,a[t+1]=u}if(-1===d)break;f=h[d--],l=h[d--]}else{for(i=l+f>>1,t=l+1,r=f,o=e[i],u=a[i],e[i]=e[t],a[i]=a[t],e[t]=o,a[t]=u,e[l]>e[f]&&(o=e[l],u=a[l],e[l]=e[f],a[l]=a[f],e[f]=o,a[f]=u),e[t]>e[f]&&(o=e[t],u=a[t],e[t]=e[f],a[t]=a[f],e[f]=o,a[f]=u),e[l]>e[t]&&(o=e[l],u=a[l],e[l]=e[t],a[l]=a[t],e[t]=o,a[t]=u),c=e[t],s=a[t];;){do t++;while(e[t]<c);do r--;while(e[r]>c);if(t>r)break;o=e[t],u=a[t],e[t]=e[r],a[t]=a[r],e[r]=o,a[r]=u}e[l+1]=e[r],a[l+1]=a[r],e[r]=c,a[r]=s,f-t+1>=r-l?(h[++d]=t,h[++d]=f,f=r-1):(h[++d]=l,h[++d]=r-1,l=t)}},n.asyncWhile=function(e,t,r){function i(){return a||(a=t(),a||(a=!e())),a?r():n.nextTick(i,0)}var a=!e();i()},n.iterator=function(e,n){if(!u(e)&&r(n)){var t;if(a(e))for(t=0;t<e.length;t++)n(e[t],t);else for(t in e)n(e[t],t)}},n.filter=function(e,n){for(var t=[],r=0;r<e.length;r++){var i=e[r];n(i)&&t.push(i)}return t},n.ratelimit=function(e,t){var r,i,a,o;return function(){function c(){i=(new Date).getTime(),e.apply(a,o)}var u=(new Date).getTime();if(a=this,o=arguments,!r)if(!i||u-i>=t)c();else{var s=u-i,l=t-s;r=n.nextTick(function(){r=null,c()},l)}}}}(),!function(){var e=KeyLines.Model={};e.createModel=function(e,n,t){function r(e,n){switch(e){case"x1":return vn[n.id1].x;case"y1":return vn[n.id1].y;case"x2":return vn[n.id2].x;case"y2":return vn[n.id2].y}}function i(e){wn=!1,xn=e||{},pn=0}function a(e){xn[e]||(pn++,xn[e]=yn)}function o(){if(wn)return!0;for(var e in xn)return!0;return!1}function c(e){"node"===e.type&&(e.x||(e.x=0),e.y||(e.y=0))}function u(e,n){var t={},r={};if(e)for(var i=0;i<e.length;i++){var a=e[i];if(a.id&&!(a.id in t||a.id in r)){var o=null;if("node"===a.type){o=t;var u=!0;n&&vn[a.id]&&(u=!1),u&&c(a)}"link"===a.type&&(o=r),o&&(o[a.id]=dn.clone(a))}}return{nodes:t,links:r}}function s(){function e(e){var t=dn.clone(e,!0);t.id=dn.rawId(e.id),n.push(t)}var n=[];return dn.iterator(gn,e),dn.iterator(vn,e),n}function l(e){En(e.items)}function f(e){var n=[];for(var t in e)("undefined"==typeof e[t]||null===e[t])&&n.push(t);for(t in n)delete e[n[t]]}function d(e,n){var t=e[n],r=!0;if(dn.isNormalObject(t))for(var i in t)h(t,i),r&=!isNaN(t[i]);r||delete e[n]}function h(e,n){var t=Number(e[n]);0>t&&!Kn[n]&&(t=null),e[n]=t}function v(e,n){dn.isNullOrUndefined(e[n])||(e[n]=e[n]+"",Rn[n]&&!Rn[n][e[n]]&&delete e[n])}function g(e,n){e[n]&&(e[n]=fn.validatergb(e[n])?e[n]:void 0)}function y(e,n){On[n]?v(e,n):Cn[n]?h(e,n):Tn[n]?g(e,n):zn[n]&&d(e,n)}function m(e,n,t){t[n]&&delete e[n]}function x(e,n){for(var t in e)y(e,t),m(e,t,Nn),n&&m(e,t,Pn)}function w(e,n){var t={};if(e&&dn.isArray(e)){for(var r=[],i=0;i<e.length;i++){var a=e[i].p,o=null;n?o=e[i]:a&&2===a.length&&/(ne|nw|se|sw)/.test(a)&&(t[a]||(o=e[i],t[a]=1)),o&&(p(o),r.push(o))}e=r}return e}function p(e){if(dn.isNormalObject(e.fi)){var n=e.fi;dn.isNullOrUndefined(n.t)||(n.t="string"==typeof n.t?n.t.charAt(0):String.fromCharCode(n.t)),n.c&&(n.c=fn.validatergb(n.c)?n.c:void 0)}else null!==e.fi&&delete e.fi}function b(e,n){for(var t=0;t<Un.length;t++){var r=Un[t],i=e[r];i&&(n?i.hasOwnProperty("c")||i.hasOwnProperty("r")||i.hasOwnProperty("w")||delete e[r]:i.hasOwnProperty("c")&&i.hasOwnProperty("r")&&i.hasOwnProperty("w")||delete e[r])}}function M(e,n){var t={};for(var r in e)e[r].id1!==e[r].id2&&L(e[r],n)&&(t[r]=e[r]);return t}function L(e,n){return n=n||{},(vn[e.id1]||n[e.id1])&&(vn[e.id2]||n[e.id2])}function S(e,n){for(var t in gn){var r=gn[t];(vn[r.id1][e]===n||vn[r.id2][e]===n)&&r[e]!==n&&(r[e]=n,In(t))}}function k(e,n){e[n]&&Gn(e.id)}function I(e){for(var n in gn)k(gn[n],e);for(n in vn)k(vn[n],e)}function A(){E("hi")}function E(e,n){S(e,!0),n||I(e),"hi"===e&&F()}function D(e,n,t){for(var r="x"===n||"y"===n?a:In,i=0;i<e.length;i++){var o=e[i],c=vn[o];if(c)c[n]=t,r(o);else{var u=gn[o];u&&(u[n]=t,In(o))}}}function C(e,n){var t=!1;return vn[e]&&(t=T(vn[e],n)),gn[e]&&(t=T(gn[e],n)),t}function O(e){return(vn[e]||gn[e])&&!(C(e,"hi")||C(e,"gh"))}function T(e,n){return e[n]?!0:!1}function P(e,n,t){e=dn.ensureArray(e),D(e,n,!1);var r;if(E(n),t){var i={};for(r=0;r<e.length;r++)i[e[r]]=1;for(r in gn)T(gn[r],n)&&(T(vn[gn[r].id1],n)||T(vn[gn[r].id2],n)||(i[gn[r].id1]||i[gn[r].id2])&&(gn[r][n]=!1))}}function N(e){var n,t=[];for(n in vn)n=dn.rawId(n),vn[n][e]&&t.push(n);for(n in gn)n=dn.rawId(n),gn[n][e]&&t.push(n);return t}function z(e,n){e=dn.ensureArray(e),D(e,n,!0),E(n)}function K(e){var n={};for(var t in e)"undefined"==typeof e[t].off&&(n[t]=e[t]);return n}function R(){var e=U(vn);return e=U(gn)||e}function U(e){var n=!1;for(var r in e){var i=e[r];if(n=W(i)||n,t.itemHasGlyph(i))for(var a=0;a<i.g.length;a++)n=W(i.g[a])||n;i.bu&&(n=W(i.bu.g)||n)}return n}function W(e){if(e){var n=e.u;if(n&&!(n in _n))return _n[n]=1,!0}}function B(){Mn&&Mn.clearCache()}function F(){on=cn=null}function _(e){var n={};for(var t in e){var r=e[t];r.hi||(n[t]=r)}return n}function V(){on||(on=_(vn),cn=_(gn))}function H(){wn||(pn>100?Y():Sn().internalMarkLinks(xn))}function Y(){for(var e in cn)if(!xn[e]){var n=gn[e];(xn[n.id1]||xn[n.id2])&&(xn[e]=mn)}}function G(e){for(var n in e)Yn(n,!0)}function q(n){var t=KeyLines.Graph.create(e);return t.privateSetProperties(vn,n),t}function X(){return Sn().connections({all:!1})}function j(e,n){var t=[],r={};if(e.length>0){var i=q(e).findAdjacency;t=X();for(var a=0;a<t.length;a++){var o=gn[t[a][0]];i(o.id1,o.id2)&&(r[a]=1)}}n(t,r)}function Z(e){for(var n={},t=0;t<e.length;t++){var r=e[t],i=gn[r];i&&(n[r]=i)}return n}function $(){Q(X())}function J(e,n,t,r){function i(e,n){return a(gn[e])-a(gn[n])}function a(e){var n=dn.defined(e.off)?e.off:u;return e.id1>=e.id2&&(n=-n),n}function o(e,n){r(e,e.id1<e.id2?n:-n)}var c,u=1e6,s=n||e,l=40;dn.iterator(s,function(n,r){c=e[r],t||(c=dn.filter(c,function(e){return!gn[e].gh})),c.sort(i);for(var a=Math.floor(c.length/2),u=(c.length+1)%2/2,s=0;s<c.length;s++){var f=gn[c[s]];o(f,(s-a+u)*l)}})}function Q(e,n){function t(e,n){e.off=n}J(e,n,!0,t)}function en(e,n,t){function r(e,n){i.push({id:e.id,off:n})}var i=[];return J(e,n,t,r),i}function nn(){for(var e=X(),n={},t=0;t<e.length;t++){var r=!1,i=e[t];if(i.length>1){for(var a=0;a<i.length;a++){var o=gn[i[a]];o&&(r=r||"undefined"!=typeof o.off)}r||(n[t]=1)}}Q(e,n)}function tn(e){return(e+"").match(Jn)}function rn(e){var n=tn(e);return Qn[n[2]]}function an(e){var n=tn(e);return n?n[1]:null}var on,cn,un,sn,ln=KeyLines.Common,fn=KeyLines.Rendering,dn=KeyLines.Util,hn={},vn={},gn={},yn=1,mn=2,xn={},wn=!1,pn=0,bn=dn.idSep(),Mn=null,Ln=KeyLines.Layouts.create(),Sn=hn.graph=function(){return Mn||(Mn=KeyLines.Graph.create(e),Mn.privateSetProperties(vn,gn)),Mn},kn=hn.setAllDirty=function(){wn=!0},In=hn.setDirty=function(e){xn[e]||pn++,xn[e]=mn},An=hn.moveNode=function(e,n,t){var r=vn[e];r&&(r.x=n,r.y=t,a(e))};hn.moveLink=function(e,n){var t=gn[e];t&&(t.y=n,In(e))},hn.setLinkOffset=function(e,n){var t=gn[e];t&&(t.off=n,In(e))},hn.load=function(e){if(e){vn={},gn={},Xn(!0),l(e);var n=u(e.items);vn=n.nodes,gn=M(n.links),A(),Mn=null,nn(),kn()}R()};var En=hn.ensureTypesInArray=function(e,n){if(e)for(var t=0;t<e.length;t++)Dn(e[t],n)},Dn=hn.ensureObject=function(e,n){x(e,n),p(e),e.g&&(dn.isArray(e.g)?(En(e.g),e.g=w(e.g,"link"===e.type||gn[e.id])):delete e.g),b(e,n)};hn.defaultValueFor=function(e){switch(e){case"e":return 1;case"fs":return t.fontSize;case"off":case"b1":case"b2":return 0;case"x":case"y":return 0;case"w":case"h":return 1;case"bw":return 4;case"c":case"b":return fn.colours.midgrey;case"fc":return fn.colours.black;case"fbc":return fn.colours.textback}};var Cn={x:1,y:1,w:1,h:1,e:1,fs:1,off:1,b1:1,b2:1,bw:1},On={t:1,u:1,id:1,id1:1,id2:1,ff:1,sh:1,p:1,ls:1,bs:1},Tn={c:1,b:1,fc:1,fbc:1},Pn={hi:1,bg:1,ci:1,du:1,fb:1,a1:1,a2:1,re:1,tc:1,a:1},Nn={gh:1},zn={pos:1},Kn={x:1,y:1,off:1,lat:1,lng:1},Rn={ls:{solid:!0,dashed:!0,dotted:!0},bs:{solid:!0,dashed:!0}},Un=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];hn.bothEndsShown=function(e){return!(vn[e.id1].hi||vn[e.id2].hi)},hn.ensureBackgroundConsistency=function(){E("bg",!0)},hn.resurrect=function(e,n){P(e,"gh",n)},hn.ghost=function(e){z(e,"gh")},hn.show=function(e,n){P(e,"hi",n),B()},hn.hidden=function(){return N("hi")},hn.hide=function(e){z(e,"hi"),B()},hn.each=function(e,n){if(e.type.match(/^(node|all)$/))for(var t in vn)n(vn[t]);if(e.type.match(/^(link|all)$/))for(var r in gn)n(gn[r])},hn.setItem=function(e){Dn(e);var n=null;return"node"===e.type&&(n=vn),"link"!==e.type||(n=gn,L(e))?(c(e),e.id&&(n[e.id]=dn.clone(e),e.hi?A():F(),B(),In(e.id)),R()):!1};var Wn=hn.type=function(){return"LinkChart"};hn.setOptions=function(e){sn=e.marqueeLinkSelection,n.setOptions(e),t.setOptions(e)},hn.serialize=function(){return{type:Wn(),items:s()}};var Bn=hn.applyChanges=function(e,n){var t,r,i,o,c,u,s;for(t=0;t<e.length;t++){if(r=dn.rawId(e[t].id))if(u=[],n){s=new RegExp(r,"im");for(i in vn)s.test(i)&&u.push(vn[i]);for(o in gn)s.test(o)&&u.push(gn[o])}else vn[r]&&u.push(vn[r]),gn[r]&&u.push(gn[r]);var l=dn.clone(e[t]);for(delete l.id,delete l.type,c=0;c<u.length;c++){var d=!0,h=u[c];for(var v in l)h[v]=l[v],"x"!==v&&"y"!==v&&(d=!1);f(h),d?a(h.id):In(h.id)}}};hn.unsafeApplyChanges=function(e){var n,t,r,i;for(n=0;n<e.length;n++)for(t=dn.rawId(e[n].id),t&&(i=[],vn[t]&&i.push(vn[t]),gn[t]&&i.push(gn[t])),r=0;r<i.length;r++){var o=!0,c=i[r];dn.merge(c,e[n]);for(var u in e[n])"id"!==u&&"x"!==u&&"y"!==u&&(o=!1);f(c),o?a(c.id):In(c.id)}},hn.setProperties=function(e,n){e=dn.ensureArray(e),En(e),Bn(e,n),A(),B();var t=R();return t},hn.merge=function(e,n){n=n||{},En(e);var t=u(e,!0);t.links=M(t.links,t.nodes);for(var r in t.nodes)vn[r]=dn.merge(vn[r],t.nodes[r]),In(r);for(var i in t.links)gn[i]=dn.merge(gn[i],t.links[i]),In(i);if(B(),!n.preserveOffsets){var a=K(t.links);Zn(a)}A();var o=R();return o},hn.getItem=function(e){var n=Fn(e);return dn.clone(n,!0)};var Fn=hn.getByID=function(e){return e=dn.rawId(e),vn[e]||gn[e]},_n={};hn.imageList=function(e){var n={updated:!1,_coList:{}};for(var t in _n)n[e+t]=1;return n},hn.generate=function(e,n,r,a,c){var u=r.getUnzoom();if(u!==un&&kn(),o()){V(),H();var s=t.generate(on,cn,wn,xn,e,n,r,a,c,qn);i(s),un=u}return t.generateHandles(e,n,r,Hn),t.animated()},hn.contains=function(e){return t.contains(e,vn)},hn.animated=function(){return t.animated()};var Vn={},Hn=[];hn.setSelection=function(e,n,t){e=dn.rawId(e),n||t||Xn(e),Vn[e]?n&&Gn(e):Yn(e)};var Yn=hn.addToSelection=function(n,t){n=dn.rawId(n),n&&(Vn[n]||O(n)&&(Vn[n]=1,Hn.push(n),In(n),t||e.trigger("selectionchange")))},Gn=hn.removeFromSelection=function(n,t){if(n=dn.rawId(n),Vn[n]){In(n),delete Vn[n];var r=dn.indexOf(Hn,n);r>-1&&Hn.splice(r,1),t||e.trigger("selectionchange")}};hn.hasSelection=function(){return Hn.length>0};var qn=hn.isSelected=function(e){return e=dn.rawId(e),e in Vn},Xn=hn.clearSelection=function(n){for(var t=0;t<Hn.length;t++)In(Hn[t]);Vn={},Hn=[],n||e.trigger("selectionchange")};hn.selectAll=function(){G(vn),G(gn),e.trigger("selectionchange")};var jn=hn.doSelection=function(e){if(e){Xn(!0);for(var n=0;n<e.length;n++)Yn(e[n],!0)}return dn.clone(Hn)};hn.privateSelection=function(){return Vn},hn.moveSelection=function(e,n){var t=[];if(Vn){for(var r in vn)qn(r)&&t.push(r);for(var i in gn)qn(i)&&(vn[gn[i].id1].du&&t.push(gn[i].id1),vn[gn[i].id2].du&&t.push(gn[i].id2))}for(var o=0;o<t.length;o++){var c=vn[t[o]];c.x+=e,c.y+=n,a(c.id)}},hn.removeItem=function(e,n){n=n||{};var t;e=dn.ensureArray(e);for(var r={},i={},a=0;a<e.length;a++)t=e[a],gn[t]&&(r[t]=gn[t]),vn[t]&&(i[t]=1);for(t in gn)(i[gn[t].id1]||i[gn[t].id2])&&(r[t]=gn[t]);for(t in r)Gn(t,!0),In(t),delete gn[t];for(t in i)Gn(t,!0),In(t),delete vn[t];B(),n.preserveOffsets||Zn(r),F()},hn.selectionPlusDummyNodes=function(){for(var e=jn(),n=0;n<e.length;n++){var t=gn[e[n]];t&&(vn[t.id1].du&&e.push(t.id1),vn[t.id2].du&&e.push(t.id2))}return e};var Zn=hn.resetConnectionOffsets=function(e){j(e,Q)},$n=function(e,n){var t;return j(e,function(e,r){t=en(e,r,n)}),t};hn.showHideBendLinks=function(e){var n=Z(e);Zn(n)},hn.showHideGetLinksToBend=function(e,n){for(var t=Z(e),r=$n(t,n),i=[],a=0;a<r.length;a++){var o=r[a];gn[o.id].off!==o.off&&i.push(o)}return i},hn.getCursor=function(e,n){var t=an(e);return t?t:e?'url("'+n+'openhand.cur"), pointer':"auto"},hn.getResizePrimitive=function(){return t.getResizePrimitive()};var Jn=new RegExp(bn+"((\\S+)(?:\\-resize))$"),Qn={nw:["x1","y1"],n:["y1"],ne:["x2","y1"],e:["x2"],se:["x2","y2"],s:["y2"],sw:["x1","y2"],w:["x1"]},et=new RegExp(bn+"(id[1|2])$");hn.startDragger=function(e,t,r,i,a,o){var c=(o+"").match(et),u=dn.rawId(r);return n.createLinkEndDragger(e,hn,t,vn,gn[u],c[1],i,a,u)},hn.createDragger=function(t,i,a,o,c,u,s,l){var f=s.handMode,d=dn.rawId(o),h=tn(o);if(h){var v=rn(o),g=l;return n.primitiveMover(fn,i,a,d,g,!0,v,c,u,function(n){e.trigger("prechange","resize");var t=vn[dn.rawId(o)],r=n.a,i=r?r.x:0,a=r?r.y:0;if("C"===n.p)t.x=i+n.x,t.y=a+n.y,t.w=t.h=2*n.r;else{var c=i+n.x1,u=a+n.y1,s=i+n.x2,l=a+n.y2;t.x=c+Math.floor((s-c)/2),t.y=u+Math.floor((l-u)/2),t.w=s-c,t.h=l-u}In(t.id)})}if(null!==d&&gn[d]){var y=(o+"").match(et);return y?n.createLinkEndDragger(t,hn,a,vn,gn[d],y[1],c,u,d):n.createLinkDragger(r,i,a,hn,gn[d],c,u,d)}return f&&null===o?n.createHandDragger(a,c,u,Xn):null!==d?(V(),n.createDefaultDragger(hn,on,cn,qn,a,o,c,u)):nt(a,c,u)};var nt=function(n,t,r){function i(e,t){s.x1=Math.min(n.worldToViewX(l),e),s.y1=Math.min(n.worldToViewY(f),t),s.x2=Math.max(n.worldToViewX(l),e),s.y2=Math.max(n.worldToViewY(f),t),d.x1=n.viewToWorldX(s.x1),d.y1=n.viewToWorldY(s.y1),d.x2=n.viewToWorldX(s.x2),d.y2=n.viewToWorldY(s.y2)}function a(e,n,t){for(var r in e)e[r]?Yn(r,!0):n||t?c[r]||Gn(r,!0):Gn(r,!0)}function o(e,n,t,r){V(),i(e,n);var o={};for(var c in on)o[c]=fn.inside(d,on[c].x,on[c].y);if("off"!==sn)for(var u in cn)if("centre"===sn)o[u]=fn.inside(d,cn[u]._x,cn[u]._y);else if("ends"===sn){var s=on[cn[u].id1],l=on[cn[u].id2];o[u]=fn.inside(d,s.x,s.y)&&fn.inside(d,l.x,l.y)}a(o,t,r)}if(!e.trigger("dragstart","area",null,n.unscale(t),n.unscale(r),null)){var c={};for(var u in Vn)c[u]=1;var s={p:fn.primitives.rect,x1:t,y1:r,x2:t,y2:r,bc:fn.colours.midgrey,bw:1,fc:fn.colours.blue,fi:!1},l=n.viewToWorldX(t),f=n.viewToWorldY(r),d={x1:l,y1:f,x2:l,y2:f};s.wbc=fn.webglColour(s.bc),s.wfc=fn.webglColour(s.fc);var h={scrollable:!0,getCursor:function(){return"crosshair"},generate:function(e){var n=e.getLayer();e.setLayer(fn.layers.HANDLES),e.copyPrimitive(s),e.setLayer(n)},dragMove:function(e,n,t,r){o(e,n,t,r)},endDrag:function(t,r,i){n.cancelScroll();var a=e.trigger("dragend","area",null,n.unscale(r),n.unscale(i));a||(t?e.trigger("selectionchange"):Xn()),e.trigger("dragcomplete","area",null,n.unscale(r),n.unscale(i))}};return h}};return hn.createGestureDragger=function(n,t,r){function i(e,t,r){var i=2*-e*Math.PI/360;i*=2;var a=Math.sin(i),o=Math.cos(i);for(var c in vn){var u=(d[c].x-l)*o+(d[c].y-f)*a+l,s=-(d[c].x-l)*a+(d[c].y-f)*o+f;An(c,u,s)}var h=n.viewToWorldX(t),v=n.viewToWorldY(r);for(var g in vn)An(g,vn[g].x+h-l,vn[g].y+v-f)}function a(e){e=Math.pow(e,2),n.zoomToPosition(e*s,t,r)}function o(e,n,t,r){v=e,g=n,y=t,m=r}function c(){a(v),x=x||Math.abs(g)>12,p=p||Math.abs(y-l)>w||Math.abs(m-f)>w,i(x?g:0,p?y:l,p?m:f)}function u(){for(var e in vn)An(e,d[e].x,d[e].y)}var s=n.zoom(),l=n.viewToWorldX(t),f=n.viewToWorldY(r),d={};for(var h in vn)d[h]={x:vn[h].x,y:vn[h].y};var v,g,y,m;o(1,0,l,f);var x=!1,w=60,p=!1,b={animate:function(){c()},getCursor:function(){return"move"},dragMove:function(e,n,t,r){o(e,n,t,r)},endDrag:function(n,t,r,i,a){o(t,r,i,a),n?(u(),e.trigger("prechange","move"),c()):u()}};return b},hn.labelPosition=function(e,n){var r=Fn(e);return t.labelPosition(r,n)},hn.extractStructure=function(e,n,r){return n.straighten&&$(),Ln.extractStructure(t,e,vn,gn,Sn,n.fixed,r)},hn.layout=function(e,n,t,r,i,a){Ln.layout(e,n,t,Sn,r,i,a)},hn.arrange=function(e,n,t,r,i,a){Ln.arrange(e,n,t,r,i,a)},hn.applyVertices=function(e){for(var n in vn)e[n]&&An(n,e[n].x,e[n].y)},hn.makeAnimator=function(e,n,t){var r=n,i={};for(var a in vn)i[a]={x:vn[a].x,y:vn[a].y};return ln.buildAnimatorInstance(function(a){r-=a;var o=t(Math.max(0,(n-r)/n));for(var c in vn)if(e[c]){var u=i[c].x+o*(e[c].x-i[c].x),s=i[c].y+o*(e[c].y-i[c].y);An(c,u,s)}return r>0},{all:!0})},hn}}(),!function(){function e(e,n,t){return function(){if(!t||!t()){var r,i=n[e];return i&&(r=i.apply(null,arguments)),r}}}var n=KeyLines.Common={};n.frameManager=function(e,n){function t(){return{all:!0,colours:!0,textures:!0,positions:!0,shadow:!0}}function r(){u.all=!1,u.colours=!1,u.textures=!1,u.positions=!1,u.shadow=!1}var i=(new Date).getTime(),a=i>>10,o=0,c=!1,u=t(),s=!0,l=0;return{frameRate:function(){return l},update:function(){var t=(new Date).getTime(),f=t>>10;f>a?(l=Math.round(o/(f-a)),o=0,a=f):o++;var d=n(t-i);i=t,c=c||d,c&&(c=!1,s&&(e(null,u),r()))},redraw:function(e){c=!0,e=e||t(),u.all||(u.all=e.all),u.positions||(u.positions=e.positions),u.shadow||(u.shadow=e.shadow),u.textures||(u.textures=e.textures),u.colours||(u.colours=e.colours)},allowDraw:function(e){e&&!s&&(c=!0),s=e}}},n.buildAnimatorInstance=function(e,n,t){var r=!0;return{rebuild:n,animate:function(n){var i=n;r&&!t&&(i=16);var a=e(i,r);return r=!1,a}}},n.animator=function(e){var n=[],t=[];return{push:function(e,r){e&&(e.queue=r,r?t.push(e):n.push(e))},cancel:function(){n=[],t=[],e()},animate:function(r,i,a){var o=!1,c=!1;if(n.length>0){var u=n;n=[];for(var s=0;s<u.length;s++)u[s].animate(r)&&(c=c||u[s].queue,n.push(u[s])),e(u[s].rebuild);o=!0}return c||t.length>0&&(n.push(t.shift()),o=!0),i&&i.animate&&(i.animate(r),o=!0),a&&(o=o||a.animated()),o}}},n.makeValueAnimator=function(e,t){var r,i,a,o;return function(c,u,s){var l=t();l===c||o&&i===c||(r=l,i=c,a=0,o||(o=n.buildAnimatorInstance(function(e){a=Math.min(u,a+e);var n=0>=u?i:r+(i-r)*a/u;t(n);var c=u>a;return c||(o=null,KeyLines.Util.invoke(s)),c}),e.push(o,!1)))}};var t=["mousemove","mousedown","mouseup","mouseleave","mousewheel","dblclick","touchstart","touchmove","touchend","touchcancel","keyup","keydown","gesturestart","gesturechange","gestureend","dragover"];n.appendActions=function(n,r,i){for(var a=0;a<t.length;a++)n[t[a]]=e(t[a],r,i)},n.hitTester=function(e,n,t,r){function i(e,i){o.clear(e,n,t),o.backFill(e,c,1,n,t),r.drawShadowCanvas(e,i),u=!1}var a,o=KeyLines.Rendering,c=o.randomColour(),u=!0,s=5,l=function(){var e={},n={};return{getColour:function(t){if(t in e)return e[t];var r=o.randomColour(n);return e[t]=r,n[r]=t,r},getId:function(e){return n[e]||null}}}();r.setShadowColourMap(l);var f={};return f.test=function(n,t,r,i,a){var d=[0,0,0];a&&a.webgl?d=a.webglCanvas.renderer.drawShadowCanvas(Math.floor(n),Math.floor(t)):(u&&f.draw(r),d=e.getImageData(Math.floor(n),Math.floor(t),1,1).data);var h=o.rgbtostring(d[0],d[1],d[2]);if(h===c)return null;var v=l.getId(h);return v?v:a&&a.webgl?null:(i=i||1,i>s?null:n+i>s&&t+i>s?f.test(n-1,t-1,r,++i,a):f.test(n+1,t+1,r,++i,a))},f.dirty=function(){u=!0},f.debugCanvas=function(e){a=e},f.draw=function(n){i(e,n),a&&i(a,n)},f}}(),!function(){var e=KeyLines.API=KeyLines.API||{};e.appendExtras=function(e){function n(e,n){return"all"===e||e===n.type}var t=null;e.bind("redraw",function(){t=null}),e.each=function(r,i){t=t||e.serialize().items;var a=t;if(r=KeyLines.Util.defaults(r,{type:"all"}),!r.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");if(KeyLines.Util.isFunction(i))for(var o=0;o<a.length;o++)n(r.type,a[o])&&i(a[o])}}}(),!function(){var e=KeyLines.Layouts=KeyLines.Layouts||{};e.create=function(){function e(e,t,r,i,a,o,c,u,s){var l=a[c];if(!(l in r)){if(!(l in i))throw"link has end which is not in nodes list";var f=i[l];if(f.hi)throw"link has end which is hidden";r[l]=n(e,t,f,l,u,s)}return l}function n(e,n,t,r,i,a){return{id:r,x:t.x,y:t.y,size:e.nodeSize(t,n,a),fixed:i?r in i:!1,lc:0}}function t(e,n){return e.fixed&&!n.fixed?-1:n.fixed&&!e.fixed?1:0}function r(t,r,i,a,o,c,u){for(var s=o().connections({all:!1}),l={},f=[],d=0;d<s.length;d++){var h=s[d][0],v=a[h],g=e(t,r,l,i,v,h,"id1",c,u),y=e(t,r,l,i,v,h,"id2",c,u);null!==g&&null!==y&&(f.push({id1:g,id2:y,id:h}),l[g].lc+=1,l[y].lc+=1)}var m;for(m in i)if(m+="",!i[m].hi&&!l[m]){var x=n(t,r,i[m],m,c,u);l[m]=x}var w=0;for(m in l)w++;return{v:l,e:f,vcount:w}}function i(e,n){var t,r,i,o,c=0,u=[];for(t in e)if(t+="",!e[t].hasOwnProperty("c")){var s=c++;for(u.push(t+"");u.length>0;){var l=u.shift();if(!e[l].hasOwnProperty("c"))for(e[l].c=s,r=0;r<n.length;r++)i=n[r].id1+"",o=n[r].id2+"",i===l&&(n[r].c=s,u.push(o)),o===l&&(n[r].c=s,u.push(i))}}for(var f=new Array(c),d=0;d<f.length;d++)f[d]={verts:{},edges:[]};for(t in e)t+="",f[e[t].c].verts[t]=e[t];for(r=0;r<n.length;r++)f[n[r].c].edges.push(n[r]);for(var h=0;h<f.length;h++)f[h].extents=a(f[h].verts);return f}function a(e){var n,t,r,i,a=0;for(var o in e){var c=e[o+""];n=n?Math.min(n,c.x-c.size):c.x-c.size,t=t?Math.min(t,c.y-c.size):c.y-c.size,r=r?Math.max(r,c.x+c.size):c.x+c.size,i=i?Math.max(i,c.y+c.size):c.y+c.size,a++}return{x1:n,y1:t,x2:r,y2:i,c:a}}function o(e,n,t,r){for(var i,a,o,c,u=r(),s=0;s<t.length;s++){var l=u.distances(t[s]);for(var f in l)f+="",e[f].hasOwnProperty("level")||(e[f].level=1/0),e[f].level=Math.min(e[f].level,l[f])}for(var d=0;d<n.length;d++)i=n[d].id1+"",a=n[d].id2+"",o=e[i],c=e[a],o.hasOwnProperty("level")&&c.hasOwnProperty("level")&&(n[d].level=Math.max(o.level,c.level))}function c(e,n){function t(e,n,t,i){r[e]=r[e]||[],r[e][n]=r[e][n]||{},r[e][n][t]=r[e][n][t]||[],r[e][n][t].push(i)}var r={};for(var i in e)i+="",e[i].hasOwnProperty("level")&&t(e[i].c,e[i].level,"vertices",i);for(var a=0;a<n.length;a++)n[a].hasOwnProperty("level")&&t(n[a].c,n[a].level,"edges",n[a]);return r}function u(e,n){for(var t=[],r=0;r<e.length;r++)n[e[r]]&&t.push(e[r]);return t}function s(e){var n=Number(e);return n=isNaN(n)?5:n,n=Math.max(0,n),n=Math.min(10,n)}function l(e){return 10*(5-s(e))}function f(e){var n=26,t=0,r=0;for(var i in e)i+="",e[i].hasOwnProperty("level")&&(n=Math.max(n,e[i].size),t+=e[i].size,r+=1);return t/r}function d(e,n,t,r,a,s){function d(){var e,n,t,r=0,i=0;for(n in E)for(var a=E[n].length-1;a>=0;a--)for(var o=E[n][a].vertices,c=[],u=0;u<o.length;u++){t=o[u]+"";var s=h(E,p,t);if(p[t].children=[],p[t].subChildrenCount=0,0===s.length)r++;else{var l=[];for(e=0;e<s.length;e++)U.indexOf(c,s[e])<0&&l.push(s[e]);if(l.length>0)for(p[t].children=l,p[t].subChildrenCount=v(l),e=0;e<l.length;e++)c.push(l[e]),p[l[e]].parent=t}i++}}function v(e){for(var n=0,t=0;t<e.length;t++){var r=p[e[t]].subChildrenCount;n+=0===r?1:r}return n}function g(e,n,t){t||(e.x=n);var r=n-e.subChildrenCount*C/2,i=e.children;if(i)for(var a=0;a<i.length;a++){var o=p[i[a]],c=o.subChildrenCount;0===c&&(c=1);var u=r+c*C;g(o,(u+r)/2,!1),r=u}}function y(e,n){for(var t,r=0;r<E[e].length;r++)for(var i=E[e][r].vertices,a=0;a<i.length;a++){t=i[a]+"";var o=p[t];o.y=n.miny+2*r*(D+12)}}function m(e,n){for(var t,r={up:function(e){e.y=-e.y,e.x=-e.x},down:function(){},right:function(e){var n=e.y;e.y=-e.x,e.x=n},left:function(e){var n=e.y;e.y=e.x,e.x=-n}},i=r[n]||r.down,a=0;a<E[e].length;a++)for(var o=E[e][a].vertices,c=0;c<o.length;c++)t=o[c]+"",i(p[t])}var p=n.v,b=n.e,M=i(p,b),L=n.extents;r=U.defaults(r,{top:[],orientation:"down",stable:!0});var S=s?1:l(r.tightness);M.length;var k=r.top;k=u(k,p);var A=r.tidy;o(p,b,k,t);var E=c(p,b),D=f(p),C=2*D+24+S;d();var O,T={},P={};for(O in E){var N=Number(O);T[N]=I(M[N].verts),P[N]={children:E[O][0].vertices,subChildrenCount:v(E[O][0].vertices)}}for(O in E)g(P[O],T[O].x,!0),y(O,T[O]);for(O in E)s||m(O,r.orientation);s&&s(p,E,M,T,D,r.tightness);var z=[];A?x(e,p,M,0,1,L,z,r,a):w(e,p,L,z,r,a)}function h(e,n,t){var r,i,a,o,c=n[t].c,u=n[t].level+1,s=e[c][u],l={},f=[];if(s){for(a=0;a<s.edges.length;a++){var d=s.edges[a];r=d.id1+"",i=d.id2+"",r===t&&(l[i]=1),i===t&&(l[r]=1)}var h=s.vertices;for(o=0;o<h.length;o++)r=h[o]+"",l[r]&&f.push(r)}return f}function v(e,n){var t=e.extents.c,r=Math.max(e.extents.x2-e.extents.x1,e.extents.y2-e.extents.y1),i=120*Math.sqrt(t),a=Math.max(r,i)/2,o=0;t>1&&(o=Math.min(Math.pow(t,2.5),100));var c=o*t*Math.log(t),u=1/g(n);return{repulsionFactor:40*Math.max(1,Math.pow(u,2)),coeff:1,naturalDistance:20*u,iterations:o,chunk:20,temperature:a,temp:a,estTime:c}}function g(e){var n=s(e.tightness);return Math.pow(2,2*(n-5)/5)}function y(e,n,t,r){function a(n){var t=l[n],r=b[n];M(e,t,r,r.start,r.stop,function(){S(t.verts),n++,n<l.length?U.nextTick(function(){a(n)},0):o()})}function o(){h?x(e,c,l,p,1,f,d,t,r):w(e,c,f,d,t,r)}var c=n.v,u=n.vcount,s=n.e,l=i(c,s),f=n.extents,d=t.fixed||[],h=t.tidy;k(c);var g=l.length,y=u/(u+g),m=0,p=h?y:1;e.trigger("progress","layout",0);for(var b=[],L=0,I=0;I<l.length;I++){var A=v(l[I],t);L+=A.estTime,b.push(A)}var E=0;for(I=0;I<l.length;I++){b[I].start=E;var D=E+(p-m)*b[I].estTime/L;b[I].stop=D,E=D}l.length>0?a(0):w(e,c,f,d,t,r)}function m(e){for(var n in e)if(n+="",e[n].fixed)return!0;return!1}function x(e,n,t,r,i,a,o,c,u){for(var s={},l=[],f={},d=1/0,h=1/0,v=0;v<t.length;v++){var g=A(t[v].verts);s[v]=g;var y=o.length>0&&m(t[v].verts);l.push({x:g.x,y:g.y,width:g.width,height:g.height,id:v,fixed:y}),f[v]={x:g.x,y:g.y},d=Math.min(d,f[v].x),h=Math.min(h,f[v].y)}c=U.defaults(c,{strategy:"rect",ratio:4/3}),T(l,{strategy:c.strategy,step:30,max:2,sort:!1,ratio:c.ratio,tightness:c.tightness},function(t){d="rect"===c.strategy?d:0,h="rect"===c.strategy?h:0;for(var r={},i=0;i<t.length;i++)r[t[i].id]=t[i],r[t[i].id].x+=d,r[t[i].id].y+=h;for(var s in n){var l=n[s+""],v=r[l.c].x-f[l.c].x,g=r[l.c].y-f[l.c].y;l.x+=v,l.y+=g}w(e,n,a,o,c,u)})}function w(e,n,t,r,i,o){var c=a(n);0===r.length&&(c=L(n,t,c)),isNaN(c.x1)&&(c=null),e.trigger("progress","layout",1),o({vertices:n,extents:c},i)}function p(e,n,t){var r=e[n.id1],i=e[n.id2];if(!r.fixed||!i.fixed){var a=2*Math.random()*Math.PI,o=(r.x+i.x)/2,c=(r.y+i.y)/2,u=1.3*E(r,i,t)/2;r.x=o+u*Math.cos(a),r.y=c+u*Math.sin(a),a+=Math.PI,i.x=o+u*Math.cos(a),i.y=c+u*Math.sin(a)}}function b(e,n,t){for(var r=Math.min(e.i+t.chunk,t.iterations);e.i<r;){var i=n.verts,a=n.edges,o=0;for(var c in i)c+="",i[c].dx=i[c].dy=0,o++;if(1===o)return e.i=r,void 0;if(2===o)return p(i,a[0],t.naturalDistance),e.i=r,void 0;O(i,t.repulsionFactor);for(var u=0;u<a.length;u++)D(a[u],i,t.naturalDistance,t.coeff);var s=e.temperature*(1-e.i/t.iterations);for(var l in i)l+="",C(i[l],s);e.i++}}function M(e,n,t,r,i,a){function o(){return r+(i-r)*l.i/t.iterations}function c(){return l.i>=t.iterations}function u(){b(l,n,t)}function s(){u(),c()?a():(e.trigger("progress","layout",o()),U.nextTick(s,0))}var l={i:0,temperature:t.temperature};s()}function L(e,n,t){var r=(t.x1+t.x2)/2-(n.x1+n.x2)/2,i=(t.y1+t.y2)/2-(n.y1+n.y2)/2;for(var a in e)a+="",e[a].x-=r,e[a].y-=i;return{x1:t.x1-r,y1:t.y1-i,x2:t.x2-r,y2:t.y2-i}}function S(e){var n,t,r,i,a=0,o=0,c=0,u=!1,s=0,l=0;for(i in e)i+="",a+=e[i].x,o+=e[i].y,c+=1,u|=e[i].fixed;if(!(3>c||u)){a/=c,o/=c;for(i in e)i+="",n=Math.sqrt((e[i].x-a)*(e[i].x-a)+(e[i].y-o)*(e[i].y-o)),n>l&&(l=n,s=Math.atan2(e[i].y-o,e[i].x-a));s=-s;for(i in e)t=a+(e[i].x-a)*Math.cos(s)-(e[i].y-o)*Math.sin(s),r=o+(e[i].x-a)*Math.sin(s)+(e[i].y-o)*Math.cos(s),e[i].x=t,e[i].y=r}}function k(e){var n=30;for(var t in e)t+="",e[t].fixed||(e[t].x+=n*(Math.random()-.5),e[t].y+=n*(Math.random()-.5))}function I(e){var n,t=0,r=0,i=0,a=1/0,o=1/0,c=-1/0,u=-1/0;for(n in e)n+="",t+=1,r+=e[n].x,i+=e[n].y,o=Math.min(o,e[n].x),a=Math.min(a,e[n].y),c=Math.max(c,e[n].x),u=Math.max(u,e[n].y);r/=t,i/=t;var s=0,l=!1;for(n in e){n+="";var f=e[n].x-r,d=e[n].y-i,h=Math.sqrt(f*f+d*d);s=Math.max(h+1.5*e[n].size,s),l=l||e[n].fixed}return{x:r,y:i,sum:t,size:s,fixed:l,miny:a,minx:o,maxy:u,maxx:c}}function A(e,n){U.isNullOrUndefined(n)&&(n={});var t,r=20,i=1/0,a=1/0,o=-1/0,c=-1/0;for(t in e)t+="",t in n||(a=Math.min(a,e[t].x-e[t].size),i=Math.min(i,e[t].y-e[t].size),o=Math.max(o,e[t].x+e[t].size),c=Math.max(c,e[t].y+e[t].size));return a-=r,i-=r,o+=r,c+=r,{x:a,y:i,width:o-a,height:c-i}}function E(e,n,t){return e.size+n.size+t*(1+((e.lc?e.lc:1)+(n.lc?n.lc:1))/6)}function D(e,n,t,r){var i=n[e.id1],a=n[e.id2],o=i.x-a.x,c=i.y-a.y,u=E(i,a,t),s=U.len(o,c);if(s>.02){var l=r*(s-u)/s,f=o*l,d=c*l;i.dx-=f,i.dy-=d,a.dx+=f,a.dy+=d}}function C(e,n){if(!e.fixed){var t=U.len(e.dx,e.dy),r=e.dx/t*Math.min(t,n),i=e.dy/t*Math.min(t,n);e.x+=r,e.y+=i}}function O(e,n){function t(e,n,t,r){return{leaf:!0,nodes:{},point:null,x1:e,y1:n,x2:t,y2:r}}function r(e,n){var r=e.x1,a=e.y1,o=e.x2,c=e.y2,u=.5*(r+o),s=.5*(a+c),l=n.x>=u,f=n.y>=s,d=(f<<1)+l;e.leaf=!1,l?r=u:o=u,f?a=s:c=s,e=e.nodes[d]||(e.nodes[d]=t(r,a,o,c)),i(e,n)}function i(e,n){if(e.leaf){var t=e.point;t?Math.abs(t.x-n.x)+Math.abs(t.y-n.y)<.01?r(e,n):(e.point=null,r(e,t),r(e,n)):e.point=n
}else r(e,n)}function a(e,n){if(!e(n))for(var t=n.nodes,r=0;4>r;r++)t[r]&&a(e,t[r])}function o(e){var n=0,t=0;if(e.charge=0,e.size=0,!e.leaf)for(var r=e.nodes,i=0;4>i;i++){var a=r[i];a&&(o(a),e.charge+=a.charge,e.size+=a.size,n+=a.charge*a.cx,t+=a.charge*a.cy)}if(e.point){var c=s(e.point);e.charge+=e.pointCharge=c,e.size+=e.point.size,n+=c*e.point.x,t+=c*e.point.y}e.cx=e.charge?n/e.charge:0,e.cy=e.charge?t/e.charge:0}function c(e){if(e.point!==w){var n=e.cx-w.x,t=e.cy-w.y,r=1/U.len(n,t);if((e.x2-e.x1)*r<p)return u(w,e,e.charge,r,n,t),M++,!0;e.point&&(u(w,e.point,e.pointCharge,r,n,t),b++)}return!e.charge}function u(e,n,t,r,i,a){r>L&&(r=L),l(e,t,i,a,r)}function s(e){return e.size*(1+(e.lc?e.lc:1)/3)}function l(e,t,r,i,a){if(!(.001>a)){var o=n*s(e)*t*a*a*a;e.dx-=r*o,e.dy-=i*o}}function f(){for(var n in e)n+="",w=e[n],a(c,S)}var d,h,v,g,y=I(e);d=y.minx,v=y.miny,h=y.maxx,g=y.maxy;var m=h-d,x=g-v;m>x?g=v+m:h=d+x;var w,p=.5,b=0,M=0,L=1e5,S=t(d,v,h,g);for(var k in e)k+="",i(S,e[k]);return o(S),f(),S}function T(e,n,r){function i(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)}function a(e,n,t){return(n-e)*t+e}function o(e,n,t){return(e-t)/(n-t)}function c(e){var t=function(){for(var n=0,t=-1/0,r=0;r<e.length;r++)n+=e[r].width*e[r].height,t=Math.max(t,e[r].width);return{area:n,maxWidth:t}},r=1.1,i=1.03,a=10,o=t(),c=Math.sqrt(o.area*r/n.ratio)*i,u=c*n.ratio;return u<o.maxWidth+a&&(u=o.maxWidth+a),{x:0,y:0,width:u,height:c}}function u(e,n,t,r,i,c){var u=o(n,t,r);return u=Math.pow(u,e),a(c,i,u)}function s(e,n){if(!n)return!1;var t=e.x<y.x+y.width,r=e.x+e.width>y.x,i=e.y<y.y+y.height,a=e.y+e.height>y.y;return t||r&&i||a}function l(e,n){function t(e,n){var t=e.y<n.y+n.height,r=e.y+e.height>n.y;return t&&r}function r(e,n){var t=e.x<n.x+n.width,r=e.x+e.width>n.x;return t&&r}if(n.length<1)return!1;var i,a;for(i=0;i<n.length;i++)if(a=n[i],r(e,a)&&t(e,a))return!0;return!1}var f,d,h,v={spiral:function(e){var n=u(.6,e,100,0,w,1),t=u(1,e,600,0,.3,.5),r=t*e,i=Math.cos(r)*n,a=Math.sin(r)*n;return{x:i,y:a}},controlled:function(e,n){for(var t;!s(n,t);)t=v.random(e);return t},rect:function(e){return P(e,n,r)},random:function(e){var n=.5*e;return{x:i()*n,y:i()*n}}},g=0,y=c(e),m=[],x=v[n.strategy]||v.rect,w=0;for(f=0;f<e.length;f++)d=e[f],w+=d.width;if(w/=2*e.length,"rect"===n.strategy)return x(e);for(e.sort(t),f=0;f<e.length;f++){for(d=e[f],d.x=d.fixed?d.x:0,d.y=d.fixed?d.y:0;l(d,m)&&!d.fixed;)h=x(g,d),d.x=h.x,d.y=h.y,g++;m.push(d)}return r(m)}function P(e,n,r){function i(){for(var n=0,t=0;t<e.length;t++)n+=e[t].width*e[t].height;return n}function a(e,n){var r=t(e,n);return r?r:n.height-e.height}function o(e){for(var n=0,t=0;t<e.length;t++)n<e[t].width&&(n=e[t].width);return n}function c(e){for(var t=U.clone(e),r=0;r<t.length;r++){var i=t[r].width%n.step,a=t[r].height%n.step;0!==i&&(t[r].width=t[r].width+(n.step-i)),0!==a&&(t[r].height=t[r].height+(n.step-a))}return t}function u(e){return v?e.ratio()>=n.ratio-.2&&e.ratio()<=n.ratio:!0}function s(e){for(var t=l(n.tightness),r=0;r<e.length;r++)e[r].width+=t,e[r].height+=t}function f(e){var t=1.1,r=1.03,i=10,a=Math.sqrt(e.area()*t/n.ratio)*r,o=a*n.ratio;return o<e.maxWidth+i&&(o=e.maxWidth+i),{width:o,height:a,lowestFreeHeightDeficit:0,ratio:function(){return y.width/y.height}}}n=U.defaults(n,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),n.sort&&e.sort(a),s(e);var d,h=c(e),v=!0;if(0===e.length)return d=z(),r(d.comps);var g={area:i,maxWidth:o(h),maxHeight:h[0].height},y=f(g,h),m=0;U.asyncWhile(function(){return y.width>=g.maxWidth},function(){var e=N(h,y);if(0===e.comps.length)y.width*=1.03,y.height*=1.03;else{if(m++,(!d||u(e))&&(d=e,d.efficiency=g.area()/e.area(),u(e)))return!0;if(m>=n.max)return!0}},function(){return r(d.comps)})}function N(e,n){var t,r=z();n.canvas||(n.canvas=K());for(var i=n.canvas.setDimensions(n.width,n.height),a=0,o=0,c=0;c<e.length;c++){var u=e[c];if(t=i.addRect(u.width,u.height),!t.placed){r.width=0,r.height=0,r.comps.length=0,r.lowestHeightFlushedRightItem=0;break}u.x=t.offsetX,u.y=t.offsetY,r.comps.push(u),u.y+u.height>r.height&&(r.height=u.y+u.height),u.x+u.width>r.width&&(r.width=u.x+u.width);var s=u.width+u.x;(s>o||s===o&&u.height>a)&&(r.lowestHeightFlushedRightItem=t.lfhd,a=u.height,o=s)}return n.lowestFreeHeightDeficit=i.lfhDeficitSinceLastRedim(),r}function z(){var e={width:0,height:0,area:function(){return e.width*e.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return 0===e.width?1/0:e.width/e.height}};return e}function K(){function e(e,n){var t=l.height-e;return n-t}function n(e,n,t){if(t.leftOverW>0){l.cells+=u.rows();var r=e+t.nRequiredCellsH-1;u.insertCol(r,t.leftOverW)}if(t.leftOverH>0){l.cells+=u.cols();var i=n+t.nRequiredCellsV-1;u.insertRow(i,t.leftOverH)}for(var a=e+t.nRequiredCellsH-1;a>=e;a--)for(var o=n+t.nRequiredCellsV-1;o>=n;o--)u.setItem(a,o,!0)}function t(e,n,t,r){r.nRequiredCellsH=0,r.nRequiredCellsV=0,r.leftOverW=0,r.leftOverH=0;for(var i,a=0,o=0,c=n;o<t.height;){for(i=e,a=0;a<t.width;){if(u.item(i,c))return!1;a+=u.colWidth(i),i++}o+=u.rowHeight(c),c++}return r.nRequiredCellsH=i-e,r.nRequiredCellsV=c-n,r.leftOverW=a-t.width,r.leftOverH=o-t.height,!0}function r(e,n,t){var r=0,i=0,a=0,o=0,c=0;for(a=0;e>a;a++)r+=u.colWidth(a);for(a=0;n>a;a++)i+=u.rowHeight(a);if(o=t.x-r,c=t.y-i,0>o||0>c)return!1;if(o>0){l.cells+=u.rows();var s=u.colWidth(e)-o;u.insertCol(e,s)}if(c>0){l.cells+=u.cols();var f=u.rowHeight(n)-c;u.insertRow(n,f)}return!0}function i(e,n){return l.width=e,l.height=n,l.area=o(),u.init(e,n,!1),l}function a(i,a,o){var c={offsetX:0,offsetY:0,width:i,height:a,placed:!1},f=0,d=0,h=0,v=0,g={};if(o){for(;f<u.cols()&&h<o.x;)h+=u.colWidth(f),f++;for(;d<u.rows()&&v<o.y;)v+=u.rowHeight(d),d++;r(f-1,d-1,o),h-=u.colWidth(f),v-=u.rowHeight(d)}l.addAttempts++;for(var y=B;;){for(g={};d<u.rows()&&u.item(f,d);)v+=u.rowHeight(d),d++;if(d<u.rows()&&e(v,c.height)<=0){if(t(f,d,c,g)){n(f,d,g),c.offsetX=h,c.offsetY=v,c.placed=!0;break}v+=u.rowHeight(d),d++}var m=e(v,c.height);if(m>0&&(v=0,d=0,h+=u.colWidth(f),f++,l.lfhDeficitSinceLastRedim()>m&&(s=m)),l.width-h<c.width){c.placed=!1;break}}return y=s,{offsetX:c.offsetX,offsetY:c.offsetY,lfhd:y,placed:c.placed}}function o(){return l.width*l.height}var c=0,u=R(),s=B,l={matrix:u,cells:c,addAttempts:0,addRect:a,lfhDeficitSinceLastRedim:function(){return s},setDimensions:i};return l}function R(){function e(){(a.length>0||o.length>0)&&(a.length=o.length=c.length=0)}function n(n,t,r){if(0>=n)throw"[Matrix] Column size cannot be 0 or similar";if(0>=t)throw"[Matrix] Row size cannot be 0 or similar";return u=1,s=1,e(),a.push({index:0,size:n}),o.push({index:0,size:t}),c[0]=[],c[0][0]=r,l}function t(e,n){for(var t=o[e].index,r=0;s>r;r++)c[r][u]=c[r][t];return u-1>e&&o.splice(e+1,0,{index:u,size:n}),o[e+1]={index:u,size:n},o[e].size-=n,u++,l}function r(e,n){var t=(c[0].length,a[e].index);return c[s]=U.clone(c[t]),s-1>e&&a.splice(e+1,0,{index:s,size:n}),a[e+1]={index:s,size:n},a[e].size-=n,s++,l}function i(){var e,n,t,r="\n     ",i=0,c=0;for(i=0;s>i;i++)e=0===Math.floor(a[i].size/100)%10?" ":""+Math.floor(a[i].size/100)%10,n=0===Math.floor(a[i].size/10)%10&&" "===e?" ":""+Math.floor(a[i].size/10)%10,t=0===Math.floor(a[i].size)%10&&" "===e&&" "===n?" ":""+Math.floor(a[i].size)%10,r+=a[i].size>999?" "+a[i].size+" ":" "+e+n+t+" ";for(r+="\n",i=0;u>i;i++){for(e=0===Math.floor(o[i].size/100)%10?" ":""+Math.floor(o[i].size/100)%10,n=0===Math.floor(o[i].size/10)%10&&" "===e?" ":""+Math.floor(o[i].size/10)%10,t=0===Math.floor(o[i].size)%10&&" "===e&&" "===n?" ":""+Math.floor(o[i].size)%10,r+=o[i].size>999?" "+o[i].size+": ":" "+e+n+t+": ",c=0;s>c;c++)r+=l.item(c,i)?"  X  ":"  .  ";r+="\n"}return r}var a=[],o=[],c=[],u=0,s=0,l={init:n,cols:function(){return s},rows:function(){return u},item:function(e,n){return c[a[e].index][o[n].index]},setItem:function(e,n,t){c[a[e].index][o[n].index]=t},insertRow:t,insertCol:r,colWidth:function(e){return a[e].size},rowHeight:function(e){return o[e].size},inspect:i};return l}var U=KeyLines.Util;KeyLines.Graph;var W={};W.extractStructure=function(e,n,t,i,o,c,u){var s=null;if(c){s={};for(var l=0;l<c.length;l++)s[c[l]]=1}var f=r(e,n,t,i,o,s,u);return f.extents=a(f.v),f},W.layout=function(e,n,t,r,i,a){n.trigger("prechange","layout");var o="^(standard|hierarchy";o+=")$";var c=new RegExp(o);if(!c.test(e))throw new Error("The layout name is not valid.");"standard"===e&&y(n,t,i,a),"hierarchy"===e&&d(n,t,r,i,a)};var B=16e6;return W}}(),!function(){function e(){return"undefined"!=typeof window?window.devicePixelRatio||1:void 0}var n=KeyLines.Canvas={},t=8888;n.create=function(n,r,i,a,o,c,u){function s(e,n){var t,r=document.createElement("canvas");return t=u?document.createElement("canvas").getContext("2d"):r.getContext("2d"),r.context2d=t,r.height=n,r.width=e,u||d(r),r}function l(n,t){var r=e(),i=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,a=r/i;if(r!==i){var o=n.width,c=n.height;n.width=Math.round(o*a),n.height=Math.round(c*a),n.style.width=o+"px",n.style.height=c+"px",u||t.scale(a,a)}}function f(){if(!KeyLines.Rendering.minimumFontChecked){for(var e="Hello",n=s(100,100).context2d,t=!1,r=function(t){return KeyLines.Rendering.setFont(n,t),n.measureText(e).width},i=r(1),a=2;!t&&30>a;){var o=r(a);t=i!==o,t&&(KeyLines.Rendering.browserMinimumFontSize=a-1),a++}KeyLines.Rendering.minimumFontChecked=!0}}function d(e){function n(e){t.setLineDash=function(n){t[e]=n}}var t=e.getContext("2d");t.setLineDash||("undefined"!=typeof t.webkitLineDash?n("webkitLineDash"):"undefined"!=typeof t.mozDash&&n("mozDash"))}function h(){return new Image}function v(){b.update(),L(v)}var g=s(i,a),y={},m=g.context2d,x=document.getElementById(r);x.style.display="block",x.parentNode.replaceChild(g,x),g.setAttribute("id",r),u&&KeyLines.webGLSupport()&&"chart"===n&&(y.renderer=g.renderer=KeyLines.WebGL.create(g),g.webgl=!0),g.canvas=!0;var w=g;g.webgl?(m.webgl=!0,m.webglCanvas=g):m.webgl=!1,l(g,m),f();var p=w.getAttribute("style")||"";p+="-ms-touch-action: none; touch-action: none; outline: none;",w.setAttribute("style",p),w.setAttribute("tabindex",""+t++);var b="chart"===n?KeyLines.API.createAPI(r):KeyLines.TimeBar.API.createAPI(r);for(var M in b)-1===M.indexOf("private")&&(y[M]=b[M]);b.privateInit(m,i,a,s,function(e){document.getElementById(r).style.cursor=e},h,o,void 0,c),y.internalSetSize=function(e,n,t){w.width=e,w.height=n,l(w,m),b.privateSetSize(m,e,n,t,!0)};var L=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){KeyLines.Util.nextTick(e,1e3/60)}}();return L(v),y}}(),!function(){var e=KeyLines.Controller={};e.createController=function(n,t,r,i,a){function o(){var e=Ln();return"undefined"==typeof e.isActuallyTheFlashLoader}function c(e,n){for(var t in e)e[t]&&e[t].im&&u(e[t].im)&&(e[t].im=e[n].im)}function u(e){var n="undefined"!=typeof e.naturalWidth&&0===e.naturalWidth;if(/.*\.svg$/.test(e.src)){var t=28===e.width&&30===e.height;return n&&(0===e.width||t)}return n}function s(){return{p:"ne",u:null,x:0,y:0}}function l(){return{shown:!0,p:"nw",x:0,y:0}}function f(){return{icon:!0,p:"se",shown:!1,size:100}}function d(e){dn.selectedNode&&dn.selectedNode.u&&(e[cn+dn.selectedNode.u]=1)}function h(e){if(KeyLines.fontsLoader){var n=[];if(dn.fontFamily&&n.push(dn.fontFamily),dn.iconFontFamily&&n.push(dn.iconFontFamily),dn.bands)for(var t=0;t<dn.bands.length;t++)dn.bands[t].ff&&n.push(dn.bands[t].ff);dn.watermark&&dn.watermark.ff&&n.push(dn.watermark.ff),KeyLines.fontsLoader(n,e)}else e()}function v(){r.setup();var n=dn.watermark;n&&r.addTextWatermark(n.u?cn+n.u:void 0,n.t,n.fs||80,n.fc||j.colours.lightgrey,n.fb,n.fbc,n.a,n.ff?n.ff:dn.fontFamily),dn.navigation&&dn.navigation.shown&&r.addNavigation($,Q,Mn,dn.navigation),dn.overview&&r.addOverview($,nn,Q,pn,Mn,dn.overview),dn.logo&&dn.logo.u&&r.addLogo(cn,dn.logo),e.e&&r.remove(p(on,Cn),p(on,On),p(on,yn))}function g(e,n){for(var t in n){var r=e[t],i=n[t];Z.isNormalObject(r)&&Z.isNormalObject(i)?g(r,i):"id"!==t&&"string"==typeof i&&r&&(e[t]=j.hsla(r),n[t]=j.hsla(i))}}function y(e,n){for(var t=0;t<n.length;t++)g(e[t],n[t])}function m(e,n,t){if("number"==typeof e)return e+t*(n-e);if(Z.isArray(e)){var r;return Math.abs(e[0]-n[0])>.5?(r=e[0]<n[0]?m(1+e[0],n[0],t):m(e[0],1+n[0],t),r-=Math.floor(r)):r=m(e[0],n[0],t),j.fromhsla([r,m(e[1],n[1],t),m(e[2],n[2],t),m(e[3],n[3],t)])}return n}function x(e,n,t){var r={};for(var i in e)r[i]=n.hasOwnProperty(i)?m(e[i],n[i],t):e[i];return r}function w(e,n,t,r,i,a){$.setProperties(e,!1,!0),$.animateProperties(n,{time:r},function(){i>1?w(e,n,t,r,i-1,a):($.setProperties(t,!1,!0),a())},!0)}function p(e,n){for(var t="",r=0;r<n.length;r++)t+=String.fromCharCode(e.charCodeAt(r)+n[r]);return t}function b(e){return 1-e}function M(e){return e}function L(e,n,t,r){var i=t;return X.buildAnimatorInstance(function(a){i-=a;var o=Math.max(0,Math.min(1,(t-i)/t));Pn=n(o);var c=i>0;return c||(nn.resurrect(e,!0),Pn=.5,Z.invoke(r)),c},{all:!0})}function S(e,n,t){if(0===e.length)Z.invoke(t);else{Pn=1,nn.ghost(e);var r,i=nn.showHideGetLinksToBend(e,!1);i.length>0?(n=2*n/3,r=function(){$.animateProperties(i,{time:n/2,queue:!1},t,!0)}):r=t;var a=L(e,b,n,function(){nn.hide(e),Z.invoke(r)});An(a,!0)}}function k(e,n,t){function r(){var r=L(e,M,n,t);An(r,!0)}if(0===e.length)Z.invoke(t);else{Pn=0,nn.ghost(e);var i=nn.showHideGetLinksToBend(e,!0);i.length>0?(n=2*n/3,$.animateProperties(i,{time:n/2,queue:!1},r,!0)):r()}}function I(){var e=1200,n=0;return X.buildAnimatorInstance(function(t){return n+=t,Rn=Math.floor(8*(1-n%e/e)),Kn})}function A(){if(Kn){zn.setLayer(j.layers.WAIT);for(var e=Q.scale(Q.width()/2),n=Q.scale(Q.height()/2),t=Q.scale(30),r=0;8>r;r++){var i=r*Math.PI/4,a=e+t*Math.cos(i),o=n+t*Math.sin(i),c=.2+.8*((r+Rn)%8)/8;zn.circle(a,o,Q.scale(10),j.colours.white,-1,"rgba(145, 146, 149, "+c+")",!0)}}}function E(e,n){en.hasOwnProperty("drawImageDirectAlpha")?en.drawImageDirectAlpha(e,0,0,e.width,e.height,0,0,e.width,e.height,n):(en.globalAlpha=n,en.drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),en.globalAlpha=1)}function D(e){zn.resetExtras(),nn.generate(zn,en,Q,J,cn),zn.extras(),Nn=nn.getResizePrimitive(),C(e),r.generate(zn,en,Q,J,xn,e,cn),A()}function C(e){e||xn&&xn.generate&&(zn.setLayer(j.layers.DRAGGERS),xn.generate(zn))}function O(e,n,t){var r=Tn.getContext("2d");j.clear(r,Q.width(),Q.height()),zn.draw(r,Q,J,n,e),E(Tn,t)}function T(e,n){zn.draw(e,Q,J,j.channels.MAIN,j.topLayers),n||r.drawOverviewContent(e,Q),zn.draw(e,Q,J,j.channels.MAIN,[j.layers.OVERVIEW])}function P(e,n){var t=Tn.getContext("2d");j.clear(t,Q.width(),Q.height()),T(t,n),E(Tn,e)}function N(e,n){var t,r=j;t=Kn?[{id:"wait-bands",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],useView:!1,alpha:1,alwaysUpdate:!0},{id:"wait-ghost-background",widgets:zn,channels:j.channels.BACKGROUNDGHOST,layers:r.itemLayers,useView:!0,alpha:Pn*n.backgroundAlpha/2,alwaysUpdate:!1},{id:"wait-ghost-content",widgets:zn,channels:j.channels.GHOST,layers:[r.layers.HALOS,r.layers.SHAPES,r.layers.NODESEL,r.layers.LINKS,r.layers.NODES,r.layers.BUBBLES],useView:!0,alpha:Pn/2,alwaysUpdate:!1},{id:"wait-background-content",widgets:zn,layers:r.itemLayers,channels:j.channels.BACKGROUND,useView:!0,alpha:n.backgroundAlpha/2,alwaysUpdate:!1},{id:"wait-main-content-halos",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL],useView:!0,alpha:n.backgroundAlpha,alwaysUpdate:!1},{id:"wait-main-content",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES,r.layers.SHAPES],useView:!0,alpha:n.backgroundAlpha,alwaysUpdate:!1},{id:"wait-top-content",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],useView:!0,alpha:n.backgroundAlpha,alwaysUpdate:!0},{id:"wait-overlays",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.HANDLES,r.layers.OVERLAYS],useView:!1,alpha:n.backgroundAlpha,alwaysUpdate:!0},{id:"wait",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.WAIT],useView:!1,alpha:1,alwaysUpdate:!0}]:[{id:"bands",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.BANDS,r.layers.UNDERLAYS],useView:!1,shadowType:-1,alpha:1,alwaysUpdate:!0},{id:"ghost-background",widgets:zn,layers:r.itemLayers,channels:j.channels.BACKGROUNDGHOST,useView:!0,alpha:Pn*n.backgroundAlpha,alwaysUpdate:!1},{id:"ghost-content",widgets:zn,channels:j.channels.GHOST,layers:r.itemLayers,useView:!0,alpha:Pn,alwaysUpdate:!1},{id:"background-content",widgets:zn,channels:j.channels.BACKGROUND,layers:r.itemLayers,useView:!0,alpha:n.backgroundAlpha,alwaysUpdate:!1},{id:"main-content-halos",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.HALOS,r.layers.NODESEL,r.layers.SHAPESEL,r.layers.SHAPES],useView:!0,alpha:1,alwaysUpdate:!1},{id:"main-content",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.LINKS,r.layers.NODES],useView:!0,alpha:1,alwaysUpdate:!1},{id:"top-content",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.DRAGGERS,r.layers.BUBBLES],useView:!0,alpha:1,alwaysUpdate:!0},{id:"handles",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.HANDLES],useView:!1,alpha:1,alwaysUpdate:!0},{id:"overlays",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.BANDLABELS,r.layers.OVERLAYS,r.layers.WAIT],useView:!1,shadowType:-1,alpha:1,alwaysUpdate:!0},{id:"shadowOnly",widgets:zn,channels:j.channels.MAIN,layers:[r.layers.OVERLAYSSHADOW],useView:!1,shadowType:1,alpha:1,alwaysUpdate:!0}],Un(en),n.smearMode||(en.webglCanvas.renderer.clearView(Wn),Wn=!1),J.updated&&(e.all=!0,en.webglCanvas.renderer.updateTextures(J),J.updated=!1),en.webglCanvas.renderer.build(t,J,e,n),en.webglCanvas.renderer.draw(Q,n)}function z(e){dn.smearMode||j.clear(en,Q.width(),Q.height()),Un(en),Kn?(O([j.layers.BANDS,j.layers.UNDERLAYS],j.channels.MAIN,.5),O(j.itemLayers,j.channels.BACKGROUNDGHOST,Pn*dn.backgroundAlpha/2),O(j.topLayers,j.channels.GHOST,Pn/2),O(j.itemLayers,j.channels.BACKGROUND,dn.backgroundAlpha/2),P(.5,e),zn.draw(en,Q,J,j.channels.MAIN,[j.layers.WAIT])):(zn.draw(en,Q,J,j.channels.MAIN,[j.layers.BANDS,j.layers.UNDERLAYS]),O(j.itemLayers,j.channels.BACKGROUNDGHOST,Pn*dn.backgroundAlpha),O(j.topLayers,j.channels.GHOST,Pn),O(j.itemLayers,j.channels.BACKGROUND,dn.backgroundAlpha),T(en,e))}function K(e,n){return function(){var r=Bn(e,n,Q);(nn.getByID(r)||!r)&&r!==_n&&(_n=r,t.trigger("hover",Z.rawId(r),e,n,Z.subId(r)))}}function R(e,n){Fn&&clearTimeout(Fn),Fn=Z.nextTick(K(e,n),dn.hover)}function U(e,n,t,r){if(xn.scrollable&&dn.dragPan){var i=Q.maybeScroll(e,n,xn,t,r);An(i)}}function W(e,n,t,r){xn&&B(!0,e,n,t,r)}function B(e,n,t,r,i){xn&&xn.endDrag(e,n,t,r,i),xn=null,wn("auto"),Sn()}function F(e){return function(n,t,r,i){J&&nn&&(vn()?a.internalUse.zoom(e,n,t,r):(An(Q[e](nn,zn,en,J,n,t,r,cn,i)),Sn()))}}function _(e,n){var t="radial"!==e;return n=Z.defaults(n,{fixed:[]}),nn.extractStructure(en,n,t)}function V(e,n,r){var i,a;if(e){var o=Math.max(0,Math.min(n.time||700,2e3)),c="linear"===n.easing?t.linearEasing:t.cubicEasing,u=e.extents;i=nn.makeAnimator(e.vertices,o,c),a=Q.fitWorldExtents(e.extents,!0,!0,!0,!0,o,r),n.animate?(En(i),n.fit?En(a):u&&En(jn(o,r))):(nn.applyVertices(e.vertices),Sn(),u&&(n.fit?Q.fitWorldExtents(e.extents,!1,!0,!0,!0,0,r):Z.invoke(r)))}else Z.invoke(r)}function H(e){return function(n,t){V(n,t,e)}}function Y(){Zn&&(clearTimeout(Zn),Zn=null)}function G(){Jn&&(clearTimeout(Jn),Jn=null)}var q=KeyLines.Combo,X=KeyLines.Common,j=KeyLines.Rendering,Z=KeyLines.Util,$={},J=null,Q=null,en=null,nn=null,tn=null,rn=!1,an=1;$.combo=q.create(n);var on="Cambridge Intelligence";$.wait=function(e){return"undefined"!=typeof e&&e!==Kn&&(Kn=e,e&&An(I())),Kn};var cn="";$.imageBasePath=function(e){return e&&(cn=e),cn},$.imageList=function(e){return e&&(J=e),J},$.setCanvas=function(e){en=e,i.setDashSupport("setLineDash"in en)},$.setView=function(e){Q=e},$.setShadowCanvas=function(e,n,t){tn=X.hitTester(e,n,t,zn),nn.setAllDirty()},$.setModel=function(e){nn=e,nn.setOptions(dn)};var un=0,sn=null,ln=[],fn=$.afterChange=function(e,n,t){if(Sn(),v(),n)Sn(t),Z.invoke(e);else{e&&ln.push(e);var i=nn.imageList(cn);r.appendImageList(i),d(i);var a=o();if(a){var u=Mn+"Missing.png";i[u]=1}J&&(sn=J,J=null),sn=sn||{_coList:[]};var s={};for(var l in i)"updated"!==l&&"_coList"!==l&&(sn[l]||(s[l]=1));!function(e){j.imageLoader(Ln,bn,s,function(n,t){if(e===un){J=sn,J.updated=!0;for(var i in t)J[i]={im:t[i]};if(a&&c(J,u),r.colorize(J,pn,dn.controlColour),j.circularize(J,t,pn),Sn({textures:!0}),ln.length>0){var o=ln;ln=[];for(var s=0;s<o.length;s++)Z.invoke(o[s])}}})}(++un)}},dn={arrows:"normal",backgroundAlpha:.2,controlColour:j.colours.midgrey,dragPan:!0,fanLength:64,handMode:!1,hover:1e3,navigation:l(),linkEnds:{spacing:"tight",avoidLabels:!0},overview:f(),marqueeLinkSelection:"centre",showShadowCanvas:!1,watermark:{fb:!0},gestures:!0},hn={fanLength:!0,fontFamily:!0,iconFontFamily:!0,labelOffset:!0,linkEnds:!0,maxItemZoom:!0,selectedLink:!0,selectedNode:!0,selectionColour:!0,selectionFontColour:!0};$.options=function(e,n,t){if(e){var r=!1;e=e||{};for(var i in e)dn[i]=e[i],"logo"===i&&("string"==typeof e[i]&&(dn[i]=s(),dn[i].u=e[i]),e[i]||(dn[i]=s())),"navigation"===i&&(e[i]?dn[i]=Z.isNormalObject(e[i])?Z.defaults(e[i],l()):l():(dn[i]=l(),dn[i].shown=!1)),"overview"===i&&(e[i]?dn[i]=Z.isNormalObject(e[i])?Z.defaults(e[i],f()):f():(dn[i]=f(),dn[i].icon=!1,dn[i].shown=!1)),"watermark"===i&&Z.isNormalObject(e[i])&&(e[i].fc&&(dn[i].fc=e[i].fc&&j.validatergb(e[i].fc)?e[i].fc:void 0),e[i].fbc&&(dn[i].fbc=e[i].fbc&&j.validatergb(e[i].fbc)?e[i].fbc:void 0)),"selectedNode"!==i&&"selectedLink"!==i||!Z.isNormalObject(dn[i])||nn.ensureObject(dn[i]),"showShadowCanvas"===i&&rn!==dn.showShadowCanvas&&(rn=dn.showShadowCanvas,tn.debugCanvas(rn?en:null)),hn[i]&&(r=!0);nn.setOptions(dn),Q.setMaxItemZoom(dn.maxItemZoom),Q.setMinZoom(dn.minZoom),r&&nn.setAllDirty(),vn()&&a.internalUse.enableDragging(dn.handMode),h(function(){fn(n,t)})}return Z.clone(dn)};var vn=$.inMapMode=function(){return a&&a.api.isShown()};$.watermarkSize=function(){return r.getWatermarkSize(en,J)},$.load=function(e,n){J=null,nn.load(e),$.combo.internalUse.loadUp(e.combos),e.viewSettings&&$.setViewSettings(e.viewSettings,!1),a?a.internalUse.loadUp(e.map,n):Z.invoke(n)},$.merge=function(e){t.trigger("prechange","merge");var n=$.combo.internalUse.preMerge(e);return vn()&&(n=a.internalUse.preMerge(n)),nn.merge(n)},$.appendCombos=function(e){e.combos=$.combo.internalUse.serialize()},$.postMerge=function(e){$.combo.internalUse.postMerge(e)},$.setItem=function(e){var n=$.combo.internalUse.preMerge([e])[0];return n&&vn()&&a.internalUse.preSetItem(n),!!n&&nn.setItem(n)};var gn=$.removeItem=function(e){$.combo.internalUse.preDelete(e),nn.removeItem(e)};$.setProperties=function(e,n,r){return r||t.trigger("prechange","properties"),vn()&&a.internalUse.convertPos(e),nn.setProperties(e,n)},$.setViewSettings=function(e,n,t,r){An(Q.fromSettingsDirect(e,n,t,r))};var yn=[47,6,-11,-58,-64,-52,-48,-59,-51,21,-22,-66,-66,-48,-58,-67],mn=Z.makeIdMap(["b","b1","b2","bw","c","e","fbc","fc","fi","fs","h","ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9","off","w","x","y"]);$.animateProperties=function(e,n,r,i){function o(e){for(var n in e)"undefined"==typeof e[n]&&(e[n]=nn.defaultValueFor(n))}function c(e){for(var n=0;n<e.length;n++){var t=nn.getByID(e[n].id);if(t){o(e[n]),k.push(e[n]);var r=u(e[n],t);S.push(r)}}}function u(e,n){var t={};for(var r in e)"id"!==r&&(t[r]=Z.clone(n[r]||nn.defaultValueFor(r)));return t}function s(e){return 3===e.length&&/^ha/.test(e)||"fi"===e}i||t.trigger("prechange","properties");var l=Z.clone(e);vn()&&a.internalUse.convertPos(l);for(var f,d=[],h=[],v=0;v<l.length;v++){f=l[v];var g=null,w=null;for(var p in f)mn[p]?(w=w||{id:f.id},w[p]=f[p]):"id"!==p&&(g=g||{id:f.id},g[p]=f[p]);g&&h.push(g),w&&d.push(w)}var b=n.time,M=t.linearEasing;"cubic"===n.easing&&(M=t.cubicEasing);var L=b,S=[],k=[];nn.setProperties(h,!1);var I=X.buildAnimatorInstance(function(e,t){t?(nn.ensureTypesInArray(d,!0),c(d),y(S,k)):L-=e;for(var i=M(Math.max(0,Math.min(1,(b-L)/b))),a=L>0,o=[],u=0;u<k.length;u++){var l={id:k[u].id};for(var f in k[u])s(f)?l[f]=x(S[u][f],k[u][f],i):"id"!==f&&(l[f]=m(S[u][f],k[u][f],i));o.push(l)}return nn.unsafeApplyChanges(o),a?n.cb&&Z.tryCatch(function(){n.cb.call(this,i,b-L)}):Z.invoke(r),a},{positions:!0,colours:!0,textures:!0});An(I,n.queue)},$.ping=function(e,n,t){function r(e,n,t,r){var i={id:n};i[t]=r,e.push(i)}e=Z.ensureArray(e);for(var i=[],a=[],o=[],c=0;c<e.length;c++){var u=e[c],s=nn.getByID(u);if(s&&"node"===s.type){for(var l=0;10>l&&s["ha"+l];)l++;if(10>l||!s.ha0){var f="ha"+l;r(i,u,f,{r:Math.max(28-n.w/2,0),w:0,c:n.c});var d=j.hsla(n.c),h=j.fromhsla([d[0],d[1],d[2],.001]);r(a,u,f,{r:n.r,w:n.w,c:h}),r(o,u,f,null)}}}i.length>0?w(i,a,o,n.time,n.repeat,function(){$.afterChange(t,!0,{positions:!0})}):$.afterChange(t,!0)};var xn=null,wn=function(){};$.setCursorFn=function(e){wn=e};var pn=function(){};$.setCreateCanvasFn=function(e){pn=e};var bn="";$.setPath=function(e){bn=e};var Mn;$.assetPath=function(e){return e&&(Mn=e),Mn};var Ln=function(){};$.setImageGenFn=function(e){Ln=e};var Sn=$.render=function(e){e=e||{all:!0},t.trigger("redraw",e)},kn=X.animator(Sn),In=X.animator(Sn);$.animate=function(e){var n=lt?lt:xn,t=kn.animate(e,n,nn),r=In.animate(e);return t||r},$.cancelAnimation=kn.cancel;var An=$.pushAnimation=kn.push;$.cancelLayoutAnimation=In.cancel;var En=$.pushLayoutAnimation=In.push,Dn=$.backgroundOpacity=function(e){return arguments.length>0&&(an=e,Sn()),an};$.animateBackgroundOpacity=X.makeValueAnimator(kn,Dn);var Cn=[8,4,12,-22,-9,5,1,12,-69,37,45,-13,-8,16,-11,8,0,8,9,-78,-67],On=[47,6,-11,-58,-64,-57,-48,-59,-51,19,-16,-66,-66,-48,-58,-67],Tn=null;$.makeGhostCanvas=function(e,n){Tn=pn(e,n)};var Pn=.5;$.hide=function(e,n,t){n.animate?S(e,n.time,t):(nn.hide(e),nn.showHideBendLinks(e),Sn({all:!0}),Z.invoke(t))},$.show=function(e,n,t,r){nn.show(e,n),t.animate?k(e,t.time,r):(nn.showHideBendLinks(e),Sn({all:!0}),Z.invoke(r))};var Nn,zn=j.widgets(),Kn=!1,Rn=3,Un=$.drawBackground=function(e){j.backFill(e,"white",an,Q.scale(Q.width()),Q.scale(Q.height())),dn.backColour?j.backFill(e,dn.backColour,an,Q.scale(Q.width()),Q.scale(Q.height())):dn.gradient&&j.backgroundGradient(e,dn.gradient.stops,an,Q.width(),Q.height())},Wn=!0;$.labelPosition=function(e,n){return D(!1),nn.labelPosition(e,n)},$.draw=function(e,n){J&&(D(e),nn.animated()&&(n.all=!0),en.webgl?N(n,dn):z(e))},$.drawoffscreen=function(){J&&tn.dirty()};var Bn=$.hittest=function(e,n,t,r){return tn.test(e,n,t,r,en)};$.afterDraw=function(){xn&&xn.mouseMoved&&xn.mouseMoved()&&xn.afterDraw(Bn(Hn,Yn,Q),Hn,Yn)};var Fn,_n;$.dragover=function(e,n){K(e,n)()},$.resetState=function(){xn=null},$.startDragger=function(e,n,t,r){if(nn&&(t=Q.worldToViewX(t),r=Q.worldToViewY(r),xn=nn.startDragger($,Q,e,t,r,n),xn&&e)){var i=xn.getCursor(t,r);wn(i)}};var Vn;$.mousedown=function(e,n,i,a,o){if(nn){var c,u=Bn(n,i,Q);if(xn)B(!0,n,i,a,o);else{Vn=u;var s=t.trigger("mousedown",Z.rawId(u),Q.unscale(n),Q.unscale(i),e,Z.subId(u));if(nn.getByID(u)||!u){var l=!1;l=0===e?dn.handMode?u?!nn.isSelected(u)||a:!1:!nn.isSelected(u)||a||!u:!u||!nn.isSelected(u),s&&(l=!1),l&&nn.setSelection(u,a,o),0===e&&(xn=nn.createDragger($,en,Q,u,n,i,dn,Nn),xn&&u&&(c=xn.getCursor(n,i),wn(c))),Sn(),2===e?t.trigger("contextmenu",Z.rawId(u),Q.unscale(n),Q.unscale(i),Z.subId(u)):t.trigger("click",Z.rawId(u),Q.unscale(n),Q.unscale(i),e,Z.subId(u))}else 0===e&&(xn=r.createDragger(u,n,i),xn&&u&&(c=xn.getCursor(n,i),wn(c))),(0===e||1===e)&&(t.trigger("click",Z.rawId(u),Q.unscale(n),Q.unscale(i),e,Z.subId(u)),Sn())}return u}};var Hn,Yn,Gn;$.mousemove=function(e,n,t,i,a){Hn=e,Yn=n;var o="auto";if(xn&&!a)xn.mouseMoved&&xn.mouseMoved(!0),U(e,n,t,i),xn.dragMove(e,n,t,i),o=xn.getCursor(e,n),Sn(xn.rebuild);else if(nn){var c=nn?Bn(e,n,Q):null;R(e,n),nn.getByID(c)?c&&(o=nn.getCursor(c,Mn)):o=r.getCursor(c)}Gn===o||a||(wn(o),Gn=o)},$.mouseup=$.removeDragger=W,$.mouseleave=function(e,n,t,r){arguments.length&&xn&&(!dn.dragPan||vn()&&dn.handMode)&&B(vn(),e,n,t,r)},$.dblclick=function(e,n){var r=Vn;xn&&B(!1),!r&&Q&&(t.trigger("dblclick",null,Q.unscale(e),Q.unscale(n))||Xn(!0)),r&&nn.getByID(r)&&t.trigger("dblclick",Z.rawId(r),Q.unscale(e),Q.unscale(n),Z.subId(r))};var qn;$.mousewheel=function(e,n,r){if(Q){var i=(new Date).getTime();if(qn&&100>i-qn)return;qn=i,t.trigger("mousewheel",e,Q.unscale(n),Q.unscale(r))||An(Q.wheelToPosition(e,n,r))}},$.keyup=function(e){27===e&&B(!1)},$.keydown=function(e,n,r){if(nn&&!t.trigger("keydown",e,n,r)){if(65===e&&n)return nn.selectAll(),Sn({positions:!0}),!0;if(nn.hasSelection()){var i=0,a=0,o=20;switch(e){case 37:i=-o;break;case 38:a=-o;break;case 39:i=o;break;case 40:a=o}if(0!==i||0!==a)return t.trigger("prechange","move"),nn.moveSelection(i,a),Sn({positions:!0}),!0;if(46===e){var c=t.trigger("delete");if(!c){t.trigger("prechange","delete");var u=nn.selectionPlusDummyNodes();gn(u)}return Sn(),!0}113===e&&t.trigger("edit",nn.doSelection())}return!1}},$.panBy=function(e,n,t,r,i){An(Q.panBy(e,n,t,!1,r,i)),Sn({drawOnly:!0})},$.pan=function(e,n,t,r){vn()?a.internalUse.pan(e,n,t,r):(An(Q.pan(e,n,t,r)),Sn({drawOnly:!0}))};var Xn=$.zoomIn=function(e,n,t){vn()?a.internalUse.zoom("in",e,n,t):(An(Q.zoomIn(e,n,t)),Sn({drawOnly:!0}))};$.zoomOut=function(e,n,t){vn()?a.internalUse.zoom("out",e,n,t):(An(Q.zoomOut(e,n,t)),Sn({drawOnly:!0}))},$.setZoom=function(e,n,t,r){vn()?a.internalUse.setZoom(e,n,t,r):(An(Q.setZoom(e,n,t,r)),Sn({drawOnly:!0}))},$.modelExtents=function(){return nn.generate(zn,en,Q,J,cn),zn.itemExtents(null,en)},$.fitToModel=F("fitToModel"),$.fitToSelection=F("fitToSelection"),$.fitModelHeight=F("fitModelHeight");var jn=function(e,n){var t=e;return X.buildAnimatorInstance(function(e){t-=e;var r=0>t;return r&&Z.invoke(n),!r})};$.layout=function(e,n,r){if(nn){n=n||{};var i=_(e,n);nn.layout(e,t,i,n,H(r))}},$.arrange=function(e,n,r,i){if(nn){var a=_(e,r);
nn.arrange(e,t,n,a,r,H(i))}};var Zn,$n,Jn,Qn,et,nt,tt,rt;$.touchstart=function(e){if(rt=e,2===e.length&&(ut=(e[0].x+e[1].x)/2,st=(e[0].y+e[1].y)/2,ot=ut,ct=st),1===e.length){Qn=e[0].x,et=e[0].y,tt=e[0].id;var n=Bn(Qn,et,Q);if(Zn?n!==nt?Y():$n=!0:($n=!1,Zn=Z.nextTick(Y,600)),nt=n,Jn=Z.nextTick(function(){G(),xn&&B(!1),t.trigger("contextmenu",Z.rawId(nt),Q.unscale(Qn),Q.unscale(et),Z.subId(nt))},600),nn.getByID(nt)||!nt){var i=t.trigger("touchdown",Z.rawId(nt),Q.unscale(Qn),Q.unscale(et),Z.subId(nt));i||(nt?nn.isSelected(nt)||nn.setSelection(nt,!1,!1):dn.handMode||nn.setSelection(null,!1,!1)),xn=nn.createDragger($,en,Q,nt,Qn,et,dn,Nn),Sn()}else xn=r.createDragger(nt,Qn,et)}};var it,at,ot,ct;$.touchmove=function(e){rt=e,e.length>=2&&(ot=(e[0].x+e[1].x)/2,ct=(e[0].y+e[1].y)/2);for(var n=0;n<e.length;n++)tt===e[n].id&&(it=e[n].x,at=e[n].y);if(Jn){var t=(it-Qn)*(it-Qn)+(at-et)*(at-et);t>100&&G()}lt||xn&&tt===e[0].id&&1===e.length&&(Hn=e[0].x,Yn=e[0].y,xn.mouseMoved&&xn.mouseMoved(!0),U(e[0].x,e[0].y),xn.dragMove(e[0].x,e[0].y,!1,!1),Sn(xn.rebuild))},$.touchend=function(e,n){if(rt=e,Sn(),Jn&&(G(),vn()||t.trigger("click",Z.rawId(nt),Q.unscale(Qn),Q.unscale(et),0,Z.subId(nt))),Zn&&$n){Y();var r=t.trigger("dblclick",Z.rawId(nt),Q.unscale(Qn),Q.unscale(et),Z.subId(nt));r||nt||Xn(!0)}if(!lt&&xn){for(var i=-1,a=0;a<n.length;a++)n[a].id===tt&&(i=a);i>-1&&0===e.length?B(!0,n[i].x,n[i].y,!1,!1):e.length>0&&(Qn=e[0].x,et=e[0].y,tt=e[0].id,nt=Bn(Qn,et,Q),(nn.getByID(nt)||!nt)&&(nn.setSelection(nt,!1,!1),xn=nn.createDragger($,en,Q,nt,Qn,et,dn,Nn)))}},$.touchcancel=function(){G(),xn&&B(!1)};var ut,st,lt;return $.gesturestart=function(){},$.gesturechange=function(e,n){G(),dn.gestures&&(lt||(lt=nn.createGestureDragger(Q,ut,st)),lt.dragMove(e,n,ot,ct),Sn({all:!0}))},$.gestureend=function(e,n){lt&&lt.endDrag(!0,e,n,ot,ct),lt=null},$}}();;

